(window.webpackJsonp=window.webpackJsonp||[]).push([[231],{722:function(t,a,s){"use strict";s.r(a);var n=s(2),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[s("img",{attrs:{src:"https://img.starfish.ink/common/faq-banner.png",alt:""}})]),t._v(" "),s("blockquote",[s("p",[t._v("Kafkaä½œä¸ºç°ä»£åˆ†å¸ƒå¼ç³»ç»Ÿçš„"),s("strong",[t._v("æ ¸å¿ƒæ¶ˆæ¯ä¸­é—´ä»¶")]),t._v("ï¼Œæ˜¯é¢è¯•ä¸­çš„"),s("strong",[t._v("é‡ç‚¹è€ƒæŸ¥å¯¹è±¡")]),t._v("ã€‚ä»åŸºç¡€æ¶æ„åˆ°é«˜çº§ç‰¹æ€§ï¼Œä»æ€§èƒ½ä¼˜åŒ–åˆ°æ•…éšœå¤„ç†ï¼Œæ¯ä¸ªçŸ¥è¯†ç‚¹éƒ½æ˜¯æŠ€æœ¯é¢è¯•çš„çƒ­ç‚¹ã€‚æœ¬æ–‡æ¡£å°†"),s("strong",[t._v("Kafkaæ ¸å¿ƒæŠ€æœ¯")]),t._v("æ•´ç†æˆ"),s("strong",[t._v("ç³»ç»ŸåŒ–çŸ¥è¯†ä½“ç³»")]),t._v("ï¼Œæ¶µç›–æ¶æ„åŸç†ã€æ€§èƒ½è°ƒä¼˜ã€å¯é æ€§ä¿éšœç­‰å…³é”®é¢†åŸŸï¼ŒåŠ©ä½ åœ¨é¢è¯•ä¸­è„±é¢–è€Œå‡ºï¼")])]),t._v(" "),s("p",[t._v("Kafka é¢è¯•ï¼Œå›´ç»•ç€è¿™ä¹ˆå‡ ä¸ªæ ¸å¿ƒæ–¹å‘å‡†å¤‡ï¼š")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("Kafkaæ ¸å¿ƒæ¶æ„")]),t._v("ï¼ˆBrokerã€Topicã€Partitionã€Producerã€Consumerã€å‰¯æœ¬æœºåˆ¶ï¼‰")]),t._v(" "),s("li",[s("strong",[t._v("é«˜æ€§èƒ½åŸç†")]),t._v("ï¼ˆé¡ºåºå†™ã€é›¶æ‹·è´ã€æ‰¹å¤„ç†ã€åˆ†åŒºå¹¶è¡Œã€Page Cacheåˆ©ç”¨ï¼‰")]),t._v(" "),s("li",[s("strong",[t._v("å¯é æ€§ä¿éšœ")]),t._v("ï¼ˆå‰¯æœ¬åŒæ­¥ã€ISRæœºåˆ¶ã€äº‹åŠ¡æ”¯æŒã€ä¸€è‡´æ€§ä¿è¯ï¼‰")]),t._v(" "),s("li",[s("strong",[t._v("æ€§èƒ½è°ƒä¼˜")]),t._v("ï¼ˆåˆ†åŒºè®¾è®¡ã€æ‰¹å¤„ç†ä¼˜åŒ–ã€ç½‘ç»œè°ƒä¼˜ã€JVMè°ƒä¼˜ï¼‰")]),t._v(" "),s("li",[s("strong",[t._v("æ•…éšœå¤„ç†")]),t._v("ï¼ˆLeaderé€‰ä¸¾ã€æ•°æ®æ¢å¤ã€ç›‘æ§å‘Šè­¦ã€å®¹ç¾è®¾è®¡ï¼‰")]),t._v(" "),s("li",[s("strong",[t._v("é«˜çº§ç‰¹æ€§")]),t._v("ï¼ˆKafka Streamsã€KRaftæ¨¡å¼ã€å»¶æ—¶é˜Ÿåˆ—ã€æ­»ä¿¡é˜Ÿåˆ—ï¼‰")]),t._v(" "),s("li",[s("strong",[t._v("å®æˆ˜åº”ç”¨")]),t._v("ï¼ˆæ¶æ„è®¾è®¡ã€æœ€ä½³å®è·µã€é—®é¢˜æ’æŸ¥ã€æ€§èƒ½ä¼˜åŒ–æ¡ˆä¾‹ï¼‰")])]),t._v(" "),s("h2",{attrs:{id:"ğŸ—ºï¸-çŸ¥è¯†å¯¼èˆª"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ—ºï¸-çŸ¥è¯†å¯¼èˆª"}},[t._v("#")]),t._v(" ğŸ—ºï¸ çŸ¥è¯†å¯¼èˆª")]),t._v(" "),s("h3",{attrs:{id:"ğŸ·ï¸-æ ¸å¿ƒçŸ¥è¯†åˆ†ç±»"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸-æ ¸å¿ƒçŸ¥è¯†åˆ†ç±»"}},[t._v("#")]),t._v(" ğŸ·ï¸ æ ¸å¿ƒçŸ¥è¯†åˆ†ç±»")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("åŸºç¡€ä¸æ¶æ„")]),t._v("ï¼šKafkaå®šä½ã€æ ¸å¿ƒç»„ä»¶ã€æ¶ˆæ¯æ¨¡å‹ã€é›†ç¾¤æ¶æ„")]),t._v(" "),s("li",[s("strong",[t._v("é«˜æ€§èƒ½åŸç†")]),t._v("ï¼šé›¶æ‹·è´æŠ€æœ¯ã€é¡ºåºå†™ä¼˜åŒ–ã€æ‰¹å¤„ç†æœºåˆ¶ã€ç½‘ç»œæ¨¡å‹")]),t._v(" "),s("li",[s("strong",[t._v("å¯é æ€§ä¿éšœ")]),t._v("ï¼šå‰¯æœ¬æœºåˆ¶ã€ä¸€è‡´æ€§ä¿è¯ã€äº‹åŠ¡æ”¯æŒã€æ•…éšœæ¢å¤")]),t._v(" "),s("li",[s("strong",[t._v("æ€§èƒ½ä¸è°ƒä¼˜")]),t._v("ï¼šåˆ†åŒºè®¾è®¡ã€å‚æ•°è°ƒä¼˜ã€ç›‘æ§æŒ‡æ ‡ã€ç“¶é¢ˆåˆ†æ")]),t._v(" "),s("li",[s("strong",[t._v("é«˜çº§ç‰¹æ€§")]),t._v("ï¼šæµå¤„ç†ã€å»¶æ—¶é˜Ÿåˆ—ã€æ­»ä¿¡é˜Ÿåˆ—ã€KRaftæ¨¡å¼")]),t._v(" "),s("li",[s("strong",[t._v("å·¥ç¨‹å®è·µ")]),t._v("ï¼šæ¶æ„è®¾è®¡ã€è¿ç»´ç›‘æ§ã€æ•…éšœæ’æŸ¥ã€æœ€ä½³å®è·µ")])]),t._v(" "),s("h2",{attrs:{id:"ä¸€ã€kafkaåŸºç¡€ä¸æ¶æ„-ğŸ§ "}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä¸€ã€kafkaåŸºç¡€ä¸æ¶æ„-ğŸ§ "}},[t._v("#")]),t._v(" ä¸€ã€KafkaåŸºç¡€ä¸æ¶æ„ ğŸ§ ")]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-ä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ—"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-ä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ—"}},[t._v("#")]),t._v(" ğŸ¯ ä¸ºä»€ä¹ˆéœ€è¦æ¶ˆæ¯é˜Ÿåˆ—")]),t._v(" "),s("p",[t._v("æ¶ˆæ¯é˜Ÿåˆ—æœ€é²œæ˜çš„ç‰¹æ€§æ˜¯"),s("strong",[t._v("å¼‚æ­¥ã€å‰Šå³°ã€è§£è€¦")]),t._v("ã€‚")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("è§£è€¦")]),t._v("ï¼š å…è®¸ä½ ç‹¬ç«‹çš„æ‰©å±•æˆ–ä¿®æ”¹ä¸¤è¾¹çš„å¤„ç†è¿‡ç¨‹ï¼Œåªè¦ç¡®ä¿å®ƒä»¬éµå®ˆåŒæ ·çš„æ¥å£çº¦æŸã€‚")]),t._v(" "),s("li",[s("strong",[t._v("å†—ä½™")]),t._v('ï¼šæ¶ˆæ¯é˜Ÿåˆ—æŠŠæ•°æ®è¿›è¡ŒæŒä¹…åŒ–ç›´åˆ°å®ƒä»¬å·²ç»è¢«å®Œå…¨å¤„ç†ï¼Œé€šè¿‡è¿™ä¸€æ–¹å¼è§„é¿äº†æ•°æ®ä¸¢å¤±é£é™©ã€‚è®¸å¤šæ¶ˆæ¯é˜Ÿåˆ—æ‰€é‡‡ç”¨çš„"æ’å…¥-è·å–-åˆ é™¤"èŒƒå¼ä¸­ï¼Œåœ¨æŠŠä¸€ä¸ªæ¶ˆæ¯ä»é˜Ÿåˆ—ä¸­åˆ é™¤ä¹‹å‰ï¼Œéœ€è¦ä½ çš„å¤„ç†ç³»ç»Ÿæ˜ç¡®çš„æŒ‡å‡ºè¯¥æ¶ˆæ¯å·²ç»è¢«å¤„ç†å®Œæ¯•ï¼Œä»è€Œç¡®ä¿ä½ çš„æ•°æ®è¢«å®‰å…¨çš„ä¿å­˜ç›´åˆ°ä½ ä½¿ç”¨å®Œæ¯•ã€‚')]),t._v(" "),s("li",[s("strong",[t._v("æ‰©å±•æ€§")]),t._v("ï¼š å› ä¸ºæ¶ˆæ¯é˜Ÿåˆ—è§£è€¦äº†ä½ çš„å¤„ç†è¿‡ç¨‹ï¼Œæ‰€ä»¥å¢å¤§æ¶ˆæ¯å…¥é˜Ÿå’Œå¤„ç†çš„é¢‘ç‡æ˜¯å¾ˆå®¹æ˜“çš„ï¼Œåªè¦å¦å¤–å¢åŠ å¤„ç†è¿‡ç¨‹å³å¯ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("å³°å€¼å¤„ç†èƒ½åŠ›")]),t._v(" &  **çµæ´»æ€§ **ï¼š åœ¨è®¿é—®é‡å‰§å¢çš„æƒ…å†µä¸‹ï¼Œåº”ç”¨ä»ç„¶éœ€è¦ç»§ç»­å‘æŒ¥ä½œç”¨ï¼Œä½†æ˜¯è¿™æ ·çš„çªå‘æµé‡å¹¶ä¸å¸¸è§ã€‚ å¦‚æœä¸ºä»¥èƒ½å¤„ç†è¿™ç±»å³°å€¼è®¿é—®ä¸ºæ ‡å‡†æ¥æŠ•å…¥èµ„æºéšæ—¶å¾…å‘½æ— ç–‘æ˜¯å·¨å¤§çš„æµªè´¹ã€‚ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—èƒ½å¤Ÿä½¿å…³é”®ç»„ä»¶é¡¶ä½çªå‘çš„è®¿é—®å‹åŠ›ï¼Œè€Œä¸ä¼šå› ä¸ºçªå‘çš„è¶…è´Ÿè·çš„è¯·æ±‚è€Œå®Œå…¨å´©æºƒã€‚")]),t._v(" "),s("li",[s("strong",[t._v("å¯æ¢å¤æ€§")]),t._v("ï¼š ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ç»„ä»¶å¤±æ•ˆæ—¶ï¼Œä¸ä¼šå½±å“åˆ°æ•´ä¸ªç³»ç»Ÿã€‚æ¶ˆæ¯é˜Ÿåˆ—é™ä½äº†è¿›ç¨‹é—´çš„è€¦åˆåº¦ï¼Œæ‰€ä»¥å³ä½¿ä¸€ä¸ªå¤„ç†æ¶ˆæ¯çš„è¿›ç¨‹æŒ‚æ‰ï¼ŒåŠ å…¥é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ä»ç„¶å¯ä»¥åœ¨ç³»ç»Ÿæ¢å¤åè¢«å¤„ç†ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("é¡ºåºä¿è¯")]),t._v("ï¼š åœ¨å¤§å¤šä½¿ç”¨åœºæ™¯ä¸‹ï¼Œæ•°æ®å¤„ç†çš„é¡ºåºéƒ½å¾ˆé‡è¦ã€‚å¤§éƒ¨åˆ†æ¶ˆæ¯é˜Ÿåˆ—æœ¬æ¥å°±æ˜¯æ’åºçš„ï¼Œå¹¶ä¸”èƒ½ä¿è¯æ•°æ®ä¼šæŒ‰ç…§ç‰¹å®šçš„é¡ºåºæ¥å¤„ç†ã€‚ï¼ˆKafka ä¿è¯ä¸€ä¸ª Partition å†…çš„æ¶ˆæ¯çš„æœ‰åºæ€§ï¼‰")]),t._v(" "),s("li",[s("strong",[t._v("ç¼“å†²")]),t._v("ï¼š æœ‰åŠ©äºæ§åˆ¶å’Œä¼˜åŒ–æ•°æ®æµç»è¿‡ç³»ç»Ÿçš„é€Ÿåº¦ï¼Œ è§£å†³ç”Ÿäº§æ¶ˆæ¯å’Œæ¶ˆè´¹æ¶ˆæ¯çš„å¤„ç†é€Ÿåº¦ä¸ä¸€è‡´çš„æƒ…å†µã€‚")]),t._v(" "),s("li",[s("strong",[t._v("å¼‚æ­¥é€šä¿¡")]),t._v("ï¼š å¾ˆå¤šæ—¶å€™ï¼Œç”¨æˆ·ä¸æƒ³ä¹Ÿä¸éœ€è¦ç«‹å³å¤„ç†æ¶ˆæ¯ã€‚æ¶ˆæ¯é˜Ÿåˆ—æä¾›äº†å¼‚æ­¥å¤„ç†æœºåˆ¶ï¼Œå…è®¸ç”¨æˆ·æŠŠä¸€ä¸ªæ¶ˆæ¯æ”¾å…¥é˜Ÿåˆ—ï¼Œä½†å¹¶ä¸ç«‹å³å¤„ç†å®ƒã€‚æƒ³å‘é˜Ÿåˆ—ä¸­æ”¾å…¥å¤šå°‘æ¶ˆæ¯å°±æ”¾å¤šå°‘ï¼Œç„¶ååœ¨éœ€è¦çš„æ—¶å€™å†å»å¤„ç†å®ƒä»¬ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kakfa-æ˜¯ä»€ä¹ˆ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kakfa-æ˜¯ä»€ä¹ˆ"}},[t._v("#")]),t._v(" ğŸ¯ Kakfa æ˜¯ä»€ä¹ˆ ?")]),t._v(" "),s("p",[t._v('"Kafkaæ˜¯Apacheå¼€æºçš„åˆ†å¸ƒå¼æµå¤„ç†å¹³å°ï¼Œä¸»è¦ç”¨äºæ„å»ºå®æ—¶æ•°æ®ç®¡é“å’Œæµå¼åº”ç”¨ã€‚å®ƒå…·æœ‰é«˜ååé‡ã€ä½å»¶è¿Ÿã€å®¹é”™æ€§å¼ºçš„ç‰¹ç‚¹ã€‚')]),t._v(" "),s("p",[t._v('åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä¸»è¦ç”¨å®ƒæ¥åšæ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå®ç°ç³»ç»Ÿè§£è€¦ã€å¼‚æ­¥å¤„ç†å’Œæ•°æ®ç¼“å†²ã€‚æ¯”å¦‚åœ¨ç”¨æˆ·ä¸‹å•åï¼Œæˆ‘ä»¬ä¼šå°†è®¢å•ä¿¡æ¯å‘é€åˆ°Kafkaï¼Œç„¶åç”±ä¸åŒçš„æ¶ˆè´¹è€…å»å¤„ç†åº“å­˜æ‰£å‡ã€æ”¯ä»˜ã€ç‰©æµç­‰åç»­æµç¨‹ã€‚"')]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafka-ä½¿ç”¨åœºæ™¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafka-ä½¿ç”¨åœºæ™¯"}},[t._v("#")]),t._v(" ğŸ¯ Kafka ä½¿ç”¨åœºæ™¯ ï¼Ÿ")]),t._v(" "),s("ul",[s("li",[t._v("æ¶ˆæ¯ç³»ç»Ÿï¼šè§£è€¦ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ã€ç¼“å­˜æ¶ˆæ¯ç­‰ã€‚")]),t._v(" "),s("li",[t._v("æ—¥å¿—æ”¶é›†ï¼šä¸€ä¸ªå…¬å¸å¯ä»¥ç”¨ Kafka æ”¶é›†å„ç§æœåŠ¡çš„ logï¼Œé€šè¿‡kafkaä»¥ç»Ÿä¸€æ¥å£æœåŠ¡çš„æ–¹å¼å¼€æ”¾ç»™å„ç§consumerï¼Œä¾‹å¦‚hadoopã€HBaseã€Solr ç­‰ã€‚")]),t._v(" "),s("li",[t._v("ç”¨æˆ·æ´»åŠ¨è·Ÿè¸ªï¼šKafka ç»å¸¸è¢«ç”¨æ¥è®°å½• web ç”¨æˆ·æˆ–è€…appç”¨æˆ·çš„å„ç§æ´»åŠ¨ï¼Œå¦‚æµè§ˆç½‘é¡µã€æœç´¢ã€ç‚¹å‡»ç­‰æ´»åŠ¨ï¼Œè¿™äº›æ´»åŠ¨ä¿¡æ¯è¢«å„ä¸ªæœåŠ¡å™¨å‘å¸ƒåˆ°kafkaçš„topicä¸­ï¼Œç„¶åè®¢é˜…è€…é€šè¿‡è®¢é˜…è¿™äº›topicæ¥åšå®æ—¶çš„ç›‘æ§åˆ†æï¼Œæˆ–è€…è£…è½½åˆ°hadoopã€æ•°æ®ä»“åº“ä¸­åšç¦»çº¿åˆ†æå’ŒæŒ–æ˜ã€‚")]),t._v(" "),s("li",[t._v("è¿è¥æŒ‡æ ‡ï¼šKafka ä¹Ÿç»å¸¸ç”¨æ¥è®°å½•è¿è¥ç›‘æ§æ•°æ®ã€‚åŒ…æ‹¬æ”¶é›†å„ç§åˆ†å¸ƒå¼åº”ç”¨çš„æ•°æ®ï¼Œç”Ÿäº§å„ç§æ“ä½œçš„é›†ä¸­åé¦ˆï¼Œæ¯”å¦‚æŠ¥è­¦å’ŒæŠ¥å‘Šã€‚")]),t._v(" "),s("li",[t._v("æµå¼å¤„ç†ï¼šæ¯”å¦‚ spark streaming å’Œ Flink")])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafka-éƒ½æœ‰å“ªäº›ç‰¹ç‚¹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafka-éƒ½æœ‰å“ªäº›ç‰¹ç‚¹"}},[t._v("#")]),t._v(" ğŸ¯ Kafka éƒ½æœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿ")]),t._v(" "),s("ul",[s("li",[t._v("é«˜ååé‡ã€ä½å»¶è¿Ÿï¼škafka æ¯ç§’å¯ä»¥å¤„ç†å‡ åä¸‡æ¡æ¶ˆæ¯ï¼Œå®ƒçš„å»¶è¿Ÿæœ€ä½åªæœ‰å‡ æ¯«ç§’ï¼Œæ¯ä¸ª topic å¯ä»¥åˆ†å¤šä¸ª partitionï¼Œconsumer group å¯¹ partition è¿›è¡Œ consume æ“ä½œã€‚")]),t._v(" "),s("li",[t._v("å¯æ‰©å±•æ€§ï¼škafka é›†ç¾¤æ”¯æŒçƒ­æ‰©å±•")]),t._v(" "),s("li",[t._v("æŒä¹…æ€§ã€å¯é æ€§ï¼šæ¶ˆæ¯è¢«æŒä¹…åŒ–åˆ°æœ¬åœ°ç£ç›˜ï¼Œå¹¶ä¸”æ”¯æŒæ•°æ®å¤‡ä»½é˜²æ­¢æ•°æ®ä¸¢å¤±")]),t._v(" "),s("li",[t._v("å®¹é”™æ€§ï¼šå…è®¸é›†ç¾¤ä¸­èŠ‚ç‚¹å¤±è´¥ï¼ˆè‹¥å‰¯æœ¬æ•°é‡ä¸ºn,åˆ™å…è®¸n-1ä¸ªèŠ‚ç‚¹å¤±è´¥ï¼‰")]),t._v(" "),s("li",[t._v("é«˜å¹¶å‘ï¼šæ”¯æŒæ•°åƒä¸ªå®¢æˆ·ç«¯åŒæ—¶è¯»å†™")])]),t._v(" "),s("blockquote",[s("p",[t._v("é¢è¯•ä¸­è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒç»å…¸çš„é—®é¢˜ï¼Œå°±æ˜¯ä½ ä¸ºä»€ä¹ˆç”¨ Kafkaã€RabbitMQ æˆ– RocketMQï¼Œåˆ æˆ–è€…è¯´ä½ ä¸ºä»€ä¹ˆä½¿ç”¨æŸä¸€ä¸ªä¸­é—´ä»¶ï¼Œè¿™ç§é—®é¢˜è¯¥æ€ä¹ˆå›ç­”å‘¢ï¼Ÿ")])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafka-æ ¸å¿ƒ-api-æœ‰å“ªäº›"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafka-æ ¸å¿ƒ-api-æœ‰å“ªäº›"}},[t._v("#")]),t._v(" ğŸ¯ Kafka æ ¸å¿ƒ API æœ‰å“ªäº›ï¼Ÿ")]),t._v(" "),s("ol",[s("li",[t._v("Producer API å…è®¸åº”ç”¨ç¨‹åºå‘é€æ•°æ®æµåˆ° kafka é›†ç¾¤ä¸­çš„ topic")]),t._v(" "),s("li",[t._v("Consumer API å…è®¸åº”ç”¨ç¨‹åºä» kafka é›†ç¾¤çš„ topic ä¸­è¯»å–æ•°æ®æµ")]),t._v(" "),s("li",[t._v("Streams API å…è®¸ä»è¾“å…¥ topic è½¬æ¢æ•°æ®æµåˆ°è¾“å‡º topic")]),t._v(" "),s("li",[t._v("Connect API ç”¨äºåœ¨ Kafka ä¸å¤–éƒ¨ç³»ç»Ÿä¹‹é—´æ„å»ºæ•°æ®ç®¡é“ã€‚å®ƒæ”¯æŒå¯æ’æ‹”çš„è¿æ¥å™¨ï¼Œç”¨äºå°†æ•°æ®ä»å¤–éƒ¨ç³»ç»Ÿå¯¼å…¥ Kafka æˆ–å°† Kafka æ•°æ®å¯¼å‡ºåˆ°å¤–éƒ¨ç³»ç»Ÿã€‚")]),t._v(" "),s("li",[t._v("Admin API ç”¨äºç®¡ç†å’Œç›‘æ§ Kafka é›†ç¾¤ã€‚å®ƒæä¾›äº†åˆ›å»ºã€åˆ é™¤ä¸»é¢˜ï¼ŒæŸ¥çœ‹ä¸»é¢˜ã€åˆ†åŒºå’Œ Broker ä¿¡æ¯ç­‰åŠŸèƒ½ã€‚")])]),t._v(" "),s("h2",{attrs:{id:"äºŒã€kafkaé«˜æ€§èƒ½åŸç†-ğŸš€"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#äºŒã€kafkaé«˜æ€§èƒ½åŸç†-ğŸš€"}},[t._v("#")]),t._v(" äºŒã€Kafkaé«˜æ€§èƒ½åŸç† ğŸš€")]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafka-çš„è®¾è®¡æ¶æ„ä½ çŸ¥é“å—"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafka-çš„è®¾è®¡æ¶æ„ä½ çŸ¥é“å—"}},[t._v("#")]),t._v(" ğŸ¯ Kafka çš„è®¾è®¡æ¶æ„ä½ çŸ¥é“å—ï¼Ÿ")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://mrbird.cc/img/QQ20200324-210522@2x.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafkaçš„æ ¸å¿ƒç»„ä»¶æœ‰å“ªäº›"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafkaçš„æ ¸å¿ƒç»„ä»¶æœ‰å“ªäº›"}},[t._v("#")]),t._v(" ğŸ¯ Kafkaçš„æ ¸å¿ƒç»„ä»¶æœ‰å“ªäº›ï¼Ÿ")]),t._v(" "),s("p",[t._v("Kafkaä¸»è¦ç»„ä»¶åŠå…¶ä½œç”¨ï¼š")]),t._v(" "),s("p",[s("strong",[t._v("1. Brokerï¼ˆæœåŠ¡èŠ‚ç‚¹ï¼‰")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("Kafkaé›†ç¾¤ä¸­çš„æœåŠ¡å™¨å®ä¾‹")]),t._v(" "),s("li",[t._v("è´Ÿè´£æ¶ˆæ¯å­˜å‚¨ã€è½¬å‘å’Œå‰¯æœ¬ç®¡ç†")]),t._v(" "),s("li",[t._v("æ¯ä¸ªBrokeræœ‰å”¯ä¸€IDæ ‡è¯†")]),t._v(" "),s("li",[t._v("æ”¯æŒåŠ¨æ€åŠ å…¥å’Œé€€å‡ºé›†ç¾¤")])]),t._v(" "),s("p",[s("strong",[t._v("2. Topicï¼ˆä¸»é¢˜ï¼‰")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("æ¶ˆæ¯çš„é€»è¾‘åˆ†ç±»å•ä½")]),t._v(" "),s("li",[t._v("ç±»ä¼¼æ•°æ®åº“ä¸­çš„è¡¨æ¦‚å¿µ")]),t._v(" "),s("li",[t._v("æ”¯æŒå¤šåˆ†åŒºå’Œå‰¯æœ¬é…ç½®")]),t._v(" "),s("li",[t._v("å¯è®¾ç½®ä¿ç•™ç­–ç•¥å’Œæ¸…ç†ç­–ç•¥")])]),t._v(" "),s("p",[s("strong",[t._v("3. Partitionï¼ˆåˆ†åŒºï¼‰")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("Topicçš„ç‰©ç†åˆ†å‰²å•ä½")]),t._v(" "),s("li",[t._v("å®ç°æ¶ˆæ¯å¹¶è¡Œå¤„ç†å’Œè´Ÿè½½åˆ†æ‹…")]),t._v(" "),s("li",[t._v("æ¯ä¸ªåˆ†åŒºå†…æ¶ˆæ¯æœ‰åº")]),t._v(" "),s("li",[t._v("åˆ†åŒºå¯åˆ†å¸ƒåœ¨ä¸åŒBrokerä¸Š")])]),t._v(" "),s("p",[s("strong",[t._v("4. Producerï¼ˆç”Ÿäº§è€…ï¼‰")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("å‘Topicå‘é€æ¶ˆæ¯çš„å®¢æˆ·ç«¯")]),t._v(" "),s("li",[t._v("æ”¯æŒåŒæ­¥å’Œå¼‚æ­¥å‘é€")]),t._v(" "),s("li",[t._v("å¯æŒ‡å®šåˆ†åŒºç­–ç•¥")]),t._v(" "),s("li",[t._v("æ”¯æŒæ‰¹é‡å‘é€å’Œå‹ç¼©")])]),t._v(" "),s("p",[s("strong",[t._v("5. Consumerï¼ˆæ¶ˆè´¹è€…ï¼‰")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("ä»Topicè¯»å–æ¶ˆæ¯çš„å®¢æˆ·ç«¯")]),t._v(" "),s("li",[t._v("ç»´æŠ¤æ¶ˆè´¹ä½ç½®ï¼ˆoffsetï¼‰")]),t._v(" "),s("li",[t._v("æ”¯æŒæ‰‹åŠ¨å’Œè‡ªåŠ¨æäº¤offset")]),t._v(" "),s("li",[t._v("å¯è®¢é˜…å¤šä¸ªTopic")])]),t._v(" "),s("p",[s("strong",[t._v("6. Consumer Groupï¼ˆæ¶ˆè´¹è€…ç»„ï¼‰")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("æ¶ˆè´¹è€…çš„é€»è¾‘åˆ†ç»„")]),t._v(" "),s("li",[t._v("ç»„å†…æ¶ˆè´¹è€…åä½œæ¶ˆè´¹Topic")]),t._v(" "),s("li",[t._v("å®ç°è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»")]),t._v(" "),s("li",[t._v("æ¯ä¸ªåˆ†åŒºåªèƒ½è¢«ç»„å†…ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹")])]),t._v(" "),s("p",[s("strong",[t._v("7. Zookeeper/KRaft")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("é›†ç¾¤åè°ƒå’Œå…ƒæ•°æ®ç®¡ç†")]),t._v(" "),s("li",[t._v("Brokeræ³¨å†Œå’ŒæœåŠ¡å‘ç°")]),t._v(" "),s("li",[t._v("Leaderé€‰ä¸¾å’Œé…ç½®ç®¡ç†")]),t._v(" "),s("li",[t._v("Kafka 2.8+æ”¯æŒKRaftæ¨¡å¼")])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-zookeeper-åœ¨-kafka-ä¸­çš„ä½œç”¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-zookeeper-åœ¨-kafka-ä¸­çš„ä½œç”¨"}},[t._v("#")]),t._v(" ğŸ¯ Zookeeper åœ¨ Kafka ä¸­çš„ä½œç”¨ï¼Ÿ")]),t._v(" "),s("p",[t._v("Zookeeper ä¸»è¦ç”¨äºåœ¨é›†ç¾¤ä¸­ä¸åŒèŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡ã€‚è€ç‰ˆæœ¬çš„ kafka ä¸­ï¼Œåç§»é‡ä¿¡æ¯ä¹Ÿå­˜æ”¾åœ¨ zk ä¸­ã€‚")]),t._v(" "),s("p",[t._v("åœ¨ Kafka ä¸­ï¼Œä¸»è¦è¢«ç”¨äºé›†ç¾¤å…ƒæ•°æ®ç®¡ç†ã€ Brokerç®¡ç†ã€leader æ£€æµ‹ã€åˆ†å¸ƒå¼åŒæ­¥ã€é…ç½®ç®¡ç†ã€è¯†åˆ«æ–°èŠ‚ç‚¹ä½•æ—¶ç¦»å¼€æˆ–è€…è¿æ¥ã€é›†ç¾¤ã€èŠ‚ç‚¹å®æ—¶çŠ¶æ€ç­‰")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("é›†ç¾¤å…ƒæ•°æ®ç®¡ç†")]),t._v(" "),s("p",[t._v("ZooKeeperå­˜å‚¨å’Œç®¡ç†Kafkaé›†ç¾¤çš„å…ƒæ•°æ®ä¿¡æ¯ï¼ŒåŒ…æ‹¬Brokeråˆ—è¡¨ã€ä¸»é¢˜é…ç½®å’Œåˆ†åŒºä¿¡æ¯ã€‚è¿™äº›å…ƒæ•°æ®ç¡®ä¿Kafkaé›†ç¾¤ä¸­çš„å„ä¸ªèŠ‚ç‚¹èƒ½å¤ŸååŒå·¥ä½œï¼Œä¿æŒä¸€è‡´æ€§ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("Brokerç®¡ç†")]),t._v(" "),s("p",[t._v("ZooKeeperç»´æŠ¤Kafkaé›†ç¾¤ä¸­çš„Brokeråˆ—è¡¨ã€‚æ¯ä¸ªBrokerå¯åŠ¨æ—¶ï¼Œä¼šå‘ZooKeeperæ³¨å†Œè‡ªå·±ï¼Œå¹¶å‘¨æœŸæ€§åœ°å‘é€å¿ƒè·³ä¿¡æ¯ã€‚ZooKeeperç›‘æ§è¿™äº›å¿ƒè·³ä¿¡æ¯ï¼Œæ£€æµ‹Brokerçš„çŠ¶æ€ã€‚å¦‚æœæŸä¸ªBrokerå¤±æ•ˆï¼ŒZooKeeperä¼šé€šçŸ¥é›†ç¾¤ä¸­çš„å…¶ä»–ç»„ä»¶ï¼Œä»¥ä¾¿è¿›è¡Œæ•…éšœæ¢å¤ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("åˆ†åŒºLeaderé€‰ä¸¾")]),t._v(" "),s("p",[t._v("Kafkaä¸­çš„æ¯ä¸ªåˆ†åŒºéƒ½æœ‰ä¸€ä¸ªLeaderè´Ÿè´£å¤„ç†æ‰€æœ‰çš„è¯»å†™è¯·æ±‚ï¼Œå…¶ä»–Brokerä½œä¸ºFollowerä»Leaderå¤åˆ¶æ•°æ®ã€‚ZooKeeperè´Ÿè´£ç®¡ç†åˆ†åŒºçš„Leaderé€‰ä¸¾ã€‚å½“Leaderå¤±æ•ˆæ—¶ï¼ŒZooKeeperä¼šè§¦å‘é‡æ–°é€‰ä¸¾ï¼Œç¡®ä¿åˆ†åŒºå§‹ç»ˆæœ‰ä¸€ä¸ªå¯ç”¨çš„Leaderã€‚")])]),t._v(" "),s("li",[s("p",[t._v("æ¶ˆè´¹è€…ç»„åè°ƒ")]),t._v(" "),s("p",[t._v("ZooKeeperç®¡ç†æ¶ˆè´¹è€…ç»„çš„æˆå‘˜ä¿¡æ¯å’Œåç§»é‡ã€‚æ¶ˆè´¹è€…ç»„ä¸­çš„æ¯ä¸ªæ¶ˆè´¹è€…å®ä¾‹å‘ZooKeeperæ³¨å†Œè‡ªå·±ï¼Œå¹¶å®šæœŸå‘é€å¿ƒè·³ä¿¡æ¯ã€‚ZooKeeperæ ¹æ®è¿™äº›ä¿¡æ¯åè°ƒæ¶ˆè´¹è€…ç»„çš„æˆå‘˜ï¼Œç¡®ä¿æ¯ä¸ªåˆ†åŒºçš„æ¶ˆæ¯åªè¢«ä¸€ä¸ªæ¶ˆè´¹è€…å®ä¾‹æ¶ˆè´¹ã€‚åŒæ—¶ï¼ŒZooKeeperè¿˜å­˜å‚¨æ¶ˆè´¹è€…ç»„çš„åç§»é‡ï¼Œä¾¿äºåœ¨æ¶ˆè´¹è€…æ•…éšœæ¢å¤æ—¶ç»§ç»­æ¶ˆè´¹ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("é…ç½®ç®¡ç†")]),t._v(" "),s("p",[t._v("ZooKeeperç”¨äºå­˜å‚¨Kafkaé›†ç¾¤çš„é…ç½®ä¿¡æ¯ã€‚é€šè¿‡ZooKeeperï¼Œå¯ä»¥é›†ä¸­ç®¡ç†å’ŒåŠ¨æ€æ›´æ–°Kafkaçš„é…ç½®ï¼Œè€Œæ— éœ€é‡å¯é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ã€‚")])])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-æ²¡æœ‰-zookeeper-kafka-èƒ½ç”¨å—"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-æ²¡æœ‰-zookeeper-kafka-èƒ½ç”¨å—"}},[t._v("#")]),t._v(" ğŸ¯ æ²¡æœ‰ Zookeeper ï¼Œ Kafka èƒ½ç”¨å—ï¼Ÿ")]),t._v(" "),s("p",[t._v("åœ¨Kafkaçš„ä¼ ç»Ÿæ¶æ„ä¸­ï¼ŒZooKeeperæ˜¯å¿…ä¸å¯å°‘çš„ç»„ä»¶ï¼Œå®ƒè´Ÿè´£é›†ç¾¤çš„ç®¡ç†å’Œåè°ƒä»»åŠ¡ï¼Œå¦‚å…ƒæ•°æ®ç®¡ç†ã€Leaderé€‰ä¸¾å’Œæ¶ˆè´¹è€…ç»„åè°ƒã€‚ç„¶è€Œï¼ŒKafkaå·²ç»é€æ­¥å‡å°‘å¯¹ZooKeeperçš„ä¾èµ–ï¼Œç‰¹åˆ«æ˜¯åœ¨æ–°çš„Kafkaç‰ˆæœ¬ä¸­ï¼Œé€šè¿‡å¼•å…¥Kafka Raftåè®®ï¼ˆKRaftï¼‰ï¼ŒKafkaå¯ä»¥åœ¨æ²¡æœ‰ZooKeeperçš„æƒ…å†µä¸‹è¿è¡Œã€‚")]),t._v(" "),s("p",[s("strong",[t._v("Kafka Raftåè®®ï¼ˆKRaftï¼‰")])]),t._v(" "),s("p",[t._v("Kafka Raftåè®®æ˜¯Kafka 2.8.0ç‰ˆæœ¬å¼•å…¥çš„ï¼Œæ—¨åœ¨ç§»é™¤å¯¹ZooKeeperçš„ä¾èµ–ã€‚KRafté‡‡ç”¨äº†Raftå…±è¯†ç®—æ³•æ¥ç®¡ç†Kafkaé›†ç¾¤çš„å…ƒæ•°æ®å’Œåè°ƒä»»åŠ¡ï¼Œä½¿Kafkaèƒ½å¤Ÿåœ¨æ²¡æœ‰ZooKeeperçš„æƒ…å†µä¸‹ç‹¬ç«‹è¿è¡Œã€‚")]),t._v(" "),s("p",[s("strong",[t._v("KRaftçš„ä¸»è¦ç‰¹æ€§ï¼š")])]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("åˆ†å¸ƒå¼å…±è¯†")]),t._v("ï¼šä½¿ç”¨Raftåè®®å®ç°åˆ†å¸ƒå¼å…±è¯†ï¼Œç¡®ä¿å…ƒæ•°æ®çš„ä¸€è‡´æ€§å’Œå¯é æ€§ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("é«˜å¯ç”¨æ€§")]),t._v("ï¼šé€šè¿‡é€‰ä¸¾Leaderï¼Œä¿è¯å³ä½¿åœ¨èŠ‚ç‚¹æ•…éšœçš„æƒ…å†µä¸‹ï¼Œé›†ç¾¤ä¾ç„¶èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚")]),t._v(" "),s("li",[s("strong",[t._v("ç®€åŒ–æ¶æ„")]),t._v("ï¼šç§»é™¤ZooKeeperåï¼ŒKafkaé›†ç¾¤çš„æ¶æ„å˜å¾—æ›´åŠ ç®€å•ï¼Œéƒ¨ç½²å’Œç®¡ç†ä¹Ÿæ›´åŠ æ–¹ä¾¿ã€‚")])]),t._v(" "),s("p",[s("strong",[t._v("è®¾ç½®KRaftæ¨¡å¼")])]),t._v(" "),s("p",[t._v("ä»¥ä¸‹æ˜¯é…ç½®Kafkaåœ¨KRaftæ¨¡å¼ä¸‹è¿è¡Œçš„åŸºæœ¬æ­¥éª¤ï¼š")]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("é…ç½®æœåŠ¡å™¨å±æ€§")]),t._v("ï¼š åˆ›å»ºä¸€ä¸ªæ–°çš„é…ç½®æ–‡ä»¶"),s("code",[t._v("server.properties")]),t._v("ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹é…ç½®é¡¹ï¼š")]),t._v(" "),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("process.roles")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("controller,broker")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("node.id")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("controller.quorum.voters")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("1@localhost:9093")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("listeners")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("PLAINTEXT://localhost:9092,CONTROLLER://localhost:9093")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("log.dirs")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("/tmp/kraft-combined-logs")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("å¯åŠ¨Kafka")]),t._v("ï¼š ä½¿ç”¨æ–°çš„é…ç½®æ–‡ä»¶å¯åŠ¨Kafkaï¼š")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("bin/kafka-server-start.sh config/server.properties\n")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("åˆå§‹åŒ–å…ƒæ•°æ®")]),t._v("ï¼š åœ¨ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶ï¼Œéœ€è¦åˆå§‹åŒ–å…ƒæ•°æ®ï¼š")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("bin/kafka-storage.sh "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("format")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("uuid"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-c")]),t._v(" config/server.properties\n")])])])])]),t._v(" "),s("p",[s("strong",[t._v("KRaftçš„ä¼˜åŠ¿")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("ç®€åŒ–éƒ¨ç½²")]),t._v("ï¼šå‡å°‘äº†Kafkaé›†ç¾¤çš„ç»„ä»¶æ•°é‡ï¼Œä½¿å¾—éƒ¨ç½²å’Œç®¡ç†å˜å¾—æ›´åŠ ç®€å•ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("é™ä½è¿ç»´æˆæœ¬")]),t._v("ï¼šä¸å†éœ€è¦ç»´æŠ¤ZooKeeperé›†ç¾¤ï¼Œé™ä½äº†è¿ç»´æˆæœ¬å’Œå¤æ‚æ€§ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("æé«˜ç¨³å®šæ€§")]),t._v("ï¼šé€šè¿‡Raftåè®®å®ç°çš„åˆ†å¸ƒå¼å…±è¯†ï¼Œæé«˜äº†ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("ç‰¹æ€§")]),t._v(" "),s("th",[t._v("Zookeeper æ¨¡å¼")]),t._v(" "),s("th",[t._v("KRaft æ¨¡å¼")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("å…ƒæ•°æ®å­˜å‚¨")]),t._v(" "),s("td",[t._v("Zookeeper")]),t._v(" "),s("td",[t._v("Kafka å†…éƒ¨æ—¥å¿—")])]),t._v(" "),s("tr",[s("td",[t._v("ä¸€è‡´æ€§åè®®")]),t._v(" "),s("td",[t._v("ZAB (Zookeeper Atomic Broadcast)")]),t._v(" "),s("td",[t._v("Raft")])]),t._v(" "),s("tr",[s("td",[t._v("ç»„ä»¶å¤æ‚åº¦")]),t._v(" "),s("td",[t._v("éœ€è¦ç»´æŠ¤ Kafka + ZK ä¸¤å¥—é›†ç¾¤")]),t._v(" "),s("td",[t._v("åªéœ€ç»´æŠ¤ Kafka")])]),t._v(" "),s("tr",[s("td",[t._v("è¿ç»´æˆæœ¬")]),t._v(" "),s("td",[t._v("é«˜")]),t._v(" "),s("td",[t._v("ä½")])]),t._v(" "),s("tr",[s("td",[t._v("å…ƒæ•°æ®æ“ä½œå»¶è¿Ÿ")]),t._v(" "),s("td",[t._v("è¾ƒé«˜")]),t._v(" "),s("td",[t._v("æ›´ä½ï¼ˆå†…éƒ¨æ—¥å¿—å†™å…¥ï¼‰")])]),t._v(" "),s("tr",[s("td",[t._v("Kafka ç‰ˆæœ¬æ”¯æŒ")]),t._v(" "),s("td",[t._v("é»˜è®¤ï¼ˆâ‰¤2.8ï¼‰")]),t._v(" "),s("td",[t._v("æ¨èï¼ˆâ‰¥3.3ï¼‰ï¼Œæœªæ¥å”¯ä¸€")])])])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafka-2-8-ç‰ˆæœ¬çš„kraftæ¨¡å¼äº†è§£å—"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafka-2-8-ç‰ˆæœ¬çš„kraftæ¨¡å¼äº†è§£å—"}},[t._v("#")]),t._v(" ğŸ¯ Kafka 2.8+ç‰ˆæœ¬çš„KRaftæ¨¡å¼äº†è§£å—ï¼Ÿ")]),t._v(" "),s("p",[s("strong",[t._v("ä»€ä¹ˆæ˜¯ KRaft æ¨¡å¼ï¼Ÿ")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("KRaftï¼ˆKafka Raft Metadata Modeï¼‰")]),t._v(" æ˜¯ "),s("strong",[t._v("Kafka è‡ªå·±å®ç°çš„å…ƒæ•°æ®ç®¡ç†æœºåˆ¶")]),t._v("ï¼ŒåŸºäº "),s("strong",[t._v("Raft å…±è¯†åè®®")]),t._v("ã€‚")]),t._v(" "),s("li",[t._v("åœ¨ Kafka 2.8.0 é‡Œå¼•å…¥ï¼ˆå®éªŒç‰¹æ€§ï¼‰ï¼Œåœ¨ 3.3+ é‡Œé€æ­¥æ¨èï¼Œæœªæ¥è®¡åˆ’å®Œå…¨å–ä»£ "),s("strong",[t._v("Zookeeper")]),t._v("ã€‚")])]),t._v(" "),s("p",[t._v("ä¼ ç»Ÿ Kafka é›†ç¾¤ä¾èµ– Zookeeper å­˜å‚¨å’Œç®¡ç† "),s("strong",[t._v("å…ƒæ•°æ®ï¼ˆtopicã€åˆ†åŒºã€å‰¯æœ¬ã€å‰¯æœ¬åˆ†é…ï¼‰")]),t._v("ï¼Œå¸¦æ¥äº†ä¸€äº›é—®é¢˜ï¼š")]),t._v(" "),s("ol",[s("li",[t._v("Kafka + Zookeeper åŒé›†ç¾¤è¿ç»´å¤æ‚ï¼ˆä¸¤ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼‰ã€‚")]),t._v(" "),s("li",[t._v("æ•°æ®ä¸€è‡´æ€§å’Œ failover ä¾èµ– Zookeeperï¼Œæ‰©å±•æ€§å—é™ã€‚")]),t._v(" "),s("li",[t._v("è¿ç»´äººå‘˜éœ€è¦ç»´æŠ¤ ZKï¼Œå¢åŠ å¤æ‚åº¦ã€‚")])]),t._v(" "),s("p",[s("strong",[t._v("KRaft æ¨¡å¼çš„ç›®æ ‡")]),t._v("ï¼šå»æ‰ Zookeeperï¼Œè®© Kafka æœ¬èº«é€šè¿‡ "),s("strong",[t._v("Raft åè®®")]),t._v("ç®¡ç†å…ƒæ•°æ®ï¼Œæå‡ä¸€è‡´æ€§å’Œç®€åŒ–è¿ç»´ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("KRaft æ¨¡å¼æ ¸å¿ƒæœºåˆ¶")])]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("å…ƒæ•°æ®ç®¡ç†")]),t._v(" "),s("ul",[s("li",[t._v("KRaft ç”¨ä¸€ä¸ªæ–°çš„ç»„ä»¶ "),s("strong",[t._v("Quorum Controller")]),t._v(" å–ä»£ Zookeeperï¼Œè´Ÿè´£é›†ç¾¤å…ƒæ•°æ®çš„å­˜å‚¨å’Œç®¡ç†ã€‚")]),t._v(" "),s("li",[t._v("å…ƒæ•°æ®å†™å…¥ Kafka å†…éƒ¨çš„ä¸€ä¸ªç‰¹æ®Šæ—¥å¿—ï¼ˆ"),s("code",[t._v("__cluster_metadata")]),t._v(" topicï¼‰ï¼Œä¿è¯å’Œæ™®é€šæ•°æ®ä¸€æ ·çš„é«˜å¯ç”¨ & é¡ºåºæ€§ã€‚")])])]),t._v(" "),s("li",[s("strong",[t._v("ä¸€è‡´æ€§åè®®")]),t._v(" "),s("ul",[s("li",[t._v("ä½¿ç”¨ Raft åè®®ä¿è¯å¤šä¸ª Controller èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ã€‚")]),t._v(" "),s("li",[t._v("é€‰ä¸¾ Leader Controller â†’ æ‰€æœ‰å…ƒæ•°æ®å˜æ›´å¿…é¡»ç»è¿‡ Leader å†™å…¥æ—¥å¿—ï¼ŒFollower å¤åˆ¶ã€‚")])])]),t._v(" "),s("li",[s("strong",[t._v("é›†ç¾¤æ¶æ„")]),t._v(" "),s("ul",[s("li",[t._v("Controller ä¸å†ä¾èµ– Zookeeperï¼Œè€Œæ˜¯å†…ç½®åœ¨ Kafka Broker ä¸­ã€‚")]),t._v(" "),s("li",[t._v("Broker å¯åŠ¨æ—¶å¯ä»¥æ˜¯ "),s("strong",[t._v("Controller")]),t._v(" è§’è‰²ï¼Œä¹Ÿå¯ä»¥æ˜¯æ™®é€š "),s("strong",[t._v("Broker")]),t._v("ã€‚")]),t._v(" "),s("li",[t._v("æœ€ç»ˆå…ƒæ•°æ®å­˜å‚¨åœ¨ Kafka è‡ªå·±çš„æ—¥å¿—æ–‡ä»¶ä¸­ã€‚")])])]),t._v(" "),s("li",[s("strong",[t._v("è¿ç»´ç®€åŒ–")]),t._v(" "),s("ul",[s("li",[t._v("ä¸å†éœ€è¦ç»´æŠ¤ Zookeeper é›†ç¾¤ â†’ åªéœ€è¦ Kafka Broker å³å¯ã€‚")]),t._v(" "),s("li",[t._v("å…ƒæ•°æ®æ“ä½œæ›´å¿«ï¼Œå› ä¸ºçœå»äº†è·¨ç³»ç»Ÿäº¤äº’ã€‚")])])])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafka-åˆ†åŒºçš„ç›®çš„"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafka-åˆ†åŒºçš„ç›®çš„"}},[t._v("#")]),t._v(" ğŸ¯ Kafka åˆ†åŒºçš„ç›®çš„ï¼Ÿ")]),t._v(" "),s("p",[t._v("ç®€è€Œè¨€ä¹‹ï¼š"),s("strong",[s("mark",[t._v("è´Ÿè½½å‡è¡¡+æ°´å¹³æ‰©å±•")])])]),t._v(" "),s("p",[t._v("Topic åªæ˜¯é€»è¾‘æ¦‚å¿µï¼Œé¢å‘çš„æ˜¯ producer å’Œ consumerï¼›è€Œ Partition åˆ™æ˜¯ç‰©ç†æ¦‚å¿µã€‚")]),t._v(" "),s("p",[t._v("åˆ†åŒºå¯¹äº Kafka é›†ç¾¤çš„å¥½å¤„æ˜¯ï¼šå®ç°è´Ÿè½½å‡è¡¡ã€‚åˆ†åŒºå¯¹äºæ¶ˆè´¹è€…æ¥è¯´ï¼Œå¯ä»¥æé«˜å¹¶å‘åº¦ï¼Œæé«˜æ•ˆç‡ã€‚")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://scalac.io/wp-content/uploads/2021/02/kafka-use-cases-3-1030x549.png",alt:"kafka use cases"}})]),t._v(" "),s("blockquote",[s("p",[t._v("å¯ä»¥æƒ³è±¡ï¼Œå¦‚æœ Topic ä¸è¿›è¡Œåˆ†åŒºï¼Œè€Œå°† Topic å†…çš„æ¶ˆæ¯å­˜å‚¨äºä¸€ä¸ª brokerï¼Œé‚£ä¹ˆå…³äºè¯¥ Topic çš„æ‰€æœ‰è¯»å†™è¯·æ±‚éƒ½å°†ç”±è¿™ä¸€ä¸ª broker å¤„ç†ï¼Œååé‡å¾ˆå®¹æ˜“é™·å…¥ç“¶é¢ˆï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸ç¬¦åˆé«˜ååé‡åº”ç”¨åœºæ™¯çš„ã€‚æœ‰äº† Partition æ¦‚å¿µä»¥åï¼Œå‡è®¾ä¸€ä¸ª Topic è¢«åˆ†ä¸º 10 ä¸ª Partitionsï¼ŒKafka ä¼šæ ¹æ®ä¸€å®šçš„ç®—æ³•å°† 10 ä¸ª Partition å°½å¯èƒ½å‡åŒ€çš„åˆ†å¸ƒåˆ°ä¸åŒçš„ brokerï¼ˆæœåŠ¡å™¨ï¼‰ä¸Šï¼Œå½“ producer å‘å¸ƒæ¶ˆæ¯æ—¶ï¼Œproducer å®¢æˆ·ç«¯å¯ä»¥é‡‡ç”¨ "),s("code",[t._v("random")]),t._v("ã€"),s("code",[t._v("key-hash")]),t._v(" åŠ "),s("code",[t._v("è½®è¯¢")]),t._v(" ç­‰ç®—æ³•é€‰å®šç›®æ ‡ partitionï¼Œè‹¥ä¸æŒ‡å®šï¼ŒKafka ä¹Ÿå°†æ ¹æ®ä¸€å®šç®—æ³•å°†å…¶ç½®äºæŸä¸€åˆ†åŒºä¸Šã€‚Partiton æœºåˆ¶å¯ä»¥æå¤§çš„æé«˜ååé‡ï¼Œå¹¶ä¸”ä½¿å¾—ç³»ç»Ÿå…·å¤‡è‰¯å¥½çš„æ°´å¹³æ‰©å±•èƒ½åŠ›ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafkaçš„åˆ†åŒºç­–ç•¥æœ‰å“ªäº›"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafkaçš„åˆ†åŒºç­–ç•¥æœ‰å“ªäº›"}},[t._v("#")]),t._v(" ğŸ¯ Kafkaçš„åˆ†åŒºç­–ç•¥æœ‰å“ªäº›ï¼Ÿ")]),t._v(" "),s("p",[t._v('"Kafkaä¸»è¦æœ‰ä»¥ä¸‹åˆ†åŒºç­–ç•¥ï¼š')]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("è½®è¯¢åˆ†åŒº")]),t._v("ï¼šé»˜è®¤ç­–ç•¥ï¼Œæ¶ˆæ¯å‡åŒ€åˆ†å¸ƒåˆ°å„ä¸ªåˆ†åŒº")]),t._v(" "),s("li",[s("strong",[t._v("Keyå“ˆå¸Œåˆ†åŒº")]),t._v("ï¼šæ ¹æ®æ¶ˆæ¯çš„keyè¿›è¡Œhashï¼Œç›¸åŒkeyçš„æ¶ˆæ¯ä¼šè·¯ç”±åˆ°åŒä¸€åˆ†åŒº")]),t._v(" "),s("li",[s("strong",[t._v("è‡ªå®šä¹‰åˆ†åŒº")]),t._v("ï¼šå®ç°Partitioneræ¥å£ï¼Œè‡ªå®šä¹‰åˆ†åŒºé€»è¾‘")])]),t._v(" "),s("p",[t._v("åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("å¯¹äºç”¨æˆ·è¡Œä¸ºæ—¥å¿—ï¼Œä½¿ç”¨è½®è¯¢åˆ†åŒºä¿è¯è´Ÿè½½å‡è¡¡")]),t._v(" "),s("li",[t._v("å¯¹äºè®¢å•æ¶ˆæ¯ï¼Œä½¿ç”¨ç”¨æˆ·IDä½œä¸ºkeyè¿›è¡Œå“ˆå¸Œåˆ†åŒºï¼Œç¡®ä¿åŒä¸€ç”¨æˆ·çš„è®¢å•æœ‰åºå¤„ç†â€")])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafkaçš„å­˜å‚¨æœºåˆ¶æ˜¯æ€æ ·çš„"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafkaçš„å­˜å‚¨æœºåˆ¶æ˜¯æ€æ ·çš„"}},[t._v("#")]),t._v(" ğŸ¯ Kafkaçš„å­˜å‚¨æœºåˆ¶æ˜¯æ€æ ·çš„ï¼Ÿ")]),t._v(" "),s("p",[t._v('"Kafkaçš„å­˜å‚¨é‡‡ç”¨åˆ†æ®µæ–‡ä»¶å­˜å‚¨ï¼š')]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("Log Segment")]),t._v("ï¼šæ¯ä¸ªåˆ†åŒºç”±å¤šä¸ªæ®µæ–‡ä»¶ç»„æˆï¼Œé»˜è®¤1GBæˆ–7å¤©åˆ‡åˆ†ä¸€ä¸ªæ–°æ®µ")]),t._v(" "),s("li",[s("strong",[t._v("é¡ºåºå†™å…¥")]),t._v("ï¼šæ‰€æœ‰å†™å…¥éƒ½æ˜¯é¡ºåºè¿½åŠ ï¼Œå……åˆ†åˆ©ç”¨ç£ç›˜é¡ºåºIOæ€§èƒ½")]),t._v(" "),s("li",[s("strong",[t._v("é›¶æ‹·è´")]),t._v("ï¼šé€šè¿‡sendfileç³»ç»Ÿè°ƒç”¨å®ç°é›¶æ‹·è´ï¼Œå‡å°‘æ•°æ®åœ¨å†…æ ¸å’Œç”¨æˆ·æ€ä¹‹é—´çš„æ‹·è´")]),t._v(" "),s("li",[s("strong",[t._v("é¡µç¼“å­˜")]),t._v("ï¼šå……åˆ†åˆ©ç”¨æ“ä½œç³»ç»Ÿçš„é¡µç¼“å­˜æœºåˆ¶")])]),t._v(" "),s("p",[t._v("è¿™ç§è®¾è®¡ä½¿å¾—Kafkaå…·æœ‰å¾ˆé«˜çš„ååé‡ã€‚åœ¨æˆ‘ä»¬çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé€šè¿‡ç›‘æ§å‘ç°ç£ç›˜IOä¸»è¦æ˜¯é¡ºåºå†™å…¥ï¼ŒCPUä½¿ç”¨ç‡ä¹Ÿä¿æŒåœ¨è¾ƒä½æ°´å¹³ã€‚â€")]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-ä¸ºä»€ä¹ˆä¸èƒ½ä»¥-partition-ä½œä¸ºå­˜å‚¨å•ä½-è¿˜è¦åŠ ä¸ª-segment"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-ä¸ºä»€ä¹ˆä¸èƒ½ä»¥-partition-ä½œä¸ºå­˜å‚¨å•ä½-è¿˜è¦åŠ ä¸ª-segment"}},[t._v("#")]),t._v(" ğŸ¯ ä¸ºä»€ä¹ˆä¸èƒ½ä»¥ partition ä½œä¸ºå­˜å‚¨å•ä½ï¼Ÿè¿˜è¦åŠ ä¸ª segmentï¼Ÿ")]),t._v(" "),s("p",[t._v("åœ¨Apache Kafkaä¸­ï¼Œè™½ç„¶Partitionæ˜¯é€»è¾‘ä¸Šçš„å­˜å‚¨å•å…ƒï¼Œä½†åœ¨ç‰©ç†å­˜å‚¨å±‚é¢ä¸Šï¼ŒKafkaå°†æ¯ä¸ªPartitionåˆ’åˆ†ä¸ºå¤šä¸ªSegmentã€‚è¿™ç§è®¾è®¡æœ‰å‡ ä¸ªé‡è¦çš„åŸå› ï¼Œä¸»è¦åŒ…æ‹¬ç®¡ç†ã€æ€§èƒ½å’Œæ•°æ®æ¢å¤ç­‰æ–¹é¢çš„è€ƒè™‘ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("1ã€æ˜“äºç®¡ç†")])]),t._v(" "),s("p",[t._v("â€‹\tå°†Partitionåˆ’åˆ†ä¸ºå¤šä¸ªSegmentä½¿å¾—Kafkaåœ¨ç®¡ç†æ—¥å¿—æ–‡ä»¶æ—¶æ›´åŠ çµæ´»ï¼š")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("æ—¥å¿—æ»šåŠ¨ï¼šé€šè¿‡Segmentï¼ŒKafkaå¯ä»¥å®ç°æ—¥å¿—æ»šåŠ¨ç­–ç•¥ï¼Œä¾‹å¦‚æŒ‰æ—¶é—´æˆ–æ–‡ä»¶å¤§å°è¿›è¡Œæ»šåŠ¨ï¼Œåˆ é™¤æ—§çš„Segmentæ–‡ä»¶ä»¥é‡Šæ”¾å­˜å‚¨ç©ºé—´ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("æ–‡ä»¶å¤§å°é™åˆ¶ï¼šå•ä¸ªå¤§çš„æ—¥å¿—æ–‡ä»¶éš¾ä»¥ç®¡ç†å’Œæ“ä½œï¼Œè€Œå°†å…¶åˆ’åˆ†ä¸ºå¤šä¸ªè¾ƒå°çš„Segmentæ–‡ä»¶ï¼Œä¾¿äºè¿›è¡Œæ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼Œå¦‚ç§»åŠ¨ã€åˆ é™¤å’Œå‹ç¼©ã€‚")])])]),t._v(" "),s("p",[s("strong",[t._v("2ã€æ€§èƒ½ä¼˜åŒ–")])]),t._v(" "),s("p",[t._v("Segmentæœ‰åŠ©äºæå‡Kafkaçš„æ€§èƒ½ï¼Œå°¤å…¶æ˜¯åœ¨æ•°æ®å†™å…¥å’Œè¯»å–æ–¹é¢ï¼š")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("é¡ºåºå†™å…¥")]),t._v("ï¼šKafkaé€šè¿‡é¡ºåºå†™å…¥Segmentæ–‡ä»¶æ¥ä¼˜åŒ–ç£ç›˜å†™å…¥æ€§èƒ½ï¼Œé¿å…éšæœºå†™å…¥çš„å¼€é”€ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("é«˜æ•ˆè¯»å–")]),t._v("ï¼šåˆ†æ®µå­˜å‚¨å…è®¸Kafkaåœ¨è¯»å–æ•°æ®æ—¶æ›´æœ‰æ•ˆåœ°åˆ©ç”¨ç£ç›˜ç¼“å­˜ï¼Œå¹¶å¯ä»¥é€šè¿‡ç´¢å¼•å¿«é€Ÿå®šä½Segmentæ–‡ä»¶ä¸­çš„æ•°æ®ä½ç½®ï¼Œæå‡è¯»å–æ•ˆç‡ã€‚")])]),t._v(" "),s("p",[s("strong",[t._v("3ã€æ•°æ®æ¢å¤å’Œå‰¯æœ¬åŒæ­¥")])]),t._v(" "),s("p",[t._v("â€‹\tSegmentçš„å¼•å…¥ç®€åŒ–äº†æ•°æ®æ¢å¤å’Œå‰¯æœ¬åŒæ­¥è¿‡ç¨‹ï¼š")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("æ•°æ®æ¢å¤")]),t._v("ï¼šåœ¨å‘ç”Ÿæ•…éšœæ—¶ï¼ŒKafkaåªéœ€è¦æ¢å¤å—å½±å“çš„Segmentæ–‡ä»¶ï¼Œè€Œä¸æ˜¯æ•´ä¸ªPartitionï¼Œä»è€ŒåŠ å¿«æ•°æ®æ¢å¤é€Ÿåº¦ã€‚")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("å‰¯æœ¬åŒæ­¥")]),t._v("ï¼šå½“å‰¯æœ¬ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥æ—¶ï¼ŒSegmentçº§åˆ«çš„æ“ä½œä½¿å¾—Kafkaèƒ½å¤Ÿä»…åŒæ­¥æœ€è¿‘æ›´æ–°çš„Segmentï¼Œè€Œä¸æ˜¯æ•´ä¸ªPartitionçš„æ•°æ®ï¼Œå‡å°‘ç½‘ç»œå¸¦å®½çš„ä½¿ç”¨å’ŒåŒæ­¥æ—¶é—´ã€‚")])])]),t._v(" "),s("p",[s("strong",[t._v("4ã€é«˜æ•ˆçš„åƒåœ¾å›æ”¶")])]),t._v(" "),s("p",[t._v("â€‹\tSegmentä½¿å¾—Kafkaèƒ½å¤Ÿæ›´é«˜æ•ˆåœ°è¿›è¡Œåƒåœ¾å›æ”¶ï¼š")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("æ—¥å¿—æ¸…ç†")]),t._v("ï¼šKafkaçš„æ—¥å¿—æ¸…ç†ç­–ç•¥å¯ä»¥åœ¨Segmentçº§åˆ«è¿›è¡Œï¼Œåˆ é™¤æˆ–å‹ç¼©æ—§çš„Segmentæ–‡ä»¶ï¼Œè€Œä¸å½±å“æ­£åœ¨ä½¿ç”¨çš„Segmentã€‚")]),t._v(" "),s("li",[s("strong",[t._v("TTLç®¡ç†")]),t._v("ï¼šKafkaå¯ä»¥åŸºäºSegmentå®ç°TTLï¼ˆTime-to-Liveï¼‰ç®¡ç†ï¼Œåœ¨è¾¾åˆ°æŒ‡å®šä¿ç•™æ—¶é—´ååˆ é™¤æ—§çš„Segmentæ–‡ä»¶ï¼Œä»è€Œæ§åˆ¶ç£ç›˜ç©ºé—´çš„ä½¿ç”¨ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-segment-çš„å·¥ä½œåŸç†æ˜¯æ€æ ·çš„"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-segment-çš„å·¥ä½œåŸç†æ˜¯æ€æ ·çš„"}},[t._v("#")]),t._v(" ğŸ¯ segment çš„å·¥ä½œåŸç†æ˜¯æ€æ ·çš„ï¼Ÿ")]),t._v(" "),s("p",[t._v("segment æ–‡ä»¶ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«ä¸º â€œ.indexâ€ æ–‡ä»¶å’Œ â€œ.logâ€ æ–‡ä»¶ï¼Œåˆ†åˆ«è¡¨ç¤ºä¸º segment ç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶ã€‚")]),t._v(" "),s("p",[t._v("è¿™ä¸¤ä¸ªæ–‡ä»¶çš„å‘½ä»¤è§„åˆ™ä¸ºï¼špartition å…¨å±€çš„ç¬¬ä¸€ä¸ª segment ä» 0 å¼€å§‹ï¼Œåç»­æ¯ä¸ª segment æ–‡ä»¶åä¸ºä¸Šä¸€ä¸ª segment æ–‡ä»¶æœ€åä¸€æ¡æ¶ˆæ¯çš„ offset å€¼ï¼Œæ•°å€¼å¤§å°ä¸º 64 ä½ï¼Œ20 ä½æ•°å­—å­—ç¬¦é•¿åº¦ï¼Œæ²¡æœ‰æ•°å­—ç”¨ 0 å¡«å……")]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-å¦‚æœæˆ‘æŒ‡å®šäº†ä¸€ä¸ªoffset-kafka-æ€ä¹ˆæŸ¥æ‰¾åˆ°å¯¹åº”çš„æ¶ˆæ¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-å¦‚æœæˆ‘æŒ‡å®šäº†ä¸€ä¸ªoffset-kafka-æ€ä¹ˆæŸ¥æ‰¾åˆ°å¯¹åº”çš„æ¶ˆæ¯"}},[t._v("#")]),t._v(" ğŸ¯ å¦‚æœæˆ‘æŒ‡å®šäº†ä¸€ä¸ªoffsetï¼Œkafka æ€ä¹ˆæŸ¥æ‰¾åˆ°å¯¹åº”çš„æ¶ˆæ¯ï¼Ÿ")]),t._v(" "),s("p",[t._v("åœ¨Kafkaä¸­ï¼Œæ¯ä¸ªæ¶ˆæ¯éƒ½è¢«åˆ†é…äº†ä¸€ä¸ªå”¯ä¸€çš„åç§»é‡ï¼ˆoffsetï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªè¿ç»­çš„æ•´æ•°ï¼Œè¡¨ç¤ºæ¶ˆæ¯åœ¨æ—¥å¿—ä¸­çš„ä½ç½®ã€‚å½“ä½ æŒ‡å®šä¸€ä¸ªåç§»é‡å¹¶æƒ³è¦æŸ¥æ‰¾å¯¹åº”çš„æ¶ˆæ¯æ—¶ï¼ŒKafka ä¼šè¿›è¡Œä»¥ä¸‹æ“ä½œï¼š")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("ç¡®å®šåˆ†åŒº")]),t._v("ï¼šé¦–å…ˆï¼Œéœ€è¦ç¡®å®šåç§»é‡æ‰€å±çš„åˆ†åŒºã€‚Kafka é€šè¿‡ä¸»é¢˜å’Œåˆ†åŒºçš„ç»„åˆæ¥å”¯ä¸€ç¡®å®šæ¶ˆæ¯ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("æŸ¥æ‰¾ç´¢å¼•")]),t._v("ï¼šKafka ä¸ºæ¯ä¸ªåˆ†åŒºç»´æŠ¤äº†ä¸€ä¸ªç´¢å¼•ï¼Œè¿™ä¸ªç´¢å¼•å…è®¸å®ƒå¿«é€ŸæŸ¥æ‰¾ç»™å®šåç§»é‡çš„ä½ç½®ã€‚è¿™ä¸ªç´¢å¼•é€šå¸¸æ˜¯ç¨€ç–çš„ï¼Œä»¥å‡å°‘å†…å­˜ä½¿ç”¨ï¼Œå¹¶å­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("ç¡®å®šç‰©ç†ä½ç½®")]),t._v("ï¼šä½¿ç”¨ç´¢å¼•ï¼ŒKafka å¯ä»¥å¿«é€Ÿå®šä½åˆ°åŒ…å«ç›®æ ‡åç§»é‡æ¶ˆæ¯çš„ç‰©ç†æ–‡ä»¶ï¼ˆå³æ—¥å¿—æ–‡ä»¶ï¼‰å’Œæ–‡ä»¶å†…çš„å¤§è‡´ä½ç½®ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("è¯»å–æ¶ˆæ¯")]),t._v("ï¼šä¸€æ—¦ç¡®å®šäº†ç‰©ç†ä½ç½®ï¼ŒKafka ä¼šä»ç£ç›˜è¯»å–åŒ…å«è¯¥åç§»é‡çš„æ¶ˆæ¯ã€‚å¦‚æœæ–‡ä»¶å¾ˆå¤§ï¼ŒKafka ä¼šå°è¯•ç›´æ¥å®šä½åˆ°æ¶ˆæ¯çš„èµ·å§‹ä½ç½®ï¼Œå¦åˆ™å¯èƒ½éœ€è¦é¡ºåºæ‰«æåˆ°è¯¥ä½ç½®ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("è¿”å›æ¶ˆæ¯")]),t._v("ï¼šæ‰¾åˆ°æŒ‡å®šåç§»é‡çš„æ¶ˆæ¯åï¼ŒKafka å°†å…¶è¿”å›ç»™è¯·æ±‚è€…ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafka-é«˜æ•ˆæ–‡ä»¶å­˜å‚¨è®¾è®¡ç‰¹ç‚¹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafka-é«˜æ•ˆæ–‡ä»¶å­˜å‚¨è®¾è®¡ç‰¹ç‚¹"}},[t._v("#")]),t._v(" ğŸ¯ Kafka é«˜æ•ˆæ–‡ä»¶å­˜å‚¨è®¾è®¡ç‰¹ç‚¹?")]),t._v(" "),s("ul",[s("li",[t._v("Kafka æŠŠ topic ä¸­ä¸€ä¸ª partition å¤§æ–‡ä»¶åˆ†æˆå¤šä¸ªå°æ–‡ä»¶æ®µï¼Œé€šè¿‡å¤šä¸ªå°æ–‡ä»¶æ®µï¼Œå°±å®¹æ˜“å®šæœŸæ¸…é™¤æˆ–åˆ é™¤å·²ç»æ¶ˆè´¹å®Œæ–‡ä»¶ï¼Œå‡å°‘ç£ç›˜å ç”¨ã€‚")]),t._v(" "),s("li",[t._v("é€šè¿‡ç´¢å¼•ä¿¡æ¯å¯ä»¥å¿«é€Ÿå®šä½ message å’Œç¡®å®š response çš„æœ€å¤§å¤§å°ã€‚")]),t._v(" "),s("li",[t._v("é€šè¿‡ index å…ƒæ•°æ®å…¨éƒ¨æ˜ å°„åˆ° memoryï¼Œå¯ä»¥é¿å… segment file çš„ IO ç£ç›˜æ“ä½œã€‚")]),t._v(" "),s("li",[t._v("é€šè¿‡ç´¢å¼•æ–‡ä»¶ç¨€ç–å­˜å‚¨ï¼Œå¯ä»¥å¤§å¹…é™ä½ index æ–‡ä»¶å…ƒæ•°æ®å ç”¨ç©ºé—´å¤§å°")])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafkaæ˜¯å¦‚ä½•ä¿è¯é«˜å¯ç”¨çš„"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafkaæ˜¯å¦‚ä½•ä¿è¯é«˜å¯ç”¨çš„"}},[t._v("#")]),t._v(" ğŸ¯ Kafkaæ˜¯å¦‚ä½•ä¿è¯é«˜å¯ç”¨çš„ï¼Ÿ")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("åˆ†åŒºå‰¯æœ¬æœºåˆ¶")]),t._v("ï¼šæ¯ä¸ªåˆ†åŒºæœ‰å¤šä¸ªå‰¯æœ¬ï¼ˆreplicaï¼‰ï¼Œåˆ†å¸ƒåœ¨ä¸åŒçš„Brokerä¸Š")]),t._v(" "),s("li",[s("strong",[t._v("Leader-Followeræ¨¡å¼")]),t._v("ï¼šæ¯ä¸ªåˆ†åŒºæœ‰ä¸€ä¸ªLeaderè´Ÿè´£è¯»å†™ï¼ŒFollowerè´Ÿè´£å¤‡ä»½")]),t._v(" "),s("li",[s("strong",[t._v("ISRæœºåˆ¶")]),t._v("ï¼šIn-Sync Replicasï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§")]),t._v(" "),s("li",[s("strong",[t._v("Controlleré€‰ä¸¾")]),t._v("ï¼šé›†ç¾¤ä¸­æœ‰ä¸€ä¸ª Controller è´Ÿè´£ç®¡ç†åˆ†åŒºå’Œå‰¯æœ¬çŠ¶æ€")])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-å¦‚ä½•æé«˜kafkaçš„æ€§èƒ½"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-å¦‚ä½•æé«˜kafkaçš„æ€§èƒ½"}},[t._v("#")]),t._v(" ğŸ¯ å¦‚ä½•æé«˜Kafkaçš„æ€§èƒ½ï¼Ÿ")]),t._v(" "),s("p",[t._v('"æˆ‘ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡ŒKafkaæ€§èƒ½ä¼˜åŒ–ï¼š')]),t._v(" "),s("p",[s("strong",[t._v("ç”Ÿäº§è€…ç«¯ä¼˜åŒ–ï¼š")])]),t._v(" "),s("ul",[s("li",[t._v("æ‰¹é‡å‘é€ï¼šè°ƒæ•´batch.sizeå’Œlinger.mså‚æ•°")]),t._v(" "),s("li",[t._v("å‹ç¼©ï¼šå¯ç”¨å‹ç¼©ç®—æ³•ï¼ˆå¦‚snappyã€lz4ï¼‰")]),t._v(" "),s("li",[t._v("å¼‚æ­¥å‘é€ï¼šä½¿ç”¨å¼‚æ­¥æ¨¡å¼å‡å°‘å»¶è¿Ÿ")]),t._v(" "),s("li",[t._v("å†…å­˜é…ç½®ï¼šè°ƒæ•´buffer.memory")])]),t._v(" "),s("p",[s("strong",[t._v("æ¶ˆè´¹è€…ç«¯ä¼˜åŒ–ï¼š")])]),t._v(" "),s("ul",[s("li",[t._v("æ‰¹é‡æ‹‰å–ï¼šè°ƒæ•´fetch.min.byteså’Œfetch.max.wait.ms")]),t._v(" "),s("li",[t._v("å¤šçº¿ç¨‹æ¶ˆè´¹ï¼šä¸€ä¸ªConsumer Groupå†…å¤šä¸ªConsumerå¹¶è¡Œæ¶ˆè´¹")]),t._v(" "),s("li",[t._v("æ‰‹åŠ¨æäº¤ï¼šä½¿ç”¨æ‰‹åŠ¨æäº¤offsetï¼Œé¿å…é‡å¤æ¶ˆè´¹")])]),t._v(" "),s("p",[s("strong",[t._v("Brokerç«¯ä¼˜åŒ–ï¼š")])]),t._v(" "),s("ul",[s("li",[t._v("ç£ç›˜ä¼˜åŒ–ï¼šä½¿ç”¨SSDï¼Œé…ç½®åˆé€‚çš„æ–‡ä»¶ç³»ç»Ÿ")]),t._v(" "),s("li",[t._v("ç½‘ç»œä¼˜åŒ–ï¼šè°ƒæ•´socket.send.buffer.bytesç­‰å‚æ•°")]),t._v(" "),s("li",[t._v("JVMè°ƒä¼˜ï¼šé…ç½®åˆé€‚çš„å †å†…å­˜å¤§å°å’ŒGCç­–ç•¥")])]),t._v(" "),s("p",[t._v("åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œé€šè¿‡è¿™äº›ä¼˜åŒ–ï¼Œå•æœºååé‡ä»10ä¸‡QPSæå‡åˆ°äº†50ä¸‡QPSã€‚â€")]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafkaä¸ºä»€ä¹ˆèƒ½åšåˆ°å¦‚æ­¤é«˜çš„ååé‡-æ ¸å¿ƒæŠ€æœ¯åŸç†æ˜¯ä»€ä¹ˆ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafkaä¸ºä»€ä¹ˆèƒ½åšåˆ°å¦‚æ­¤é«˜çš„ååé‡-æ ¸å¿ƒæŠ€æœ¯åŸç†æ˜¯ä»€ä¹ˆ"}},[t._v("#")]),t._v(" ğŸ¯ Kafkaä¸ºä»€ä¹ˆèƒ½åšåˆ°å¦‚æ­¤é«˜çš„ååé‡ï¼Ÿæ ¸å¿ƒæŠ€æœ¯åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ")]),t._v(" "),s("p",[t._v('"è¿™æ˜¯Kafkaæœ€ä»¤äººå°è±¡æ·±åˆ»çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œå•æœºèƒ½è½»æ¾åšåˆ°ç™¾ä¸‡çº§QPSï¼Œæˆ‘æ¥ç³»ç»Ÿåœ°åˆ†æä¸€ä¸‹é«˜ååé‡çš„æ ¸å¿ƒæŠ€æœ¯åŸç†ï¼š')]),t._v(" "),s("p",[s("strong",[t._v("ğŸš€ æ ¸å¿ƒæŠ€æœ¯æ¶æ„å›¾ï¼š")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("[ç”Ÿäº§è€…æ‰¹é‡å‘é€] â†’ [é¡ºåºå†™å…¥ç£ç›˜] â†’ [é›¶æ‹·è´ä¼ è¾“] â†’ [æ¶ˆè´¹è€…å¹¶è¡Œæ¶ˆè´¹]\n       â†“              â†“              â†“              â†“\n   å‡å°‘ç½‘ç»œå¼€é”€    å……åˆ†åˆ©ç”¨ç£ç›˜    é¿å…CPUæ‹·è´    åˆ†åŒºå¹¶è¡Œå¤„ç†\n")])])]),s("p",[s("strong",[t._v("1. æ‰¹é‡å¤„ç†æœºåˆ¶ï¼ˆBatchingï¼‰")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç”Ÿäº§è€…æ‰¹é‡é…ç½®")]),t._v("\nprops"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"batch.size"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16384")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 16KBæ‰¹æ¬¡å¤§å°")]),t._v("\nprops"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"linger.ms"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("           "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç­‰å¾…5msæ”¶é›†æ›´å¤šæ¶ˆæ¯")]),t._v("\nprops"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"buffer.memory"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("33554432")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 32MBå‘é€ç¼“å†²åŒº")]),t._v("\n")])])]),s("ul",[s("li",[s("strong",[t._v("åŸç†")]),t._v("ï¼šå°†å¤šæ¡æ¶ˆæ¯æ‰“åŒ…æˆä¸€ä¸ªæ‰¹æ¬¡å‘é€")]),t._v(" "),s("li",[s("strong",[t._v("æ•ˆæœ")]),t._v("ï¼šç½‘ç»œè°ƒç”¨æ¬¡æ•°å‡å°‘90%ï¼Œååé‡æå‡5-10å€")]),t._v(" "),s("li",[s("strong",[t._v("æƒè¡¡")]),t._v("ï¼šslightå»¶è¿Ÿå¢åŠ æ¢å–å·¨å¤§ååé‡æå‡")])]),t._v(" "),s("p",[s("strong",[t._v("2. åˆ†åŒºå¹¶è¡Œæ¶æ„ï¼ˆPartitioningï¼‰")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Topic: user-events (6ä¸ªåˆ†åŒº)\nPartition 0: [æ¶ˆæ¯1, æ¶ˆæ¯4, æ¶ˆæ¯7...] â†’ Consumer A\nPartition 1: [æ¶ˆæ¯2, æ¶ˆæ¯5, æ¶ˆæ¯8...] â†’ Consumer B  \nPartition 2: [æ¶ˆæ¯3, æ¶ˆæ¯6, æ¶ˆæ¯9...] â†’ Consumer C\n")])])]),s("ul",[s("li",[s("strong",[t._v("å¹¶è¡Œå†™å…¥")]),t._v("ï¼š6ä¸ªåˆ†åŒº = 6å€å¹¶è¡Œå†™å…¥èƒ½åŠ›")]),t._v(" "),s("li",[s("strong",[t._v("å¹¶è¡Œæ¶ˆè´¹")]),t._v("ï¼š6ä¸ªæ¶ˆè´¹è€…åŒæ—¶å¤„ç†ï¼Œçº¿æ€§æ‰©å±•")]),t._v(" "),s("li",[s("strong",[t._v("è´Ÿè½½åˆ†æ•£")]),t._v("ï¼šåˆ†åŒºåˆ†å¸ƒåœ¨ä¸åŒBrokerï¼Œé¿å…çƒ­ç‚¹")])]),t._v(" "),s("p",[s("strong",[t._v("3. é¡ºåºå†™å…¥ä¼˜åŒ–ï¼ˆSequential I/Oï¼‰")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("éšæœºå†™å…¥ï¼š1000 IOPS Ã— 4KB = 4MB/s\né¡ºåºå†™å…¥ï¼šç£ç›˜ååé‡å¯è¾¾ 200MB/s+\næ€§èƒ½å·®è·ï¼š50å€ä»¥ä¸Šï¼\n")])])]),s("ul",[s("li",[s("strong",[t._v("WALæœºåˆ¶")]),t._v("ï¼šæ¯ä¸ªåˆ†åŒºä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œåªåšappendæ“ä½œ")]),t._v(" "),s("li",[s("strong",[t._v("å……åˆ†åˆ©ç”¨ç£ç›˜ç‰¹æ€§")]),t._v("ï¼šé¡ºåºå†™å…¥æ¥è¿‘å†…å­˜æ€§èƒ½")]),t._v(" "),s("li",[s("strong",[t._v("é¿å…éšæœºI/O")]),t._v("ï¼šä¸éœ€è¦ç»´æŠ¤å¤æ‚çš„ç´¢å¼•ç»“æ„")])]),t._v(" "),s("p",[s("strong",[t._v("4. é›¶æ‹·è´æŠ€æœ¯ï¼ˆZero Copyï¼‰")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("ä¼ ç»Ÿæ–¹å¼ï¼šç£ç›˜â†’å†…æ ¸â†’ç”¨æˆ·æ€â†’å†…æ ¸â†’ç½‘å¡ (4æ¬¡æ‹·è´)\né›¶æ‹·è´ï¼š  ç£ç›˜â†’å†…æ ¸â†’ç½‘å¡ (2æ¬¡DMAæ‹·è´ï¼Œ0æ¬¡CPUæ‹·è´)\næ€§èƒ½æå‡ï¼šCPUä½¿ç”¨ç‡é™ä½60%ï¼Œååé‡æå‡100%+\n")])])]),s("p",[s("strong",[t._v("5. Page Cacheå……åˆ†åˆ©ç”¨")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Kafkaå……åˆ†åˆ©ç”¨æ“ä½œç³»ç»Ÿé¡µç¼“å­˜")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å†™å…¥æ—¶ï¼šæ•°æ®å†™åˆ°PageCacheï¼ŒOSå¼‚æ­¥åˆ·ç›˜")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¯»å–æ—¶ï¼šä¼˜å…ˆä»PageCacheè¯»å–ï¼Œé¿å…ç£ç›˜I/O")]),t._v("\n")])])]),s("ul",[s("li",[s("strong",[t._v("å†™å…¥ä¼˜åŒ–")]),t._v("ï¼šå†™PageCacheå‡ ä¹ç­‰äºå†…å­˜å†™å…¥")]),t._v(" "),s("li",[s("strong",[t._v("è¯»å–ä¼˜åŒ–")]),t._v("ï¼šçƒ­ç‚¹æ•°æ®ç›´æ¥ä»å†…å­˜è¯»å–")]),t._v(" "),s("li",[s("strong",[t._v("å‡è½»GCå‹åŠ›")]),t._v("ï¼šä½¿ç”¨å †å¤–å†…å­˜ï¼Œå‡å°‘Java GCå½±å“")])]),t._v(" "),s("p",[s("strong",[t._v("6. ç½‘ç»œæ¨¡å‹ä¼˜åŒ–ï¼ˆReactoræ¨¡å¼ï¼‰")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("[Acceptorçº¿ç¨‹] â†’ [Processorçº¿ç¨‹æ± ] â†’ [Handlerçº¿ç¨‹æ± ]\n     â†“              â†“                â†“\n   æ¥æ”¶è¿æ¥        I/Oå¤„ç†           ä¸šåŠ¡å¤„ç†\n")])])]),s("ul",[s("li",[s("strong",[t._v("éé˜»å¡I/O")]),t._v("ï¼šåŸºäºNIOï¼Œå•çº¿ç¨‹å¤„ç†åƒä¸‡çº§è¿æ¥")]),t._v(" "),s("li",[s("strong",[t._v("å¤šè·¯å¤ç”¨")]),t._v("ï¼šä¸€ä¸ªçº¿ç¨‹ç®¡ç†å¤šä¸ªè¿æ¥")]),t._v(" "),s("li",[s("strong",[t._v("çº¿ç¨‹åˆ†ç¦»")]),t._v("ï¼šI/Oå’Œä¸šåŠ¡å¤„ç†åˆ†ç¦»ï¼Œæé«˜å¹¶å‘")])]),t._v(" "),s("p",[s("strong",[t._v("7. å‹ç¼©ç®—æ³•ä¼˜åŒ–")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä¸åŒå‹ç¼©ç®—æ³•æ€§èƒ½å¯¹æ¯”")]),t._v("\nprops"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"compression.type"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"snappy"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ¨è")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// snappy: å‹ç¼©æ¯”3:1ï¼ŒCPUæ¶ˆè€—ä½")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// lz4:    å‹ç¼©æ¯”2.5:1ï¼Œé€Ÿåº¦æœ€å¿«  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// gzip:   å‹ç¼©æ¯”5:1ï¼ŒCPUæ¶ˆè€—é«˜")]),t._v("\n")])])]),s("p",[s("strong",[t._v("ğŸ”¥ å®é™…æ€§èƒ½æ•°æ®å¯¹æ¯”ï¼š")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("ä¼˜åŒ–æŠ€æœ¯")]),t._v(" "),s("th",[t._v("ä¼˜åŒ–å‰")]),t._v(" "),s("th",[t._v("ä¼˜åŒ–å")]),t._v(" "),s("th",[t._v("æå‡æ¯”ä¾‹")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("æ‰¹é‡å‘é€")]),t._v(" "),s("td",[t._v("1ä¸‡QPS")]),t._v(" "),s("td",[t._v("10ä¸‡QPS")]),t._v(" "),s("td",[t._v("10å€")])]),t._v(" "),s("tr",[s("td",[t._v("åˆ†åŒºå¹¶è¡Œ")]),t._v(" "),s("td",[t._v("10ä¸‡QPS")]),t._v(" "),s("td",[t._v("60ä¸‡QPS")]),t._v(" "),s("td",[t._v("6å€")])]),t._v(" "),s("tr",[s("td",[t._v("é›¶æ‹·è´")]),t._v(" "),s("td",[t._v("60ä¸‡QPS")]),t._v(" "),s("td",[t._v("100ä¸‡QPS")]),t._v(" "),s("td",[t._v("67%")])]),t._v(" "),s("tr",[s("td",[t._v("å‹ç¼©ä¼˜åŒ–")]),t._v(" "),s("td",[t._v("100ä¸‡QPS")]),t._v(" "),s("td",[t._v("150ä¸‡QPS")]),t._v(" "),s("td",[t._v("50%")])])])]),t._v(" "),s("p",[s("strong",[t._v("ğŸ¯ ä¸å…¶ä»–MQçš„æ€§èƒ½å¯¹æ¯”ï¼š")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Kafka:     100ä¸‡+ QPS (å•æœº)\nRabbitMQ:  4ä¸‡QPS (å•æœº)  \nActiveMQ:  2ä¸‡QPS (å•æœº)\nRocketMQ:  10ä¸‡QPS (å•æœº)\n")])])]),s("p",[s("strong",[t._v("ä¸ºä»€ä¹ˆå·®è·è¿™ä¹ˆå¤§ï¼Ÿ")])]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("è®¾è®¡å“²å­¦ä¸åŒ")]),t._v("ï¼šKafkaä¸“ä¸ºé«˜ååé‡è®¾è®¡ï¼Œå…¶ä»–MQæ›´æ³¨é‡åŠŸèƒ½ä¸°å¯Œæ€§")]),t._v(" "),s("li",[s("strong",[t._v("å­˜å‚¨æ–¹å¼ä¸åŒ")]),t._v("ï¼šKafkaåŸºäºæ–‡ä»¶ç³»ç»Ÿï¼Œå…¶ä»–MQå¤šåŸºäºå†…å­˜+æ•°æ®åº“")]),t._v(" "),s("li",[s("strong",[t._v("åè®®å¤æ‚åº¦")]),t._v("ï¼šKafkaåè®®ç›¸å¯¹ç®€å•ï¼Œå‡å°‘äº†åè®®å¼€é”€")])]),t._v(" "),s("p",[s("strong",[t._v("åœ¨æˆ‘ä»¬çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼š")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("ç”µå•†ç§’æ€åœºæ™¯")]),t._v("ï¼šå³°å€¼200ä¸‡QPSï¼ŒKafkaé›†ç¾¤è½»æ¾åº”å¯¹")]),t._v(" "),s("li",[s("strong",[t._v("ç”¨æˆ·è¡Œä¸ºæ—¥å¿—")]),t._v("ï¼šæ¯å¤©å¤„ç†1000äº¿æ¡æ¶ˆæ¯ï¼Œå»¶è¿Ÿä¿æŒåœ¨10msä»¥å†…")]),t._v(" "),s("li",[s("strong",[t._v("å®æ—¶æ•°æ®åŒæ­¥")]),t._v("ï¼šå¤šä¸ªæ•°æ®ä¸­å¿ƒé—´åŒæ­¥ï¼Œç½‘ç»œå¸¦å®½è·‘æ»¡ä¾ç„¶ç¨³å®š")])]),t._v(" "),s("p",[s("strong",[t._v("å…³é”®ç›‘æ§æŒ‡æ ‡ï¼š")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ååé‡ç›‘æ§")]),t._v("\nBytesInPerSec: 800MB/s\nBytesOutPerSec: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(".2GB/s\nMessagesInPerSec: "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1,500")]),t._v(",000/s\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å»¶è¿Ÿç›‘æ§  ")]),t._v("\nProduceRequestTimeMs: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("avg")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("2ms, "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("99th")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("15ms\nFetchRequestTimeMs: "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("avg")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("1ms, "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("99th")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("8ms\n")])])]),s("p",[t._v('è¿™äº›æŠ€æœ¯çš„å®Œç¾ç»“åˆï¼Œè®©Kafkaåœ¨å¤§æ•°æ®æ—¶ä»£æˆä¸ºäº†äº‹å®ä¸Šçš„æ ‡å‡†æ¶ˆæ¯ä¸­é—´ä»¶ï¼"')]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"ä¸‰ã€-ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…-ğŸ‘¥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ä¸‰ã€-ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…-ğŸ‘¥"}},[t._v("#")]),t._v(" ä¸‰ã€ ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€… ğŸ‘¥")]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafkaæ¶ˆæ¯æ˜¯é‡‡ç”¨-pull-æ¨¡å¼-è¿˜æ˜¯-push-æ¨¡å¼"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafkaæ¶ˆæ¯æ˜¯é‡‡ç”¨-pull-æ¨¡å¼-è¿˜æ˜¯-push-æ¨¡å¼"}},[t._v("#")]),t._v(" ğŸ¯ Kafkaæ¶ˆæ¯æ˜¯é‡‡ç”¨ Pull æ¨¡å¼ï¼Œè¿˜æ˜¯ Push æ¨¡å¼ï¼Ÿ")]),t._v(" "),s("p",[t._v("producer å°†æ¶ˆæ¯æ¨é€åˆ° brokerï¼Œconsumer ä» broker æ‹‰å–æ¶ˆæ¯ã€‚")]),t._v(" "),s("p",[t._v("æ¶ˆè´¹è€…é‡‡ç”¨ pull çš„æ¨¡å¼çš„å¥½å¤„å°±æ˜¯æ¶ˆè´¹é€Ÿç‡å¯ä»¥è‡ªè¡Œæ§åˆ¶ï¼Œå¯ä»¥æŒ‰è‡ªå·±çš„æ¶ˆè´¹èƒ½åŠ›å†³å®šæ˜¯å¦æ¶ˆè´¹ç­–ç•¥ï¼ˆæ˜¯å¦æ‰¹é‡ç­‰ï¼‰")]),t._v(" "),s("p",[t._v("æœ‰ä¸ªç¼ºç‚¹æ˜¯ï¼Œå¦‚æœæ²¡æœ‰æ¶ˆæ¯å¯ä¾›æ¶ˆè´¹æ˜¯ï¼Œconsumer ä¹Ÿéœ€è¦ä¸æ–­åœ¨å¾ªç¯ä¸­è½®è®­ç­‰æ¶ˆæ¯çš„åˆ°è¾¾ï¼Œæ‰€ä»¥ kafka ä¸ºäº†é¿å…è¿™ç‚¹ï¼Œæä¾›äº†é˜»å¡å¼ç­‰æ–°æ¶ˆæ¯ã€‚")]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafka-æ¶ˆè´¹è€…æ˜¯å¦å¯ä»¥æ¶ˆè´¹æŒ‡å®šåˆ†åŒºæ¶ˆæ¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafka-æ¶ˆè´¹è€…æ˜¯å¦å¯ä»¥æ¶ˆè´¹æŒ‡å®šåˆ†åŒºæ¶ˆæ¯"}},[t._v("#")]),t._v(" ğŸ¯ Kafka æ¶ˆè´¹è€…æ˜¯å¦å¯ä»¥æ¶ˆè´¹æŒ‡å®šåˆ†åŒºæ¶ˆæ¯ï¼Ÿ")]),t._v(" "),s("p",[s("strong",[t._v("Kafka æ¶ˆè´¹è€…å¯ä»¥æ¶ˆè´¹æŒ‡å®šåˆ†åŒºçš„æ¶ˆæ¯ã€‚")]),t._v(" è¿™ç§æ“ä½œç§°ä¸º"),s("strong",[t._v("åˆ†é…åˆ†åŒºæ¶ˆè´¹ï¼ˆPartition Assignmentï¼‰")]),t._v("ï¼ŒKafka æä¾›äº†å¤šç§æ–¹å¼æ¥å®ç°å¯¹æŒ‡å®šåˆ†åŒºçš„æ¶ˆæ¯æ¶ˆè´¹ã€‚")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("é»˜è®¤æ¶ˆè´¹æ–¹å¼ï¼ˆæ¶ˆè´¹è€…ç»„æ¨¡å¼ï¼‰")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("åœ¨ Kafka ä¸­ï¼Œæ¶ˆè´¹è€…é€šå¸¸å±äºæŸä¸ª"),s("strong",[t._v("æ¶ˆè´¹è€…ç»„")]),t._v("ï¼ˆConsumer Groupï¼‰ï¼Œç”± Kafka çš„"),s("strong",[t._v("åˆ†åŒºåˆ†é…ç­–ç•¥")]),t._v("ï¼ˆPartition Assignment Strategyï¼‰è´Ÿè´£è‡ªåŠ¨å°† Topic çš„åˆ†åŒºåˆ†é…ç»™ç»„å†…çš„æ¶ˆè´¹è€…ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("æ¶ˆè´¹è€…ç»„ä¸­çš„æ¶ˆè´¹è€…å…±äº« Topic çš„åˆ†åŒºã€‚")]),t._v(" "),s("li",[t._v("Kafka è‡ªåŠ¨å¹³è¡¡åˆ†åŒºçš„åˆ†é…ï¼Œæ¶ˆè´¹è€…"),s("strong",[t._v("æ— æ³•ç›´æ¥æŒ‡å®šæ¶ˆè´¹æŸä¸ªåˆ†åŒº")]),t._v("ã€‚")])])])])]),t._v(" "),s("li",[s("p",[t._v("æ‰‹åŠ¨åˆ†é…æ¶ˆè´¹åˆ†åŒº")]),t._v(" "),s("p",[t._v("Kafka æä¾›äº†æ‰‹åŠ¨æŒ‡å®šæ¶ˆè´¹åˆ†åŒºçš„èƒ½åŠ›ï¼Œè¿™ç§æ–¹å¼å…è®¸æ¶ˆè´¹è€…ç›´æ¥æ¶ˆè´¹æŒ‡å®šçš„åˆ†åŒºï¼Œè€Œä¸ä¾èµ– Kafka çš„è‡ªåŠ¨åˆ†åŒºåˆ†é…æœºåˆ¶ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("æ–¹æ³•ï¼šä½¿ç”¨ "),s("code",[t._v("assign")]),t._v(" æ–¹æ³•")]),t._v("ï¼šKafka Consumer API æä¾›äº† "),s("code",[t._v("assign")]),t._v(" æ–¹æ³•ï¼Œå…è®¸æ¶ˆè´¹è€…æ‰‹åŠ¨è®¢é˜…ç‰¹å®šçš„åˆ†åŒºã€‚")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SpecificPartitionConsumer")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// é…ç½® Kafka æ¶ˆè´¹è€…å±æ€§")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Properties")]),t._v(" props "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Properties")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bootstrap.servers"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost:9092"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"group.id"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test-group"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"key.deserializer"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"org.apache.kafka.common.serialization.StringDeserializer"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"value.deserializer"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"org.apache.kafka.common.serialization.StringDeserializer"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KafkaConsumer")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" consumer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KafkaConsumer")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ‰‹åŠ¨æŒ‡å®šè¦æ¶ˆè´¹çš„åˆ†åŒº")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TopicPartition")]),t._v(" partition "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TopicPartition")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"my-topic"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æŒ‡å®š Topic å’Œåˆ†åŒº")]),t._v("\n       "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//ä½¿ç”¨ `assign` æ–¹æ³•å°†æ¶ˆè´¹è€…ç»‘å®šåˆ°ç‰¹å®šåˆ†åŒº  ")]),t._v("\n      \tconsumer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("assign")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Collections")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("singletonList")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("partition"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¼€å§‹æ¶ˆè´¹æŒ‡å®šåˆ†åŒºçš„æ¶ˆæ¯")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerRecords")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" records "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" consumer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("poll")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Duration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ofMillis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerRecord")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" record "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" records"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Offset = %d, Key = %s, Value = %s%n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                        record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("offset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("æŒ‡å®šåˆ†åŒºå¹¶æŒ‡å®šåç§»é‡")]),t._v(" "),s("p",[t._v("é™¤äº†æ‰‹åŠ¨åˆ†é…åˆ†åŒºï¼ŒKafka è¿˜å…è®¸æ¶ˆè´¹è€…"),s("strong",[t._v("ä»æŒ‡å®šåˆ†åŒºçš„ç‰¹å®šåç§»é‡å¼€å§‹æ¶ˆè´¹")]),t._v("ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("æ–¹æ³•ï¼šä½¿ç”¨ "),s("code",[t._v("seek")]),t._v(" æ–¹æ³•")])]),t._v(" "),s("ul",[s("li",[t._v("åœ¨è°ƒç”¨ "),s("code",[t._v("assign")]),t._v(" æ–¹æ³•åˆ†é…åˆ†åŒºåï¼Œå¯ä»¥é€šè¿‡ "),s("code",[t._v("seek")]),t._v(" æ–¹æ³•æŒ‡å®šä»åˆ†åŒºçš„å“ªä¸ªåç§»é‡å¼€å§‹æ¶ˆè´¹ã€‚")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TopicPartition")]),t._v(" partition "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TopicPartition")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"my-topic"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsumer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("assign")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Collections")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("singletonList")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("partition"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æŒ‡å®šä»åç§»é‡ 50 å¼€å§‹æ¶ˆè´¹")]),t._v("\nconsumer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("seek")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("partition"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¼€å§‹æ¶ˆè´¹")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerRecords")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" records "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" consumer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("poll")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Duration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ofMillis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerRecord")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" record "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" records"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Offset = %d, Key = %s, Value = %s%n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("offset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-ä¸ºä»€ä¹ˆè¦æœ‰æ¶ˆè´¹è€…ç»„-æ¶ˆè´¹è€…å’Œæ¶ˆè´¹è€…ç»„æœ‰ä»€ä¹ˆå…³ç³»"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-ä¸ºä»€ä¹ˆè¦æœ‰æ¶ˆè´¹è€…ç»„-æ¶ˆè´¹è€…å’Œæ¶ˆè´¹è€…ç»„æœ‰ä»€ä¹ˆå…³ç³»"}},[t._v("#")]),t._v(" ğŸ¯ ä¸ºä»€ä¹ˆè¦æœ‰æ¶ˆè´¹è€…ç»„ | æ¶ˆè´¹è€…å’Œæ¶ˆè´¹è€…ç»„æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ")]),t._v(" "),s("p",[s("strong",[t._v("Consumer Group æ˜¯ Kafka æä¾›çš„å¯æ‰©å±•ä¸”å…·æœ‰å®¹é”™æ€§çš„æ¶ˆè´¹è€…æœºåˆ¶")]),t._v("ã€‚")]),t._v(" "),s("p",[t._v("æ—¢ç„¶æ˜¯ä¸€ä¸ªç»„ï¼Œé‚£ä¹ˆç»„å†…å¿…ç„¶å¯ä»¥æœ‰å¤šä¸ªæ¶ˆè´¹è€…æˆ–æ¶ˆè´¹è€…å®ä¾‹ï¼ˆConsumer Instanceï¼‰ï¼Œå®ƒä»¬å…±äº«ä¸€ä¸ªå…¬å…±çš„ IDï¼Œè¿™ä¸ª ID è¢«ç§°ä¸º Group IDã€‚ç»„å†…çš„æ‰€æœ‰æ¶ˆè´¹è€…åè°ƒåœ¨ä¸€èµ·æ¥æ¶ˆè´¹è®¢é˜…ä¸»é¢˜ï¼ˆSubscribed Topicsï¼‰çš„æ‰€æœ‰åˆ†åŒºï¼ˆPartitionï¼‰ã€‚å½“ç„¶ï¼Œæ¯ä¸ªåˆ†åŒºåªèƒ½ç”±åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„å†…çš„ä¸€ä¸ª Consumer å®ä¾‹æ¥æ¶ˆè´¹ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("æ¶ˆè´¹è€…ç»„æœ€ä¸ºé‡è¦çš„ä¸€ä¸ªåŠŸèƒ½æ˜¯å®ç°å¹¿æ’­ä¸å•æ’­çš„åŠŸèƒ½")]),t._v("ã€‚ä¸€ä¸ªæ¶ˆè´¹è€…ç»„å¯ä»¥ç¡®ä¿å…¶æ‰€è®¢é˜…çš„ Topic çš„æ¯ä¸ªåˆ†åŒºåªèƒ½è¢«ä»å±äºè¯¥æ¶ˆè´¹è€…ç»„ä¸­çš„å”¯ä¸€ä¸€ä¸ªæ¶ˆè´¹è€…æ‰€æ¶ˆè´¹ï¼›å¦‚æœä¸åŒçš„æ¶ˆè´¹è€…ç»„è®¢é˜…äº†åŒä¸€ä¸ª Topicï¼Œé‚£ä¹ˆè¿™äº›æ¶ˆè´¹è€…ç»„ä¹‹é—´æ˜¯å½¼æ­¤ç‹¬ç«‹çš„ï¼Œä¸ä¼šå—åˆ°ç›¸äº’çš„å¹²æ‰°ã€‚")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://quarkus.io/guides/images/kafka-one-app-two-consumers.png",alt:"Architecture"}})]),t._v(" "),s("p",[s("strong",[t._v("ä¸ºä»€ä¹ˆè¦æœ‰æ¶ˆè´¹è€…ç»„")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("æœ¬è´¨ï¼šæ¶ˆè´¹è€…ç»„=æ¨ªå‘æ‰©å±•+æ•…éšœè½¬ç§»+å¤šè·¯ç‹¬ç«‹æ¶ˆè´¹ã€‚ç»„å†…åšåˆ°â€œåŒåˆ†åŒºåªè¢«ä¸€ä¸ªå®ä¾‹æ¶ˆè´¹â€ï¼Œä¸åŒç»„å½¼æ­¤ç‹¬ç«‹æ¶ˆè´¹åŒä¸€ä»½æ•°æ®ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("ä»·å€¼ï¼šè½»æ¾æ‰©å®¹ååï¼ˆå¢åŠ å®ä¾‹å³å¯ï¼‰ã€å®ä¾‹æ•…éšœè‡ªåŠ¨è½¬ç§»ã€æ”¯æŒä¸€ä»½æ•°æ®è¢«é£æ§/ç”»åƒ/æŠ¥è¡¨ç­‰å¤šä¸ªç³»ç»Ÿå¹¶è¡Œç‹¬ç«‹æ¶ˆè´¹ã€‚")])])]),t._v(" "),s("p",[s("strong",[t._v("åˆ†åŒºåˆ†é…æ€ä¹ˆåš")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("å…¸å‹ç­–ç•¥ï¼ˆæŒ‰éœ€é€‰æ‹©ï¼‰ï¼š")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("RangeAssignorï¼šæŒ‰åˆ†åŒºèŒƒå›´è¿ç»­åˆ†é…ï¼Œç®€å•ä½†æ˜“ä¸å‡è¡¡ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("RoundRobinAssignorï¼šè½®è¯¢å‡è¡¡ï¼Œæ›´å¹³å‡ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("StickyAssignorï¼šç²˜æ€§åˆ†é…ï¼Œæå¤§å‡å°‘é‡åˆ†é…çš„åˆ†åŒºè¿ç§»ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("CooperativeStickyAssignorï¼šååŒç²˜æ€§ï¼Œå¢é‡å†å‡è¡¡ï¼Œé¿å…â€œåœâ€”å…¨é‡â€”å¯â€æŠ–åŠ¨ï¼ˆæ¨èï¼‰ã€‚")])])])]),t._v(" "),s("li",[s("p",[t._v("ç¨³å®šæ€§é…ç½®ï¼š")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("partition.assignment.strategy=org.apache.kafka.clients.consumer.CooperativeStickyAssignor")])]),t._v(" "),s("li",[s("p",[t._v("é™æ€æˆå‘˜ï¼šgroup.instance.id=order-c1ï¼ˆå®¹å™¨é‡å¯ä¹Ÿä¸è§¦å‘å…¨é‡rebalanceï¼‰")])]),t._v(" "),s("li",[s("p",[t._v("æŒ‡å®šåˆ†åŒºï¼ˆå¿…è¦æ—¶ï¼‰ï¼šæ‰‹åŠ¨assignç²¾å‡†æ§åˆ¶çƒ­ç‚¹")])])])])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-rebalanceä¼šæ€æ ·"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-rebalanceä¼šæ€æ ·"}},[t._v("#")]),t._v(" ğŸ¯ Rebalanceä¼šæ€æ ·ï¼Ÿ")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("è§¦å‘æ—¶æœºï¼šå®ä¾‹åŠ å…¥/ç¦»å¼€ã€å¿ƒè·³è¶…æ—¶ã€è®¢é˜…å˜åŒ–ã€ä¸»é¢˜åˆ†åŒºå˜åŒ–ã€max.poll.interval.msè¶…æ—¶ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("å½±å“ï¼šåˆ†åŒºçŸ­æš‚æ’¤é”€â†’ååæŠ–åŠ¨â†’é‡å¤æ¶ˆè´¹é£é™©ï¼ˆè‹¥æœªå¦¥å–„æäº¤ï¼‰â†’å»¶è¿Ÿä¸Šå‡ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("æˆ‘çš„æŠ‘åˆ¶æ‰‹æ®µï¼š")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("å‡çº§ååŒç²˜æ€§åˆ†é…ï¼›å¯ç”¨é™æ€æˆå‘˜ï¼›æ§åˆ¶å¿ƒè·³ä¸ä¼šè¯ï¼š")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("session.timeout.msã€heartbeat.interval.ms åˆç†é…å¯¹ï¼ˆå¿ƒè·³â‰ˆä¼šè¯çš„1/3ï¼‰")])]),t._v(" "),s("li",[s("p",[t._v("max.poll.interval.ms > ä¸šåŠ¡æœ€é•¿å¤„ç†æ—¶é—´")])])])]),t._v(" "),s("li",[s("p",[t._v("åœ¨â€œæ’¤é”€å›è°ƒâ€é‡Œå…ˆæäº¤å·²å¤„ç†offsetï¼Œé¿å…é‡å¤ï¼›åœ¨â€œåˆ†é…å›è°ƒâ€é‡Œæ¢å¤çŠ¶æ€ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("é•¿ä»»åŠ¡ç”¨æœ¬åœ°å·¥ä½œé˜Ÿåˆ—æˆ–å¼‚æ­¥çº¿ç¨‹ï¼Œé¿å…é˜»å¡pollã€‚")])])])])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-æ¶ˆæ¯è¯­ä¹‰ä½ çŸ¥é“å“ªäº›å’‹å®ç°çš„ä¸"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-æ¶ˆæ¯è¯­ä¹‰ä½ çŸ¥é“å“ªäº›å’‹å®ç°çš„ä¸"}},[t._v("#")]),t._v(" ğŸ¯ æ¶ˆæ¯è¯­ä¹‰ä½ çŸ¥é“å“ªäº›å’‹å®ç°çš„ä¸ï¼Ÿ")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("è‡³å¤šä¸€æ¬¡ï¼ˆAt-most-onceï¼‰ï¼šå…ˆæäº¤offsetå†å¤„ç†ã€‚å¿«ï¼Œä½†å¯èƒ½ä¸¢æ¶ˆæ¯ã€‚ä¸å»ºè®®ç”¨äºå…³é”®è·¯å¾„ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("è‡³å°‘ä¸€æ¬¡ï¼ˆAt-least-onceï¼‰ï¼šå…ˆå¤„ç†å†æäº¤offsetã€‚å¯é ä½†å¯èƒ½é‡å¤ã€‚é€šè¿‡å¹‚ç­‰æ¶ˆè´¹/å»é‡å…œåº•ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("ä¸šåŠ¡å¹‚ç­‰é”®ï¼ˆè®¢å•å·/äº‹ä»¶IDï¼‰ã€DBå”¯ä¸€é”®/ä¹è§‚é”ã€Rediså¸ƒéš†/å»é‡çª—å£ã€‚")])])]),t._v(" "),s("li",[s("p",[t._v("ç²¾ç¡®ä¸€æ¬¡ï¼ˆExactly-onceï¼‰ï¼šåœ¨Kafkaå†…é“¾è·¯è¾¾æˆâ€œè¯»-å¤„ç†-å†™â€åŸå­æ€§ï¼š")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("ç”Ÿäº§ç«¯ï¼šenable.idempotence=trueï¼›transactional.id=stable-idï¼›max.in.flight.requests.per.connection=1ï¼ˆéœ€å¼ºé¡ºåºæ—¶ï¼‰")])]),t._v(" "),s("li",[s("p",[t._v("å¤„ç†é“¾è·¯ï¼šbeginTransaction â†’ å¤„ç†å¹¶å‘ä¸‹æ¸¸topic send â†’ sendOffsetsToTransaction â†’ commitTransaction")])]),t._v(" "),s("li",[s("p",[t._v("æ¶ˆè´¹ç«¯ï¼šisolation.level=read_committed")])]),t._v(" "),s("li",[s("p",[t._v("è·¨å¤–éƒ¨ç³»ç»Ÿï¼šé…åˆäº‹åŠ¡å¤–å‘/Outboxæ¨¡å¼ï¼Œæˆ–æœ€ç»ˆä¸€è‡´æ€§+å¯¹è´¦è¡¥")])])])])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafka-çš„æ¯ä¸ªåˆ†åŒºåªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹æ¶ˆè´¹-å¦‚ä½•åšåˆ°å¤šä¸ªçº¿ç¨‹åŒæ—¶æ¶ˆè´¹ä¸€ä¸ªåˆ†åŒº"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafka-çš„æ¯ä¸ªåˆ†åŒºåªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹æ¶ˆè´¹-å¦‚ä½•åšåˆ°å¤šä¸ªçº¿ç¨‹åŒæ—¶æ¶ˆè´¹ä¸€ä¸ªåˆ†åŒº"}},[t._v("#")]),t._v(" ğŸ¯ Kafka çš„æ¯ä¸ªåˆ†åŒºåªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹æ¶ˆè´¹ï¼Œå¦‚ä½•åšåˆ°å¤šä¸ªçº¿ç¨‹åŒæ—¶æ¶ˆè´¹ä¸€ä¸ªåˆ†åŒºï¼Ÿ")]),t._v(" "),s("p",[t._v("åœ¨Kafkaä¸­ï¼Œæ¯ä¸ªåˆ†åŒºåªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹æ¶ˆè´¹ï¼Œä»¥ä¿è¯æ¶ˆæ¯å¤„ç†çš„é¡ºåºæ€§ã€‚ç„¶è€Œï¼Œæœ‰æ—¶éœ€è¦é€šè¿‡å¤šçº¿ç¨‹æ¥æé«˜å•ä¸ªåˆ†åŒºçš„æ¶ˆè´¹é€Ÿåº¦ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥åœ¨æ¶ˆè´¹è€…åº”ç”¨ç¨‹åºä¸­å®ç°å¤šçº¿ç¨‹å¤„ç†ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„æ–¹æ³•ï¼š")]),t._v(" "),s("p",[s("strong",[t._v("æ–¹æ³•ä¸€ï¼šå¤šçº¿ç¨‹æ¶ˆè´¹å¤„ç†")])]),t._v(" "),s("p",[t._v("è¿™ç§æ–¹æ³•é€šè¿‡åœ¨å•ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ä¸­è¯»å–æ¶ˆæ¯ï¼Œç„¶åå°†æ¶ˆæ¯åˆ†å‘åˆ°å¤šä¸ªå·¥ä½œçº¿ç¨‹è¿›è¡Œå¤„ç†ã€‚è¿™æ ·ï¼Œè™½ç„¶æ¶ˆæ¯çš„æ¶ˆè´¹æ˜¯å•çº¿ç¨‹çš„ï¼Œä½†å¤„ç†æ˜¯å¤šçº¿ç¨‹çš„ã€‚")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MultithreadedConsumer")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NUM_WORKER_THREADS")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Properties")]),t._v(" props "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Properties")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("BOOTSTRAP_SERVERS_CONFIG")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost:9092"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GROUP_ID_CONFIG")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test-group"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("KEY_DESERIALIZER_CLASS_CONFIG")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"org.apache.kafka.common.serialization.StringDeserializer"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("VALUE_DESERIALIZER_CLASS_CONFIG")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"org.apache.kafka.common.serialization.StringDeserializer"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KafkaConsumer")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" consumer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KafkaConsumer")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        consumer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("subscribe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Arrays")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("asList")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"my-topic"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExecutorService")]),t._v(" executorService "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Executors")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("newFixedThreadPool")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NUM_WORKER_THREADS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerRecords")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" records "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" consumer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("poll")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Duration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ofMillis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerRecord")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" record "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" records"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    executorService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("submit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("processRecord")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            consumer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            executorService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("shutdown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("processRecord")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerRecord")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"offset = %d, key = %s, value = %s%n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("offset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Add your processing logic here")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("strong",[t._v("æ–¹æ³•äºŒï¼šä½¿ç”¨Kafka Connectå’ŒKStreams")])]),t._v(" "),s("p",[t._v("Kafka Connectå’ŒKStreamsæ˜¯Kafkaç”Ÿæ€ç³»ç»Ÿä¸­çš„ä¸¤ä¸ªå·¥å…·ï¼Œå¯ä»¥å¸®åŠ©å®ç°å¤šçº¿ç¨‹æ¶ˆè´¹ã€‚")]),t._v(" "),s("ul",[s("li",[t._v("Kafka Connectæ˜¯ç”¨äºå¤§è§„æ¨¡æ•°æ®å¯¼å…¥å’Œå¯¼å‡ºçš„æ¡†æ¶ï¼Œå…·æœ‰å†…ç½®çš„å¹¶è¡Œå¤„ç†èƒ½åŠ›ã€‚")]),t._v(" "),s("li",[t._v("Kafka Streamsæä¾›äº†æµå¤„ç†çš„æŠ½è±¡ï¼Œå¯ä»¥åœ¨æµå¤„ç†ä¸­å¹¶è¡Œå¤„ç†æ•°æ®ã€‚")])]),t._v(" "),s("p",[s("strong",[t._v("æ–¹æ³•ä¸‰ï¼šæ‰‹åŠ¨ç®¡ç†åç§»é‡")])]),t._v(" "),s("p",[t._v("é€šè¿‡æ‰‹åŠ¨ç®¡ç†åç§»é‡ï¼Œå¯ä»¥å®ç°æ›´çµæ´»çš„å¤šçº¿ç¨‹æ¶ˆè´¹ã€‚")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MultithreadedConsumerWithManualOffset")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NUM_WORKER_THREADS")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExecutorService")]),t._v(" executorService "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Executors")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("newFixedThreadPool")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NUM_WORKER_THREADS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Properties")]),t._v(" props "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Properties")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("BOOTSTRAP_SERVERS_CONFIG")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"localhost:9092"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("GROUP_ID_CONFIG")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test-group"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ENABLE_AUTO_COMMIT_CONFIG")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"false"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("KEY_DESERIALIZER_CLASS_CONFIG")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"org.apache.kafka.common.serialization.StringDeserializer"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("VALUE_DESERIALIZER_CLASS_CONFIG")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"org.apache.kafka.common.serialization.StringDeserializer"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KafkaConsumer")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" consumer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KafkaConsumer")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        consumer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("subscribe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Arrays")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("asList")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"my-topic"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerRecords")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" records "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" consumer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("poll")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Duration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ofMillis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Future")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" futures "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ArrayList")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerRecord")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" record "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" records"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    futures"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("executorService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("submit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("processRecord")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Wait for all tasks to complete")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Future")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" future "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" futures"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    future"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n                "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Commit offsets after processing")]),t._v("\n                consumer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("commitSync")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("finally")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            consumer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("close")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            executorService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("shutdown")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("processRecord")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerRecord")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("printf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"offset = %d, key = %s, value = %s%n"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("offset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Add your processing logic here")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("strong",[t._v("æ³¨æ„äº‹é¡¹")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("æ¶ˆæ¯é¡ºåºæ€§")]),t._v("ï¼šç¡®ä¿å¤šçº¿ç¨‹å¤„ç†ä¸ç ´åæ¶ˆæ¯çš„é¡ºåºæ€§ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("åç§»é‡ç®¡ç†")]),t._v("ï¼šæ‰‹åŠ¨æäº¤åç§»é‡æ—¶ï¼Œç¡®ä¿æ‰€æœ‰æ¶ˆæ¯éƒ½å·²æˆåŠŸå¤„ç†ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("å¼‚å¸¸å¤„ç†")]),t._v("ï¼šå¤„ç†å¤šçº¿ç¨‹ä¸­çš„å¼‚å¸¸æƒ…å†µï¼Œé˜²æ­¢æ¶ˆæ¯ä¸¢å¤±ã€‚")])]),t._v(" "),s("p",[t._v("é€šè¿‡è¿™äº›æ–¹æ³•ï¼Œå¯ä»¥åœ¨ä¸ç ´åKafkaåˆ†åŒºæ¶ˆè´¹æ¨¡å‹çš„æƒ…å†µä¸‹ï¼Œå®ç°å¤šçº¿ç¨‹å¤„ç†ï¼Œä»¥æé«˜æ¶ˆæ¯å¤„ç†çš„æ•ˆç‡å’Œååé‡ã€‚")]),t._v(" "),s("h2",{attrs:{id:"å››ã€kafkaå¯é æ€§ä¿éšœğŸ›¡ï¸"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å››ã€kafkaå¯é æ€§ä¿éšœğŸ›¡ï¸"}},[t._v("#")]),t._v(" å››ã€Kafkaå¯é æ€§ä¿éšœğŸ›¡ï¸")]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafkaå¦‚ä½•ä¿è¯é«˜å¯ç”¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafkaå¦‚ä½•ä¿è¯é«˜å¯ç”¨"}},[t._v("#")]),t._v(" ğŸ¯ Kafkaå¦‚ä½•ä¿è¯é«˜å¯ç”¨ï¼Ÿ")]),t._v(" "),s("p",[t._v("Kafkaé«˜å¯ç”¨æ¶æ„è®¾è®¡ï¼š")]),t._v(" "),s("p",[s("strong",[t._v("1. å‰¯æœ¬æœºåˆ¶ï¼ˆReplicationï¼‰")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("æ¯ä¸ªåˆ†åŒºç»´æŠ¤å¤šä¸ªå‰¯æœ¬")]),t._v(" "),s("li",[t._v("ä¸€ä¸ªLeaderå‰¯æœ¬ï¼Œå¤šä¸ªFollowerå‰¯æœ¬")]),t._v(" "),s("li",[t._v("å‰¯æœ¬åˆ†å¸ƒåœ¨ä¸åŒBrokerä¸Š")]),t._v(" "),s("li",[t._v("é»˜è®¤3å‰¯æœ¬ï¼Œå¯å®¹å¿1ä¸ªèŠ‚ç‚¹æ•…éšœ")])]),t._v(" "),s("p",[s("strong",[t._v("2. ISRæœºåˆ¶ï¼ˆIn-Sync Replicasï¼‰")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("ISRæ˜¯ä¸Leaderä¿æŒåŒæ­¥çš„å‰¯æœ¬é›†åˆ")]),t._v(" "),s("li",[t._v("åªæœ‰ISRä¸­çš„å‰¯æœ¬æ‰èƒ½è¢«é€‰ä¸ºLeader")]),t._v(" "),s("li",[t._v("è‡ªåŠ¨æ£€æµ‹å¹¶ç§»é™¤è½åçš„å‰¯æœ¬")]),t._v(" "),s("li",[t._v("ä¿è¯æ•°æ®ä¸€è‡´æ€§å’Œå¯ç”¨æ€§")])]),t._v(" "),s("p",[s("strong",[t._v("3. Leaderé€‰ä¸¾æœºåˆ¶")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("Controllerè´Ÿè´£Leaderé€‰ä¸¾")]),t._v(" "),s("li",[t._v("ä»ISRä¸­é€‰æ‹©æ–°Leader")]),t._v(" "),s("li",[t._v("30ç§’å†…å®Œæˆæ•…éšœåˆ‡æ¢")]),t._v(" "),s("li",[t._v("ä¸šåŠ¡æ— æ„ŸçŸ¥çš„è‡ªåŠ¨æ¢å¤")])]),t._v(" "),s("p",[s("strong",[t._v("4. å…³é”®é…ç½®å‚æ•°")]),t._v("ï¼š")]),t._v(" "),s("div",{staticClass:"language-properties extra-class"},[s("pre",{pre:!0,attrs:{class:"language-properties"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# å‰¯æœ¬ç›¸å…³é…ç½®")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("replication.factor")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("3                    # 3å‰¯æœ¬å®¹ç¾")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("min.insync.replicas")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("2                   # æœ€å°‘åŒæ­¥å‰¯æœ¬æ•°")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("unclean.leader.election.enable")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("false   # ç¦æ­¢éISRå‰¯æœ¬é€‰ä¸¾")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ç”Ÿäº§è€…å¯é æ€§é…ç½®")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("acks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("all                               # ç­‰å¾…æ‰€æœ‰ISRç¡®è®¤")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("retries")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("3                              # é‡è¯•æ¬¡æ•°")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key attr-name"}},[t._v("enable.idempotence")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token value attr-value"}},[t._v("true                # å¯ç”¨å¹‚ç­‰æ€§")]),t._v("\n")])])]),s("p",[s("strong",[t._v("5. è·¨æœºæˆ¿éƒ¨ç½²")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("å‰¯æœ¬è·¨æœºæˆ¿åˆ†å¸ƒ")]),t._v(" "),s("li",[t._v("é˜²æ­¢å•æœºæˆ¿æ•…éšœ")]),t._v(" "),s("li",[t._v("ç½‘ç»œåˆ†åŒºå®¹é”™")]),t._v(" "),s("li",[t._v("å¼‚åœ°ç¾å¤‡æ”¯æŒ")])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafka-çš„å¤šå‰¯æœ¬æœºåˆ¶äº†è§£å—"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafka-çš„å¤šå‰¯æœ¬æœºåˆ¶äº†è§£å—"}},[t._v("#")]),t._v(" ğŸ¯ Kafka çš„å¤šå‰¯æœ¬æœºåˆ¶äº†è§£å—ï¼Ÿ")]),t._v(" "),s("blockquote",[s("p",[t._v("æ‰€è°“çš„å‰¯æœ¬æœºåˆ¶ï¼ˆReplicationï¼‰ï¼Œä¹Ÿå¯ä»¥ç§°ä¹‹ä¸ºå¤‡ä»½æœºåˆ¶ï¼Œé€šå¸¸æ˜¯æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å¤šå°ç½‘ç»œäº’è”çš„æœºå™¨ä¸Šä¿å­˜æœ‰ç›¸åŒçš„æ•°æ®æ‹·è´ã€‚å‰¯æœ¬æœºåˆ¶æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("æä¾›æ•°æ®å†—ä½™")]),t._v("ã€‚å³ä½¿ç³»ç»Ÿéƒ¨åˆ†ç»„ä»¶å¤±æ•ˆï¼Œç³»ç»Ÿä¾ç„¶èƒ½å¤Ÿç»§ç»­è¿è½¬ï¼Œå› è€Œå¢åŠ äº†æ•´ä½“å¯ç”¨æ€§ä»¥åŠæ•°æ®æŒä¹…æ€§ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("æä¾›é«˜ä¼¸ç¼©æ€§")]),t._v("ã€‚æ”¯æŒæ¨ªå‘æ‰©å±•ï¼Œèƒ½å¤Ÿé€šè¿‡å¢åŠ æœºå™¨çš„æ–¹å¼æ¥æå‡è¯»æ€§èƒ½ï¼Œè¿›è€Œæé«˜è¯»æ“ä½œååé‡ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("æ”¹å–„æ•°æ®å±€éƒ¨æ€§")]),t._v("ã€‚å…è®¸å°†æ•°æ®æ”¾å…¥ä¸ç”¨æˆ·åœ°ç†ä½ç½®ç›¸è¿‘çš„åœ°æ–¹ï¼Œä»è€Œé™ä½ç³»ç»Ÿå»¶æ—¶ã€‚")])]),t._v(" "),s("p",[t._v("Kafka åªæ˜¯ç”¨å‰¯æœ¬æœºåˆ¶æ¥æä¾›æ•°æ®å†—ä½™å®ç°é«˜å¯ç”¨æ€§å’Œé«˜æŒä¹…æ€§ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªå¥½å¤„")])]),t._v(" "),s("p",[t._v("ç®€å•è®²ï¼Œæ¯ä¸ªåˆ†åŒºåœ¨ä¸åŒBrokerä¸Šç»´æŠ¤å¤šä»½åªè¿½åŠ çš„æäº¤æ—¥å¿—ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯æ•°æ®å†—ä½™ä¸æ•…éšœåˆ‡æ¢ï¼Œä¿éšœé«˜å¯ç”¨ä¸æŒä¹…æ€§ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("è§’è‰²åˆ†å·¥éå¸¸æ˜ç¡®ï¼š")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("Leaderå‰¯æœ¬")]),t._v("ï¼šå”¯ä¸€å¯¹å¤–æä¾›è¯»å†™æœåŠ¡")]),t._v(" "),s("li",[s("strong",[t._v("Followerå‰¯æœ¬")]),t._v("ï¼šä»…ä»Leaderå¼‚æ­¥æ‹‰å–æ•°æ®ï¼Œå†™å…¥æœ¬åœ°æ—¥å¿—ï¼Œä¸å¯¹å¤–æœåŠ¡")])]),t._v(" "),s("p",[s("strong",[t._v("ä¸€è‡´æ€§é ISRé›†åˆä¿è¯ï¼š")])]),t._v(" "),s("ul",[s("li",[t._v("ISRï¼ˆIn-Sync Replicasï¼‰æ˜¯ä¸Leaderä¿æŒåŒæ­¥çš„å‰¯æœ¬é›†åˆ")]),t._v(" "),s("li",[t._v("åªæœ‰ISRæˆå‘˜æ‰æœ‰èµ„æ ¼åœ¨æ•…éšœæ—¶è¢«é€‰ä¸ºæ–°Leaderï¼Œç¡®ä¿é€‰å‡ºæ¥çš„Leaderå…·å¤‡å®Œæ•´æ•°æ®")]),t._v(" "),s("li",[t._v("Followerè½åæˆ–å¤±è”ä¼šè¢«ç§»å‡ºISRï¼Œä¿æŠ¤ä¸€è‡´æ€§")])]),t._v(" "),s("p",[s("strong",[t._v("å…³é”®å‚æ•°ä¸ç­–ç•¥ï¼š")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("replication.factor=3")]),t._v("ï¼šä¸‰å‰¯æœ¬å®¹ç¾æ˜¯æˆ‘çš„é»˜è®¤ç”Ÿäº§é…ç½®")]),t._v(" "),s("li",[s("code",[t._v("min.insync.replicas=2")]),t._v(" + ç”Ÿäº§ç«¯"),s("code",[t._v("acks=all")]),t._v("ï¼šå¼ºä¸€è‡´æ€§å†™å…¥ï¼Œè‡³å°‘ä¸¤ä»½å‰¯æœ¬ç¡®è®¤æ‰ç®—æˆåŠŸ")]),t._v(" "),s("li",[s("code",[t._v("unclean.leader.election.enable=false")]),t._v("ï¼šæ‹’ç»éISRå‰¯æœ¬å½“Leaderï¼Œå®å¯çŸ­æš‚ä¸å¯ç”¨ä¹Ÿä¸ä¸¢æ•°æ®")])]),t._v(" "),s("p",[s("strong",[t._v("Leaderæ•…éšœåˆ‡æ¢æµç¨‹ï¼ˆZK/KRaftå‡å¯ç±»æ¯”ï¼‰ï¼š")])]),t._v(" "),s("ol",[s("li",[t._v("æ§åˆ¶é¢æ£€æµ‹åˆ°Leaderå¤±æ•ˆ")]),t._v(" "),s("li",[t._v("ä»ISRä¸­æŒ‰ä¼˜å…ˆé¡ºåºé€‰ä¸¾æ–°Leader")]),t._v(" "),s("li",[t._v("å‘å¸ƒå…ƒæ•°æ®å˜æ›´ï¼Œå®¢æˆ·ç«¯ä¸Followerå¿«é€Ÿåˆ‡æ¢")])]),t._v(" "),s("p",[t._v("è¿™ä¸€å¥—æœºåˆ¶åœ¨æˆ‘ä»¬çš„ç”Ÿäº§ç¯å¢ƒç»å—è¿‡è€ƒéªŒã€‚æ¯”å¦‚ä¸€æ¬¡æœºæˆ¿çº§æ•…éšœå¯¼è‡´éƒ¨åˆ†Brokerä¸‹çº¿ï¼Œä¸šåŠ¡æ— æ„Ÿåˆ‡æ¢ï¼Œæ–°Leaderåœ¨ç§’çº§å®Œæˆæ¥ç®¡ï¼Œé›¶æ•°æ®ä¸¢å¤±ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("ç›‘æ§ä¸é¢„æ¡ˆï¼š")])]),t._v(" "),s("ul",[s("li",[t._v("ç›‘æ§ï¼šISRè§„æ¨¡æ³¢åŠ¨ã€UnderReplicatedPartitionsã€Leaderé€‰ä¸¾é¢‘æ¬¡ã€Controllerå˜æ›´")]),t._v(" "),s("li",[t._v("é¢„æ¡ˆï¼šçƒ­ç‚¹åˆ†åŒºLeaderé‡åˆ†å¸ƒã€ä¼˜å…ˆå‰¯æœ¬é€‰ä¸¾ã€é™æµä¿æŠ¤")])]),t._v(" "),s("p",[s("strong",[t._v("ä¸€æ®µå¯ç›´æ¥å¤è¿°çš„å¼ºè¯æœ¯ï¼š")]),t._v("\nâ€œKafkaçš„å‰¯æœ¬ä¸æ˜¯ä¸ºäº†åŠ é€Ÿè¯»ï¼Œè€Œæ˜¯ä¸ºäº†ä¿è¯å¯ç”¨æ€§å’ŒæŒä¹…æ€§ã€‚æˆ‘ä»¬çº¿ä¸Šç»Ÿä¸€ä¸‰å‰¯æœ¬ã€acks=allã€min.insync.replicas=2ï¼Œå¹¶å…³é—­uncleané€‰ä¸¾ï¼Œå“ªæ€•çŸ­æš‚ä¸å¯å†™ï¼Œä¹Ÿç»ä¸è®©æ•°æ®å›é€€ã€‚é‡åˆ°Brokeræ•…éšœï¼ŒISRå†…çš„Followerç§’çº§æ¥ä»»Leaderï¼Œä¸šåŠ¡ä¾§æ— æ„Ÿã€‚åœ¨è¿™å¥—ç­–ç•¥ä¸‹ï¼Œä¸¤å¹´å†…æˆ‘ä»¬æ²¡æœ‰å‡ºç°ä¸€æ¬¡å› å‰¯æœ¬å¯¼è‡´çš„æ•°æ®ä¸¢å¤±äº‹ä»¶ã€‚â€")]),t._v(" "),s("p",[s("strong",[t._v("å¸¸è§è¿½é—®è¦ç‚¹ï¼ˆæˆ‘ä¼šä¸»åŠ¨è¡¥å……ï¼‰ï¼š")])]),t._v(" "),s("ul",[s("li",[t._v("ä¸ºä»€ä¹ˆFollowerä¸å¯¹å¤–è¯»ï¼Ÿé¿å…è¯»åˆ°æœªå¤åˆ¶å®Œçš„æ•°æ®ï¼Œç ´åä¸€è‡´æ€§")]),t._v(" "),s("li",[t._v("ISRè¿‡å°æ€ä¹ˆåŠï¼Ÿä¼˜å…ˆæ’æŸ¥ç½‘ç»œ/ç£ç›˜æŠ–åŠ¨ï¼Œå¿…è¦æ—¶é™é€Ÿç”Ÿäº§ä¿æŠ¤å¤åˆ¶")]),t._v(" "),s("li",[t._v("é«˜ä¸€è‡´æ€§å¸¦æ¥çš„æ€§èƒ½æŸè€—å¦‚ä½•å¼¥è¡¥ï¼Ÿé€šè¿‡åˆ†åŒºæ‰©å±•ã€æ‰¹é‡å‘é€ã€å‹ç¼©ä¸é›¶æ‹·è´æŠµæ¶ˆ")])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafka-åˆ¤æ–­ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦å­˜æ´»æœ‰ä»€ä¹ˆæ¡ä»¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafka-åˆ¤æ–­ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦å­˜æ´»æœ‰ä»€ä¹ˆæ¡ä»¶"}},[t._v("#")]),t._v(" ğŸ¯ Kafka åˆ¤æ–­ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦å­˜æ´»æœ‰ä»€ä¹ˆæ¡ä»¶ï¼Ÿ")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("ZooKeeperçš„å¿ƒè·³æœºåˆ¶")]),t._v("ï¼šæ¯ä¸ªBrokerä¼šåœ¨ZooKeeperä¸Šåˆ›å»ºä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹ï¼Œå¹¶å®šæœŸå‘é€å¿ƒè·³ï¼ˆheartbeatï¼‰ä¿¡å·ä»¥è¡¨æ˜è‡ªå·±æ˜¯æ´»è·ƒçš„ã€‚å¦‚æœZooKeeperåœ¨è®¾å®šçš„è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æŸä¸ªBrokerçš„å¿ƒè·³ï¼Œä¾¿ä¼šè®¤ä¸ºè¯¥Brokerå·²å¤±æ•ˆï¼Œå¹¶åˆ é™¤å…¶ä¸´æ—¶èŠ‚ç‚¹ã€‚")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("Sessionè¶…æ—¶")]),t._v("ï¼šå¦‚æœZooKeeperåœ¨"),s("code",[t._v("zookeeper.session.timeout.ms")]),t._v("è®¾ç½®çš„æ—¶é—´å†…æœªæ”¶åˆ°Brokerçš„å¿ƒè·³ï¼Œåˆ™ä¼šè®¤ä¸ºè¯¥Brokerå¤±æ•ˆã€‚")]),t._v(" "),s("li",[s("strong",[t._v("å¿ƒè·³é—´éš”")]),t._v("ï¼šBrokerå®šæœŸå‘é€å¿ƒè·³ç»™ZooKeeperï¼Œå¿ƒè·³é—´éš”ç”±"),s("code",[t._v("zookeeper.sync.time.ms")]),t._v("å‚æ•°å†³å®šã€‚")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("Leaderå’ŒFollowerä¹‹é—´çš„å¿ƒè·³")]),t._v("ï¼šåœ¨Kafkaçš„å¤šå‰¯æœ¬æœºåˆ¶ä¸­ï¼ŒLeaderå‰¯æœ¬ä¸Followerå‰¯æœ¬ä¹‹é—´ä¹Ÿæœ‰å¿ƒè·³æœºåˆ¶ã€‚Followerå‰¯æœ¬ä¼šå®šæœŸå‘Leaderå‘é€å¿ƒè·³ï¼Œè¡¨æ˜è‡ªå·±æ˜¯å­˜æ´»çš„ã€‚")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("Replica Lag")]),t._v("ï¼šå¦‚æœFollowerå‰¯æœ¬è½åäºLeaderå‰¯æœ¬è¶…è¿‡"),s("code",[t._v("replica.lag.time.max.ms")]),t._v("è®¾ç½®çš„æ—¶é—´ï¼Œåˆ™ä¼šè¢«ç§»å‡ºISRï¼ˆIn-Sync Replicasï¼‰é›†åˆï¼ŒKafkaè®¤ä¸ºè¯¥Followerå¯èƒ½å·²å¤±æ•ˆã€‚")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("ç½‘ç»œè¿æ¥æ£€æŸ¥")]),t._v("ï¼šKafkaä½¿ç”¨TCPè¿æ¥è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚Brokerä¹‹é—´ã€Brokerä¸ZooKeeperä¹‹é—´ã€ä»¥åŠBrokerä¸å®¢æˆ·ç«¯ä¹‹é—´çš„ç½‘ç»œè¿æ¥çŠ¶å†µä¹Ÿæ˜¯åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦å­˜æ´»çš„é‡è¦ä¾æ®ã€‚")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("TCPè¿æ¥è¶…æ—¶")]),t._v("ï¼šKafkaé€šè¿‡TCPè¿æ¥è¿›è¡Œæ•°æ®ä¼ è¾“å’Œå¿ƒè·³æ£€æµ‹ï¼Œå¦‚æœTCPè¿æ¥è¶…æ—¶ï¼ŒKafkaä¼šå°è¯•é‡è¿å¹¶è®°å½•è¿æ¥çŠ¶æ€ã€‚")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("Brokerå…ƒæ•°æ®åˆ·æ–°")]),t._v("ï¼šKafkaå®¢æˆ·ç«¯ï¼ˆç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼‰ä¼šå®šæœŸä»Kafkaé›†ç¾¤ä¸­åˆ·æ–°å…ƒæ•°æ®ï¼Œäº†è§£Brokerçš„çŠ¶æ€ã€‚å¦‚æœæŸä¸ªBrokeræ— æ³•å“åº”å…ƒæ•°æ®è¯·æ±‚ï¼Œå®¢æˆ·ç«¯å°†å…¶æ ‡è®°ä¸ºä¸å¯ç”¨ã€‚")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("å…ƒæ•°æ®è¯·æ±‚è¶…æ—¶")]),t._v("ï¼šå®¢æˆ·ç«¯é€šè¿‡"),s("code",[t._v("metadata.max.age.ms")]),t._v("å‚æ•°è®¾ç½®å…ƒæ•°æ®åˆ·æ–°çš„æ—¶é—´é—´éš”ï¼Œå¦‚æœåœ¨è¿™ä¸ªé—´éš”å†…æ— æ³•è·å–åˆ°Brokerçš„å…ƒæ•°æ®ï¼Œåˆ™è®¤ä¸ºè¯¥Brokerä¸å¯ç”¨ã€‚")])])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafka-åœ¨å¯é æ€§æ–¹é¢åšäº†å“ªäº›æ”¹è¿›"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafka-åœ¨å¯é æ€§æ–¹é¢åšäº†å“ªäº›æ”¹è¿›"}},[t._v("#")]),t._v(" ğŸ¯ kafka åœ¨å¯é æ€§æ–¹é¢åšäº†å“ªäº›æ”¹è¿›")]),t._v(" "),s("p",[t._v("è°ˆåŠå¯é æ€§ï¼Œæœ€å¸¸è§„ã€æœ€æœ‰æ•ˆçš„ç­–ç•¥å°±æ˜¯ â€œå‰¯æœ¬ï¼ˆreplicationï¼‰æœºåˆ¶â€ ï¼ŒKafka å®ç°é«˜å¯é æ€§åŒæ ·é‡‡ç”¨äº†è¯¥ç­–ç•¥ã€‚")]),t._v(" "),s("p",[t._v("é€šè¿‡è°ƒèŠ‚å‰¯æœ¬ç›¸å…³å‚æ•°ï¼Œå¯ä½¿ Kafka åœ¨æ€§èƒ½å’Œå¯é æ€§ä¹‹é—´å–å¾—å¹³è¡¡ã€‚")]),t._v(" "),s("blockquote",[s("p",[t._v("å®è·µä¸­ï¼Œæˆ‘ä»¬ä¸ºäº†ä¿è¯ producer å‘é€çš„æ•°æ®ï¼Œèƒ½å¯é åœ°å‘é€åˆ°æŒ‡å®šçš„ topicï¼Œtopic çš„æ¯ä¸ª partition æ”¶åˆ° producer å‘é€çš„æ•°æ®åï¼Œéƒ½éœ€è¦å‘ producer å‘é€ ackï¼ˆacknowledge ç¡®è®¤æ”¶åˆ°ï¼‰ï¼Œå¦‚æœ producer æ”¶åˆ° ackï¼Œå°±ä¼šè¿›è¡Œä¸‹ä¸€è½®çš„å‘é€ï¼Œå¦åˆ™é‡æ–°å‘é€æ•°æ®ã€‚")]),t._v(" "),s("p",[t._v("æ¶‰åŠåˆ°å‰¯æœ¬ ISRã€æ•…éšœå¤„ç†ä¸­çš„ LEOã€HW")])]),t._v(" "),s("h3",{attrs:{id:"isr"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#isr"}},[t._v("#")]),t._v(" ISR")]),t._v(" "),s("p",[t._v("ä¸€ä¸ª partition æœ‰å¤šä¸ªå‰¯æœ¬ï¼ˆreplicasï¼‰ï¼Œä¸ºäº†æé«˜å¯é æ€§ï¼Œè¿™äº›å‰¯æœ¬åˆ†æ•£åœ¨ä¸åŒçš„ broker ä¸Šï¼Œç”±äºå¸¦å®½ã€è¯»å†™æ€§èƒ½ã€ç½‘ç»œå»¶è¿Ÿç­‰å› ç´ ï¼ŒåŒä¸€æ—¶åˆ»ï¼Œè¿™äº›å‰¯æœ¬çš„çŠ¶æ€é€šå¸¸æ˜¯ä¸ä¸€è‡´çš„ï¼šå³ followers ä¸ leader çš„çŠ¶æ€ä¸ä¸€è‡´ã€‚")]),t._v(" "),s("p",[t._v("ä¸ºä¿è¯ producer å‘é€çš„æ•°æ®ï¼Œèƒ½å¯é çš„å‘é€åˆ°æŒ‡å®šçš„ topicï¼Œtopic çš„æ¯ä¸ª partition æ”¶åˆ° producer æ•°æ®åï¼Œéƒ½éœ€è¦å‘ producer å‘é€ ackï¼ˆacknowledgementç¡®è®¤æ”¶åˆ°ï¼‰ï¼Œå¦‚æœ producer æ”¶åˆ° ackï¼Œå°±ä¼šè¿›è¡Œä¸‹ä¸€è½®çš„å‘é€ï¼Œå¦åˆ™é‡æ–°å‘é€æ•°æ®ã€‚")]),t._v(" "),s("p",[t._v("leader ç»´æŠ¤äº†ä¸€ä¸ªåŠ¨æ€çš„ "),s("strong",[t._v("in-sync replica set")]),t._v("(ISR)ï¼Œæ„ä¸ºå’Œ leader ä¿æŒåŒæ­¥çš„ follower é›†åˆã€‚å½“ ISR ä¸­çš„ follower å®Œæˆæ•°æ®çš„åŒæ­¥ä¹‹åï¼Œleader å°±ä¼šç»™ producer å‘é€ ackã€‚")]),t._v(" "),s("p",[t._v('"ISRï¼ˆin-sync replica setï¼‰æ˜¯ Kafka ä¸­ä¸å‰¯æœ¬åŒæ­¥ç›¸å…³çš„é‡è¦æœºåˆ¶ã€‚ç®€å•æ¥è¯´ï¼ŒISR æ˜¯ç”± leader ç»´æŠ¤çš„ã€ä¸è‡ªèº«ä¿æŒåŒæ­¥çš„ follower å‰¯æœ¬é›†åˆã€‚å½“ producer å‘é€æ•°æ®åˆ° partition æ—¶ï¼Œåªæœ‰ ISR ä¸­çš„ follower å®Œæˆæ•°æ®åŒæ­¥åï¼Œleader æ‰ä¼šå‘ producer å‘é€ ack ç¡®è®¤ã€‚å¦‚æœ follower é•¿æ—¶é—´ï¼ˆé»˜è®¤ 10 ç§’ï¼Œç”±'),s("code",[t._v("replica.lag.time.max.ms")]),t._v("æ§åˆ¶ï¼‰æœªä¸ leader åŒæ­¥ï¼Œå°±ä¼šè¢«è¸¢å‡º ISRã€‚è¿™ä¸€æœºåˆ¶æ—¢ä¿è¯äº†æ•°æ®å¯é æ€§ï¼Œåˆé€šè¿‡åŠ¨æ€è°ƒæ•´åŒæ­¥å‰¯æœ¬é›†åˆå¹³è¡¡äº†æ€§èƒ½ä¸ä¸€è‡´æ€§ã€‚â€")]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-isr-é¢‘ç¹å˜åŒ–-å¯èƒ½ä¼šæœ‰å“ªäº›åŸå› -æ€ä¹ˆæ’æŸ¥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-isr-é¢‘ç¹å˜åŒ–-å¯èƒ½ä¼šæœ‰å“ªäº›åŸå› -æ€ä¹ˆæ’æŸ¥"}},[t._v("#")]),t._v(" ğŸ¯ ISR é¢‘ç¹å˜åŒ–ï¼Œå¯èƒ½ä¼šæœ‰å“ªäº›åŸå› ï¼Œæ€ä¹ˆæ’æŸ¥ï¼Ÿ")]),t._v(" "),s("ul",[s("li",[t._v("ç½‘ç»œå»¶è¿Ÿå’Œä¸ç¨³å®šï¼šé«˜ç½‘ç»œå»¶è¿Ÿæˆ–ä¸ç¨³å®šçš„ç½‘ç»œè¿æ¥ä¼šå¯¼è‡´Followerå‰¯æœ¬æ— æ³•åŠæ—¶ä»Leaderå‰¯æœ¬åŒæ­¥æ•°æ®ï¼Œä»è€Œè¢«ç§»å‡ºISR")]),t._v(" "),s("li",[t._v("ç£ç›˜æ€§èƒ½é—®é¢˜ï¼šFollowerå‰¯æœ¬çš„ç£ç›˜å†™å…¥é€Ÿåº¦ä¸è¶³ï¼Œæ— æ³•åŠæ—¶å†™å…¥ä»LeaderåŒæ­¥çš„æ•°æ®ï¼Œå¯¼è‡´å…¶è½åäºLeaderï¼Œè¿›è€Œè¢«ç§»å‡ºISR")]),t._v(" "),s("li",[t._v("CPUæˆ–å†…å­˜èµ„æºä¸è¶³ï¼šBrokerèŠ‚ç‚¹çš„CPUæˆ–å†…å­˜èµ„æºä¸è¶³ï¼Œå¯¼è‡´æ•°æ®å¤„ç†é€Ÿåº¦å˜æ…¢ï¼Œå½±å“å‰¯æœ¬åŒæ­¥çš„æ€§èƒ½ã€‚")]),t._v(" "),s("li",[t._v("GCï¼ˆåƒåœ¾å›æ”¶ï¼‰åœé¡¿ï¼šJavaåƒåœ¾å›æ”¶åœé¡¿ï¼ˆGC Pauseï¼‰æ—¶é—´è¿‡é•¿ï¼Œä¼šå¯¼è‡´BrokerèŠ‚ç‚¹åœ¨çŸ­æ—¶é—´å†…æ— æ³•å¤„ç†è¯·æ±‚ï¼Œå½±å“å‰¯æœ¬åŒæ­¥")])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-ack-åº”ç­”æœºåˆ¶"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-ack-åº”ç­”æœºåˆ¶"}},[t._v("#")]),t._v(" ğŸ¯ ack åº”ç­”æœºåˆ¶")]),t._v(" "),s("p",[t._v("Kafka çš„ ack åº”ç­”æœºåˆ¶æ˜¯ç”Ÿäº§è€…å‘ broker å‘é€æ¶ˆæ¯åï¼Œbroker ç¡®è®¤æ¶ˆæ¯æ¥æ”¶çŠ¶æ€çš„æœºåˆ¶ï¼Œé€šè¿‡ producer é…ç½®çš„ "),s("code",[t._v("acks")]),t._v(" å‚æ•°æ§åˆ¶")]),t._v(" "),s("p",[t._v("å¯¹äºæŸäº›ä¸å¤ªé‡è¦çš„æ•°æ®ï¼Œå¯¹æ•°æ®çš„å¯é æ€§è¦æ±‚ä¸æ˜¯å¾ˆé«˜ï¼Œèƒ½å¤Ÿå®¹å¿æ•°æ®çš„å°‘é‡ä¸¢å¤±ï¼Œæ‰€ä»¥æ²¡å¿…è¦ç­‰ ISR ä¸­çš„ follower å…¨éƒ¨æ¥æ”¶æˆåŠŸã€‚")]),t._v(" "),s("p",[t._v("æ‰€ä»¥ Kafka ä¸ºç”¨æˆ·æä¾›äº†"),s("strong",[t._v("ä¸‰ç§å¯é æ€§çº§åˆ«")]),t._v("ï¼Œç”¨æˆ·æ ¹æ®å¯¹å¯é æ€§å’Œå»¶è¿Ÿçš„è¦æ±‚è¿›è¡Œæƒè¡¡ï¼Œé€‰æ‹©ä»¥ä¸‹çš„ acks å‚æ•°é…ç½®")]),t._v(" "),s("ul",[s("li",[t._v("0ï¼šproducer ä¸ç­‰å¾… broker çš„ ackï¼Œè¿™ä¸€æ“ä½œæä¾›äº†ä¸€ä¸ªæœ€ä½çš„å»¶è¿Ÿï¼Œbroker ä¸€æ¥æ”¶åˆ°è¿˜æ²¡æœ‰å†™å…¥ç£ç›˜å°±å·²ç»è¿”å›ï¼Œå½“ broker æ•…éšœæ—¶æœ‰å¯èƒ½"),s("strong",[t._v("ä¸¢å¤±æ•°æ®")]),t._v("ï¼›")]),t._v(" "),s("li",[t._v("1ï¼šproducer ç­‰å¾… broker çš„ ackï¼Œpartition çš„ leader è½ç›˜æˆåŠŸåè¿”å› ackï¼Œå¦‚æœåœ¨ follower åŒæ­¥æˆåŠŸä¹‹å‰ leader æ•…éšœï¼Œé‚£ä¹ˆå°†ä¼š"),s("strong",[t._v("ä¸¢å¤±æ•°æ®")]),t._v("ï¼›")]),t._v(" "),s("li",[t._v("-1ï¼ˆallï¼‰ï¼šproducer ç­‰å¾… broker çš„ ackï¼Œpartition çš„ leader å’Œ follower å…¨éƒ¨è½ç›˜æˆåŠŸåæ‰è¿”å› ackã€‚ä½†æ˜¯å¦‚æœåœ¨ follower åŒæ­¥å®Œæˆåï¼Œbroker å‘é€ ack ä¹‹å‰ï¼Œleader å‘ç”Ÿæ•…éšœï¼Œé‚£ä¹ˆå°±ä¼šé€ æˆ"),s("strong",[t._v("æ•°æ®é‡å¤")]),t._v("ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-æ•…éšœå¤„ç†"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-æ•…éšœå¤„ç†"}},[t._v("#")]),t._v(" ğŸ¯ æ•…éšœå¤„ç†")]),t._v(" "),s("p",[t._v("ç”±äºæˆ‘ä»¬å¹¶ä¸èƒ½ä¿è¯ Kafka é›†ç¾¤ä¸­æ¯æ—¶æ¯åˆ» follower çš„é•¿åº¦éƒ½å’Œ leader ä¸€è‡´ï¼ˆå³æ•°æ®åŒæ­¥æ˜¯æœ‰æ—¶å»¶çš„ï¼‰ï¼Œé‚£ä¹ˆå½“ leader æŒ‚æ‰é€‰ä¸¾æŸä¸ª follower ä¸ºæ–°çš„ leader çš„æ—¶å€™ï¼ˆåŸå…ˆæŒ‚æ‰çš„ leader æ¢å¤äº†æˆä¸ºäº† followerï¼‰ï¼Œå¯èƒ½ä¼šå‡ºç° leader çš„æ•°æ®æ¯” follower è¿˜å°‘çš„æƒ…å†µã€‚ä¸ºäº†è§£å†³è¿™ç§æ•°æ®é‡ä¸ä¸€è‡´å¸¦æ¥çš„æ··ä¹±æƒ…å†µï¼ŒKafka æå‡ºäº†ä»¥ä¸‹æ¦‚å¿µï¼š")]),t._v(" "),s("ul",[s("li",[t._v("LEOï¼ˆLog End Offsetï¼‰ï¼šæŒ‡çš„æ˜¯æ¯ä¸ªå‰¯æœ¬æœ€åä¸€ä¸ªoffsetï¼›")]),t._v(" "),s("li",[t._v("HWï¼ˆHigh Watherï¼‰ï¼šæŒ‡çš„æ˜¯æ¶ˆè´¹è€…èƒ½è§åˆ°çš„æœ€å¤§çš„ offsetï¼ŒISR é˜Ÿåˆ—ä¸­æœ€å°çš„ LEOã€‚")])]),t._v(" "),s("p",[t._v("æ¶ˆè´¹è€…å’Œ leader é€šä¿¡æ—¶ï¼Œåªèƒ½æ¶ˆè´¹ HW ä¹‹å‰çš„æ•°æ®ï¼ŒHW ä¹‹åçš„æ•°æ®å¯¹æ¶ˆè´¹è€…ä¸å¯è§ã€‚")]),t._v(" "),s("p",[t._v("é’ˆå¯¹è¿™ä¸ªè§„åˆ™ï¼š")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("å½“followerå‘ç”Ÿæ•…éšœæ—¶")]),t._v("ï¼šfollower å‘ç”Ÿæ•…éšœåä¼šè¢«ä¸´æ—¶è¸¢å‡º ISRï¼Œå¾…è¯¥ follower æ¢å¤åï¼Œfollower ä¼šè¯»å–æœ¬åœ°ç£ç›˜è®°å½•çš„ä¸Šæ¬¡çš„ HWï¼Œå¹¶å°† log æ–‡ä»¶é«˜äº HW çš„éƒ¨åˆ†æˆªå–æ‰ï¼Œä» HW å¼€å§‹å‘ leader è¿›è¡ŒåŒæ­¥ã€‚ç­‰è¯¥ follower çš„ LEO å¤§äºç­‰äºè¯¥ Partition çš„ HWï¼Œå³ follower è¿½ä¸Š leader ä¹‹åï¼Œå°±å¯ä»¥é‡æ–°åŠ å…¥ ISR äº†ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("å½“leaderå‘ç”Ÿæ•…éšœæ—¶")]),t._v("ï¼šleader å‘ç”Ÿæ•…éšœä¹‹åï¼Œä¼šä» ISR ä¸­é€‰å‡ºä¸€ä¸ªæ–°çš„ leaderï¼Œä¹‹åï¼Œä¸ºä¿è¯å¤šä¸ªå‰¯æœ¬ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ï¼Œå…¶ä½™çš„ follower ä¼šå…ˆå°†å„è‡ªçš„ log æ–‡ä»¶é«˜äº HW çš„éƒ¨åˆ†æˆªæ‰ï¼Œç„¶åä»æ–°çš„ leader åŒæ­¥æ•°æ®ã€‚")])]),t._v(" "),s("p",[t._v("æ‰€ä»¥æ•°æ®ä¸€è‡´æ€§å¹¶ä¸èƒ½ä¿è¯æ•°æ®ä¸ä¸¢å¤±æˆ–è€…ä¸é‡å¤ï¼Œè¿™æ˜¯ç”± ack æ§åˆ¶çš„ã€‚HW è§„åˆ™åªèƒ½ä¿è¯å‰¯æœ¬ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§ï¼")]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-isrã€osrã€ar-æ˜¯ä»€ä¹ˆ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-isrã€osrã€ar-æ˜¯ä»€ä¹ˆ"}},[t._v("#")]),t._v(" ğŸ¯ ISRã€OSRã€AR æ˜¯ä»€ä¹ˆï¼Ÿ")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("ISRï¼šISRæ˜¯â€œåŒæ­¥å‰¯æœ¬é›†åˆâ€ï¼ˆIn-Sync Replicas Setï¼‰çš„ç¼©å†™ã€‚ISRé›†åˆåŒ…å«æ‰€æœ‰ä¸Leaderå‰¯æœ¬ä¿æŒåŒæ­¥çš„å‰¯æœ¬")])]),t._v(" "),s("li",[s("p",[t._v("OSRï¼šOSRæ˜¯â€œä¸åŒæ­¥å‰¯æœ¬é›†åˆâ€ï¼ˆOut-of-Sync Replicas Setï¼‰çš„ç¼©å†™")])]),t._v(" "),s("li",[s("p",[t._v("ARï¼šARæ˜¯â€œåˆ†é…å‰¯æœ¬é›†åˆâ€ï¼ˆAssigned Replicas Setï¼‰çš„ç¼©å†™ã€‚ARé›†åˆåŒ…å«æ‰€æœ‰è¢«åˆ†é…ç»™æŸä¸ªåˆ†åŒºçš„å‰¯æœ¬ï¼ŒåŒ…æ‹¬Leaderå’Œæ‰€æœ‰Followerã€‚è¿™æ˜¯Kafkaåœ¨é…ç½®ä¸»é¢˜æ—¶æŒ‡å®šçš„å‰¯æœ¬æ•°é‡ã€‚")])])]),t._v(" "),s("p",[t._v("ISR æ˜¯ç”± leader ç»´æŠ¤ï¼Œfollower ä» leader åŒæ­¥æ•°æ®æœ‰ä¸€äº›å»¶è¿Ÿï¼Œè¶…è¿‡ç›¸åº”çš„é˜ˆå€¼ä¼šæŠŠ follower å‰”é™¤å‡º ISRï¼Œå­˜å…¥ OSRï¼ˆOut-of-Sync Replicas ï¼‰åˆ—è¡¨ï¼Œæ–°åŠ å…¥çš„ follower ä¹Ÿä¼šå…ˆå­˜æ”¾åœ¨ OSR ä¸­ã€‚"),s("code",[t._v("AR=ISR+OSR")]),t._v("ã€‚")]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-è¯·è°ˆä¸€è°ˆ-kafka-æ•°æ®ä¸€è‡´æ€§åŸç†"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-è¯·è°ˆä¸€è°ˆ-kafka-æ•°æ®ä¸€è‡´æ€§åŸç†"}},[t._v("#")]),t._v(" ğŸ¯ è¯·è°ˆä¸€è°ˆ Kafka æ•°æ®ä¸€è‡´æ€§åŸç†?")]),t._v(" "),s("ul",[s("li",[t._v("å¤šå‰¯æœ¬æœºåˆ¶ï¼šKafkaçš„æ¯ä¸ªåˆ†åŒºå¯ä»¥é…ç½®å¤šä¸ªå‰¯æœ¬ï¼ˆReplicasï¼‰ï¼Œè¿™äº›å‰¯æœ¬åˆ†å¸ƒåœ¨ä¸åŒçš„Brokerä¸Šã€‚å‰¯æœ¬åŒ…æ‹¬ä¸€ä¸ªLeaderå’Œå¤šä¸ªFollowerã€‚ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„æ‰€æœ‰è¯»å†™è¯·æ±‚éƒ½é€šè¿‡Leaderè¿›è¡Œ")]),t._v(" "),s("li",[t._v("ISRï¼ˆIn-Sync Replicasï¼‰é›†åˆ")]),t._v(" "),s("li",[t._v("ç¡®è®¤æœºåˆ¶ï¼šKafkaé€šè¿‡é…ç½®"),s("code",[t._v("acks")]),t._v("å‚æ•°æ¥å†³å®šæ¶ˆæ¯çš„ç¡®è®¤ç­–ç•¥ï¼Œä»è€Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚")]),t._v(" "),s("li",[t._v("é€‰ä¸¾å’Œæ•…éšœæ¢å¤ï¼šå½“Leaderå¤±æ•ˆæ—¶ï¼ŒKafkaä¼šä»ISRä¸­é€‰ä¸¾ä¸€ä¸ªæ–°çš„Leaderã€‚è¿™ç¡®ä¿äº†æ–°Leaderçš„æ•°æ®æ˜¯æœ€æ–°çš„ï¼Œå¹¶ä¸”ä¸æ—§Leaderä¿æŒä¸€è‡´")]),t._v(" "),s("li",[t._v("å¹‚ç­‰æ€§å’Œäº‹åŠ¡ï¼šKafkaæ”¯æŒå¹‚ç­‰æ€§å’Œäº‹åŠ¡ï¼Œä»¥ç¡®ä¿æ¶ˆæ¯çš„ç²¾ç¡®ä¸€æ¬¡ï¼ˆexactly-onceï¼‰è¯­ä¹‰")])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-æ•°æ®ä¼ è¾“çš„äº‹åŠ¡æœ‰å‡ ç§"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-æ•°æ®ä¼ è¾“çš„äº‹åŠ¡æœ‰å‡ ç§"}},[t._v("#")]),t._v(" ğŸ¯ æ•°æ®ä¼ è¾“çš„äº‹åŠ¡æœ‰å‡ ç§ï¼Ÿ")]),t._v(" "),s("p",[t._v("æ•°æ®ä¼ è¾“çš„äº‹åŠ¡å®šä¹‰é€šå¸¸æœ‰ä»¥ä¸‹ä¸‰ç§çº§åˆ«ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("æœ€å¤šä¸€æ¬¡: æ¶ˆæ¯ä¸ä¼šè¢«é‡å¤å‘é€ï¼Œæœ€å¤šè¢«ä¼ è¾“ä¸€æ¬¡ï¼Œä½†ä¹Ÿæœ‰å¯èƒ½ä¸€æ¬¡ä¸ä¼ è¾“")]),t._v(" "),s("li",[t._v("æœ€å°‘ä¸€æ¬¡: æ¶ˆæ¯ä¸ä¼šè¢«æ¼å‘é€ï¼Œæœ€å°‘è¢«ä¼ è¾“ä¸€æ¬¡ï¼Œä½†ä¹Ÿæœ‰å¯èƒ½è¢«é‡å¤ä¼ è¾“.")]),t._v(" "),s("li",[t._v("ç²¾ç¡®çš„ä¸€æ¬¡ï¼ˆExactly onceï¼‰: ä¸ä¼šæ¼ä¼ è¾“ä¹Ÿä¸ä¼šé‡å¤ä¼ è¾“,æ¯ä¸ªæ¶ˆæ¯éƒ½ä¼ è¾“è¢«")])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafkaåˆ›å»ºtopicæ—¶å¦‚ä½•å°†åˆ†åŒºæ”¾ç½®åˆ°ä¸åŒçš„brokerä¸­"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafkaåˆ›å»ºtopicæ—¶å¦‚ä½•å°†åˆ†åŒºæ”¾ç½®åˆ°ä¸åŒçš„brokerä¸­"}},[t._v("#")]),t._v(" ğŸ¯ Kafkaåˆ›å»ºTopicæ—¶å¦‚ä½•å°†åˆ†åŒºæ”¾ç½®åˆ°ä¸åŒçš„Brokerä¸­ï¼Ÿ")]),t._v(" "),s("p",[t._v("åˆ›å»ºTopicæ—¶å¯ä»¥é€šè¿‡æŒ‡å®šåˆ†åŒºåˆ†é…ç­–ç•¥ï¼ˆPartition Assignment Strategyï¼‰æ¥æ§åˆ¶åˆ†åŒºï¼ˆPartitionï¼‰å¦‚ä½•æ”¾ç½®åˆ°ä¸åŒçš„Brokerä¸Š")]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("é»˜è®¤åˆ†åŒºåˆ†é…")]),t._v("ï¼š å¦‚æœåˆ›å»ºTopicæ—¶æ²¡æœ‰æŒ‡å®šåˆ†åŒºåˆ†é…ç­–ç•¥ï¼ŒKafkaå°†ä½¿ç”¨é»˜è®¤çš„åˆ†åŒºåˆ†é…ç­–ç•¥ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒKafkaä¼šå°è¯•å‡åŒ€åœ°å°†åˆ†åŒºåˆ†é…åˆ°æ‰€æœ‰Brokerä¸Šã€‚")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("è‡ªå®šä¹‰åˆ†åŒºåˆ†é…ç­–ç•¥")]),t._v("ï¼š åˆ›å»ºTopicæ—¶ï¼Œå¯ä»¥ä½¿ç”¨"),s("code",[t._v("--partition")]),t._v("å’Œ"),s("code",[t._v("--replication-factor")]),t._v("å‚æ•°æ¥æŒ‡å®šåˆ†åŒºæ•°å’Œå‰¯æœ¬å› å­ã€‚ç„¶åï¼Œé€šè¿‡"),s("code",[t._v("--assign")]),t._v("å‚æ•°æ¥æŒ‡å®šæ¯ä¸ªåˆ†åŒºçš„Brokeråˆ—è¡¨")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("ä½¿ç”¨Broker ID")]),t._v("ï¼š å¦‚æœä½ çŸ¥é“Brokerçš„IDï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Broker IDæ¥æŒ‡å®šåˆ†åŒºçš„æ”¾ç½®")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("kafka-topics.sh "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--create")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--topic")]),t._v(" my-topic --num-partitions "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" --replication-factor "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" --broker-list "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0:1,1:2"')]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("ä½¿ç”¨KafkaAdminClient API")]),t._v("ï¼š å¦‚æœä½¿ç”¨Java APIåˆ›å»ºTopicï¼Œå¯ä»¥ä½¿ç”¨"),s("code",[t._v("KafkaAdminClient")]),t._v("ç±»çš„"),s("code",[t._v("createTopics")]),t._v("æ–¹æ³•ï¼Œå¹¶è®¾ç½®"),s("code",[t._v("NewTopic")]),t._v("å¯¹è±¡çš„"),s("code",[t._v("replicaAssignment")]),t._v("å±æ€§æ¥æŒ‡å®šæ¯ä¸ªåˆ†åŒºçš„Brokeråˆ—è¡¨")])])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafkaçš„äº‹åŠ¡æœºåˆ¶æ˜¯æ€æ ·çš„"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafkaçš„äº‹åŠ¡æœºåˆ¶æ˜¯æ€æ ·çš„"}},[t._v("#")]),t._v(" ğŸ¯ Kafkaçš„äº‹åŠ¡æœºåˆ¶æ˜¯æ€æ ·çš„ï¼Ÿ")]),t._v(" "),s("p",[t._v("Kafkaäº‹åŠ¡æ”¯æŒExactly-Onceè¯­ä¹‰ï¼š")]),t._v(" "),s("p",[s("strong",[t._v("1. å¹‚ç­‰æ€§Producer")]),t._v("ï¼š")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¹‚ç­‰æ€§ç”Ÿäº§è€…é…ç½®")]),t._v("\nprops"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"enable.idempotence"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è‡ªåŠ¨è®¾ç½®ï¼šacks=all, retries=Integer.MAX_VALUE, max.in.flight.requests.per.connection=5")]),t._v("\n")])])]),s("p",[s("strong",[t._v("2. äº‹åŠ¡æ€§Producer")]),t._v("ï¼š")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// äº‹åŠ¡ç”Ÿäº§è€…ä½¿ç”¨")]),t._v("\nprops"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"transactional.id"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"transaction-id-001"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nproducer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initTransactions")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    producer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("beginTransaction")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    producer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProducerRecord")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"topic-A"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"message1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    producer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProducerRecord")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"topic-B"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"message2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    producer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("commitTransaction")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    producer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("abortTransaction")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("strong",[t._v("3. äº‹åŠ¡å®ç°åŸç†")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("Transaction Coordinatorç®¡ç†äº‹åŠ¡çŠ¶æ€")]),t._v(" "),s("li",[t._v("ä¸¤é˜¶æ®µæäº¤åè®®ä¿è¯åŸå­æ€§")]),t._v(" "),s("li",[t._v("Transaction Logè®°å½•äº‹åŠ¡å…ƒæ•°æ®")]),t._v(" "),s("li",[t._v("Consumerå¯è®¾ç½®éš”ç¦»çº§åˆ«")])]),t._v(" "),s("p",[s("strong",[t._v("4. æµå¤„ç†äº‹åŠ¡")]),t._v("ï¼š")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Kafka Streamsäº‹åŠ¡å¤„ç†")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Properties")]),t._v(" props "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Properties")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nprops"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"processing.guarantee"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"exactly_once_v2"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StreamsBuilder")]),t._v(" builder "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("StreamsBuilder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nbuilder"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("stream")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"input-topic"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mapValues")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("processMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("to")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"output-topic"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"äº”ã€å®è·µç›¸å…³-ğŸ”§"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#äº”ã€å®è·µç›¸å…³-ğŸ”§"}},[t._v("#")]),t._v(" äº”ã€å®è·µç›¸å…³  ğŸ”§")]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafka-å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafka-å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±"}},[t._v("#")]),t._v(" ğŸ¯ Kafka å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±?")]),t._v(" "),s("blockquote",[s("p",[t._v('"æˆ‘ä»ä¸‰ä¸ªè§’åº¦æ¥ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼š')]),t._v(" "),s("p",[s("strong",[t._v("ç”Ÿäº§è€…ç«¯ï¼š")])]),t._v(" "),s("ul",[s("li",[t._v("è®¾ç½®acks=allï¼Œç­‰å¾…æ‰€æœ‰ISRå‰¯æœ¬ç¡®è®¤")]),t._v(" "),s("li",[t._v("é…ç½®retriesé‡è¯•æ¬¡æ•°")]),t._v(" "),s("li",[t._v("è®¾ç½®é€‚å½“çš„è¶…æ—¶æ—¶é—´")])]),t._v(" "),s("p",[s("strong",[t._v("Brokerç«¯ï¼š")])]),t._v(" "),s("ul",[s("li",[t._v("é…ç½®min.insync.replicas >= 2ï¼Œä¿è¯è‡³å°‘æœ‰2ä¸ªå‰¯æœ¬åŒæ­¥")]),t._v(" "),s("li",[t._v("å®šæœŸå¤‡ä»½å’Œç›‘æ§")])]),t._v(" "),s("p",[s("strong",[t._v("æ¶ˆè´¹è€…ç«¯ï¼š")])]),t._v(" "),s("ul",[s("li",[t._v("æ‰‹åŠ¨æäº¤offsetï¼Œç¡®ä¿æ¶ˆæ¯å¤„ç†å®Œæˆåå†æäº¤")]),t._v(" "),s("li",[t._v("å®ç°å¹‚ç­‰æ€§å¤„ç†ï¼Œé˜²æ­¢é‡å¤æ¶ˆè´¹é€ æˆçš„ä¸šåŠ¡é—®é¢˜")])]),t._v(" "),s("p",[t._v('åœ¨æˆ‘ä»¬çš„æ ¸å¿ƒä¸šåŠ¡ä¸­ï¼Œæˆ‘é‡‡ç”¨äº†acks=all + min.insync.replicas=2çš„é…ç½®ï¼Œè™½ç„¶ä¼šå½±å“ä¸€äº›æ€§èƒ½ï¼Œä½†ä¿è¯äº†æ•°æ®çš„å¯é æ€§ã€‚"')])]),t._v(" "),s("p",[t._v("é‚£é¢å¯¹â€œåœ¨ä½¿ç”¨ MQ æ¶ˆæ¯é˜Ÿåˆ—æ—¶ï¼Œå¦‚ä½•ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±â€è¿™ä¸ªé—®é¢˜æ—¶ï¼Œä½ è¦æ€ä¹ˆå›ç­”å‘¢ï¼Ÿé¦–å…ˆï¼Œä½ è¦åˆ†æå…¶ä¸­æœ‰å‡ ä¸ªè€ƒç‚¹ï¼Œæ¯”å¦‚ï¼š")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("å¦‚ä½•çŸ¥é“æœ‰æ¶ˆæ¯ä¸¢å¤±ï¼Ÿ")])]),t._v(" "),s("li",[s("p",[t._v("å“ªäº›ç¯èŠ‚å¯èƒ½ä¸¢æ¶ˆæ¯ï¼Ÿ")])]),t._v(" "),s("li",[s("p",[t._v("å¦‚ä½•ç¡®ä¿æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Ÿ")])])]),t._v(" "),s("p",[s("strong",[t._v("Kafka åªå¯¹â€œå·²æäº¤â€çš„æ¶ˆæ¯ï¼ˆcommitted messageï¼‰åšæœ‰é™åº¦çš„æŒä¹…åŒ–ä¿è¯ã€‚")])]),t._v(" "),s("p",[t._v("ä¸€æ¡æ¶ˆæ¯ä»ç”Ÿäº§åˆ°æ¶ˆè´¹å®Œæˆè¿™ä¸ªè¿‡ç¨‹ï¼Œå¯ä»¥åˆ’åˆ†ä¸‰ä¸ªé˜¶æ®µ")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static001.geekbang.org/resource/image/81/05/81a01f5218614efea2838b0808709205.jpg",alt:""}})]),t._v(" "),s("h4",{attrs:{id:"ç”Ÿäº§è€…ä¸¢æ•°æ®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç”Ÿäº§è€…ä¸¢æ•°æ®"}},[t._v("#")]),t._v(" ç”Ÿäº§è€…ä¸¢æ•°æ®")]),t._v(" "),s("p",[t._v("å¯èƒ½ä¼šæœ‰å“ªäº›å› ç´ å¯¼è‡´æ¶ˆæ¯æ²¡æœ‰å‘é€æˆåŠŸå‘¢ï¼Ÿå…¶å®åŸå› æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚ç½‘ç»œæŠ–åŠ¨ï¼Œå¯¼è‡´æ¶ˆæ¯å‹æ ¹å°±æ²¡æœ‰å‘é€åˆ° Broker ç«¯ï¼›æˆ–è€…æ¶ˆæ¯æœ¬èº«ä¸åˆæ ¼å¯¼è‡´ Broker æ‹’ç»æ¥æ”¶ï¼ˆæ¯”å¦‚æ¶ˆæ¯å¤ªå¤§äº†ï¼Œè¶…è¿‡äº† Broker çš„æ‰¿å—èƒ½åŠ›ï¼‰ç­‰")]),t._v(" "),s("p",[t._v("è§£å†³æ­¤é—®é¢˜çš„æ–¹æ³•éå¸¸ç®€å•ï¼š"),s("strong",[t._v("Producer æ°¸è¿œè¦ä½¿ç”¨å¸¦æœ‰å›è°ƒé€šçŸ¥çš„å‘é€ APIï¼Œä¹Ÿå°±æ˜¯è¯´ä¸è¦ä½¿ç”¨ producer.send(msg)ï¼Œè€Œè¦ä½¿ç”¨ producer.send(msg, callback)")]),t._v("ã€‚ä¸è¦å°ç§è¿™é‡Œçš„ callbackï¼ˆå›è°ƒï¼‰ï¼Œå®ƒèƒ½å‡†ç¡®åœ°å‘Šè¯‰ä½ æ¶ˆæ¯æ˜¯å¦çœŸçš„æäº¤æˆåŠŸäº†ã€‚ä¸€æ—¦å‡ºç°æ¶ˆæ¯æäº¤å¤±è´¥çš„æƒ…å†µï¼Œä½ å°±å¯ä»¥æœ‰é’ˆå¯¹æ€§åœ°è¿›è¡Œå¤„ç†ã€‚")]),t._v(" "),s("h4",{attrs:{id:"broker-ä¸¢æ•°æ®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#broker-ä¸¢æ•°æ®"}},[t._v("#")]),t._v(" Broker ä¸¢æ•°æ®")]),t._v(" "),s("p",[t._v("åœ¨å­˜å‚¨é˜¶æ®µæ­£å¸¸æƒ…å†µä¸‹ï¼Œåªè¦ Broker åœ¨æ­£å¸¸è¿è¡Œï¼Œå°±ä¸ä¼šå‡ºç°ä¸¢å¤±æ¶ˆæ¯çš„é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœ Broker å‡ºç°äº†æ•…éšœï¼Œæ¯”å¦‚è¿›ç¨‹æ­»æ‰äº†æˆ–è€…æœåŠ¡å™¨å®•æœºäº†ï¼Œè¿˜æ˜¯å¯èƒ½ä¼šä¸¢å¤±æ¶ˆæ¯çš„ã€‚")]),t._v(" "),s("p",[t._v("æ‰€ä»¥ Broker ä¼šåšå‰¯æœ¬ï¼Œä¿è¯ä¸€æ¡æ¶ˆæ¯è‡³å°‘åŒæ­¥ä¸¤ä¸ªèŠ‚ç‚¹å†è¿”å› ack")]),t._v(" "),s("h4",{attrs:{id:"æ¶ˆè´¹è€…ä¸¢æ•°æ®"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¶ˆè´¹è€…ä¸¢æ•°æ®"}},[t._v("#")]),t._v(" æ¶ˆè´¹è€…ä¸¢æ•°æ®")]),t._v(" "),s("p",[t._v("Consumer ç«¯ä¸¢å¤±æ•°æ®ä¸»è¦ä½“ç°åœ¨ Consumer ç«¯è¦æ¶ˆè´¹çš„æ¶ˆæ¯ä¸è§äº†ã€‚Consumer ç¨‹åºæœ‰ä¸ªâ€œä½ç§»â€çš„æ¦‚å¿µï¼Œè¡¨ç¤ºçš„æ˜¯è¿™ä¸ª Consumer å½“å‰æ¶ˆè´¹åˆ°çš„ Topic åˆ†åŒºçš„ä½ç½®ã€‚ä¸‹é¢è¿™å¼ å›¾æ¸…æ™°åœ°å±•ç¤ºäº† Consumer ç«¯çš„ä½ç§»æ•°æ®ã€‚")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://static001.geekbang.org/resource/image/0c/37/0c97bed3b6350d73a9403d9448290d37.png",alt:""}})]),t._v(" "),s("p",[t._v("æ¯”å¦‚å¯¹äº Consumer A è€Œè¨€ï¼Œå®ƒå½“å‰çš„ä½ç§»å€¼å°±æ˜¯ 9ï¼›Consumer B çš„ä½ç§»å€¼æ˜¯ 11ã€‚")]),t._v(" "),s("p",[t._v("è¿™é‡Œçš„â€œä½ç§»â€ç±»ä¼¼äºæˆ‘ä»¬çœ‹ä¹¦æ—¶ä½¿ç”¨çš„ä¹¦ç­¾ï¼Œå®ƒä¼šæ ‡è®°æˆ‘ä»¬å½“å‰é˜…è¯»äº†å¤šå°‘é¡µï¼Œä¸‹æ¬¡ç¿»ä¹¦çš„æ—¶å€™æˆ‘ä»¬èƒ½ç›´æ¥è·³åˆ°ä¹¦ç­¾é¡µç»§ç»­é˜…è¯»ã€‚")]),t._v(" "),s("p",[t._v("æ­£ç¡®ä½¿ç”¨ä¹¦ç­¾æœ‰ä¸¤ä¸ªæ­¥éª¤ï¼šç¬¬ä¸€æ­¥æ˜¯è¯»ä¹¦ï¼Œç¬¬äºŒæ­¥æ˜¯æ›´æ–°ä¹¦ç­¾é¡µã€‚å¦‚æœè¿™ä¸¤æ­¥çš„é¡ºåºé¢ å€’äº†ï¼Œå°±å¯èƒ½å‡ºç°è¿™æ ·çš„åœºæ™¯ï¼šå½“å‰çš„ä¹¦ç­¾é¡µæ˜¯ç¬¬ 90 é¡µï¼Œæˆ‘å…ˆå°†ä¹¦ç­¾æ”¾åˆ°ç¬¬ 100 é¡µä¸Šï¼Œä¹‹åå¼€å§‹è¯»ä¹¦ã€‚å½“é˜…è¯»åˆ°ç¬¬ 95 é¡µæ—¶ï¼Œæˆ‘ä¸´æ—¶æœ‰äº‹ä¸­æ­¢äº†é˜…è¯»ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå½“æˆ‘ä¸‹æ¬¡ç›´æ¥è·³åˆ°ä¹¦ç­¾é¡µé˜…è¯»æ—¶ï¼Œæˆ‘å°±ä¸¢å¤±äº†ç¬¬ 96ï½99 é¡µçš„å†…å®¹ï¼Œå³è¿™äº›æ¶ˆæ¯å°±ä¸¢å¤±äº†ã€‚")]),t._v(" "),s("p",[t._v("åŒç†ï¼ŒKafka ä¸­ Consumer ç«¯çš„æ¶ˆæ¯ä¸¢å¤±å°±æ˜¯è¿™ä¹ˆä¸€å›äº‹ã€‚è¦å¯¹æŠ—è¿™ç§æ¶ˆæ¯ä¸¢å¤±ï¼ŒåŠæ³•å¾ˆç®€å•ï¼š"),s("strong",[t._v("ç»´æŒå…ˆæ¶ˆè´¹æ¶ˆæ¯ï¼ˆé˜…è¯»ï¼‰ï¼Œå†æ›´æ–°ä½ç§»ï¼ˆä¹¦ç­¾ï¼‰çš„é¡ºåº")]),t._v("å³å¯ã€‚è¿™æ ·å°±èƒ½æœ€å¤§é™åº¦åœ°ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ã€‚")]),t._v(" "),s("p",[t._v("å½“ç„¶ï¼Œè¿™ç§å¤„ç†æ–¹å¼å¯èƒ½å¸¦æ¥çš„é—®é¢˜æ˜¯æ¶ˆæ¯çš„é‡å¤å¤„ç†ï¼Œç±»ä¼¼äºåŒä¸€é¡µä¹¦è¢«è¯»äº†å¾ˆå¤šéï¼Œä½†è¿™ä¸å±äºæ¶ˆæ¯ä¸¢å¤±çš„æƒ…å½¢ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("å¦‚æœæ˜¯å¤šçº¿ç¨‹å¼‚æ­¥å¤„ç†æ¶ˆè´¹æ¶ˆæ¯ï¼ŒConsumer ç¨‹åºä¸è¦å¼€å¯è‡ªåŠ¨æäº¤ä½ç§»ï¼Œè€Œæ˜¯è¦åº”ç”¨ç¨‹åºæ‰‹åŠ¨æäº¤ä½ç§»")]),t._v("ã€‚")]),t._v(" "),s("h4",{attrs:{id:"æœ€ä½³å®è·µ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æœ€ä½³å®è·µ"}},[t._v("#")]),t._v(" æœ€ä½³å®è·µ")]),t._v(" "),s("ol",[s("li",[t._v("ä¸è¦ä½¿ç”¨ producer.send(msg)ï¼Œè€Œè¦ä½¿ç”¨ producer.send(msg, callback)ã€‚è®°ä½ï¼Œä¸€å®šè¦ä½¿ç”¨å¸¦æœ‰å›è°ƒé€šçŸ¥çš„ send æ–¹æ³•ã€‚")]),t._v(" "),s("li",[t._v("è®¾ç½® "),s("code",[t._v("acks = all")]),t._v("ã€‚acks æ˜¯ Producer çš„ä¸€ä¸ªå‚æ•°ï¼Œä»£è¡¨äº†ä½ å¯¹â€œå·²æäº¤â€æ¶ˆæ¯çš„å®šä¹‰ã€‚å¦‚æœè®¾ç½®æˆ allï¼Œåˆ™è¡¨æ˜æ‰€æœ‰å‰¯æœ¬ Broker éƒ½è¦æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯æ‰ç®—æ˜¯â€œå·²æäº¤â€ã€‚è¿™æ˜¯æœ€é«˜ç­‰çº§çš„â€œå·²æäº¤â€å®šä¹‰ã€‚")]),t._v(" "),s("li",[t._v("è®¾ç½® retries ä¸ºä¸€ä¸ªè¾ƒå¤§çš„å€¼ã€‚è¿™é‡Œçš„ retries åŒæ ·æ˜¯ Producer çš„å‚æ•°ï¼Œå¯¹åº”å‰é¢æåˆ°çš„ Producer è‡ªåŠ¨é‡è¯•ã€‚å½“å‡ºç°ç½‘ç»œçš„ç¬æ—¶æŠ–åŠ¨æ—¶ï¼Œæ¶ˆæ¯å‘é€å¯èƒ½ä¼šå¤±è´¥ï¼Œæ­¤æ—¶é…ç½®äº† retries > 0 çš„ Producer èƒ½å¤Ÿè‡ªåŠ¨é‡è¯•æ¶ˆæ¯å‘é€ï¼Œé¿å…æ¶ˆæ¯ä¸¢å¤±ã€‚")]),t._v(" "),s("li",[t._v("è®¾ç½®å‚æ•° "),s("code",[t._v("retry.backoff.ms")]),t._v("ã€‚æŒ‡æ¶ˆæ¯ç”Ÿäº§è¶…æ—¶æˆ–å¤±è´¥åé‡è¯•çš„é—´éš”æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚å¦‚æœé‡è¯•æ—¶é—´å¤ªçŸ­ï¼Œä¼šå‡ºç°ç³»ç»Ÿè¿˜æ²¡æ¢å¤å°±å¼€å§‹é‡è¯•çš„æƒ…å†µï¼Œè¿›è€Œå¯¼è‡´å†æ¬¡å¤±è´¥ã€‚300 æ¯«ç§’ç®—æ˜¯æ¯”è¾ƒåˆé€‚çš„ã€‚")]),t._v(" "),s("li",[t._v("è®¾ç½® "),s("code",[t._v("unclean.leader.election.enable = false")]),t._v("ã€‚è¿™æ˜¯ Broker ç«¯çš„å‚æ•°ï¼ŒæŒ‡æ˜¯å¦èƒ½æŠŠé ISR é›†åˆä¸­çš„å‰¯æœ¬é€‰ä¸¾ä¸º leader å‰¯æœ¬ã€‚unclean.leader.election.enable = trueï¼Œä¹Ÿå°±æ˜¯è¯´å…è®¸é ISR é›†åˆä¸­çš„ follower å‰¯æœ¬æˆä¸º leader å‰¯æœ¬ã€‚å¦‚æœä¸€ä¸ª Broker è½ååŸå…ˆçš„ Leader å¤ªå¤šï¼Œé‚£ä¹ˆå®ƒä¸€æ—¦æˆä¸ºæ–°çš„ Leaderï¼Œå¿…ç„¶ä¼šé€ æˆæ¶ˆæ¯çš„ä¸¢å¤±ã€‚æ•…ä¸€èˆ¬éƒ½è¦å°†è¯¥å‚æ•°è®¾ç½®æˆ falseï¼Œå³ä¸å…è®¸è¿™ç§æƒ…å†µçš„å‘ç”Ÿã€‚")]),t._v(" "),s("li",[t._v("è®¾ç½® "),s("code",[t._v("replication.factor >= 3")]),t._v("ã€‚è¿™ä¹Ÿæ˜¯ Broker ç«¯çš„å‚æ•°ï¼Œè¡¨ç¤ºåˆ†åŒºå‰¯æœ¬çš„ä¸ªæ•°ã€‚å…¶å®è¿™é‡Œæƒ³è¡¨è¿°çš„æ˜¯ï¼Œæœ€å¥½å°†æ¶ˆæ¯å¤šä¿å­˜å‡ ä»½ï¼Œæ¯•ç«Ÿç›®å‰é˜²æ­¢æ¶ˆæ¯ä¸¢å¤±çš„ä¸»è¦æœºåˆ¶å°±æ˜¯å†—ä½™ã€‚")]),t._v(" "),s("li",[t._v("è®¾ç½® "),s("code",[t._v("min.insync.replicas > 1")]),t._v("ã€‚è¿™ä¾ç„¶æ˜¯ Broker ç«¯å‚æ•°ï¼ŒæŒ‡çš„æ˜¯ ISR æœ€å°‘çš„å‰¯æœ¬æ•°é‡ã€‚åœ¨å®é™…ç¯å¢ƒä¸­åƒä¸‡ä¸è¦ä½¿ç”¨é»˜è®¤å€¼ 1ã€‚")]),t._v(" "),s("li",[t._v("ç¡®ä¿ replication.factor > min.insync.replicasã€‚å¦‚æœä¸¤è€…ç›¸ç­‰ï¼Œé‚£ä¹ˆåªè¦æœ‰ä¸€ä¸ªå‰¯æœ¬æŒ‚æœºï¼Œæ•´ä¸ªåˆ†åŒºå°±æ— æ³•æ­£å¸¸å·¥ä½œäº†ã€‚æˆ‘ä»¬ä¸ä»…è¦æ”¹å–„æ¶ˆæ¯çš„æŒä¹…æ€§ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼Œè¿˜è¦åœ¨ä¸é™ä½å¯ç”¨æ€§çš„åŸºç¡€ä¸Šå®Œæˆã€‚æ¨èè®¾ç½®æˆ replication.factor = min.insync.replicas + 1ã€‚")]),t._v(" "),s("li",[t._v("ç¡®ä¿æ¶ˆæ¯æ¶ˆè´¹å®Œæˆå†æäº¤ã€‚Consumer ç«¯æœ‰ä¸ªå‚æ•° "),s("code",[t._v("enable.auto.commit")]),t._v("ï¼Œæœ€å¥½æŠŠå®ƒè®¾ç½®æˆ falseï¼Œå¹¶é‡‡ç”¨æ‰‹åŠ¨æäº¤ä½ç§»çš„æ–¹å¼ã€‚å¦‚æœæŠŠå‚æ•° enable.auto.commit è®¾ç½®ä¸º true å°±è¡¨ç¤ºæ¶ˆæ¯åç§»é‡æ˜¯ç”±æ¶ˆè´¹ç«¯è‡ªåŠ¨æäº¤ï¼Œç”±å¼‚æ­¥çº¿ç¨‹å»å®Œæˆçš„ï¼Œä¸šåŠ¡çº¿ç¨‹æ— æ³•æ§åˆ¶ã€‚å¦‚æœåˆšæ‹‰å–äº†æ¶ˆæ¯ä¹‹åï¼Œä¸šåŠ¡å¤„ç†è¿˜æ²¡è¿›è¡Œå®Œï¼Œè¿™æ—¶æäº¤äº†æ¶ˆæ¯åç§»é‡ä½†æ˜¯æ¶ˆè´¹è€…å´æŒ‚äº†ï¼Œè¿™å°±é€ æˆè¿˜æ²¡è¿›è¡Œå®Œä¸šåŠ¡å¤„ç†çš„æ¶ˆæ¯çš„ä½ç§»è¢«æäº¤äº†ï¼Œä¸‹æ¬¡å†æ¶ˆè´¹å°±æ¶ˆè´¹ä¸åˆ°è¿™äº›æ¶ˆæ¯ï¼Œé€ æˆæ¶ˆæ¯çš„ä¸¢å¤±ã€‚")])]),t._v(" "),s("blockquote",[s("p",[t._v("ç›¸å…³è®¾ç½®")]),t._v(" "),s("ul",[s("li",[t._v("Producerï¼šackï¼Œ retry")]),t._v(" "),s("li",[t._v("Broker: replicaã€min_isrã€unclen.electronã€log.flush.messages")]),t._v(" "),s("li",[t._v("Consumer: offset_commit")])])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafka-å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafka-å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹"}},[t._v("#")]),t._v(" ğŸ¯ Kafka å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹ï¼Ÿ")]),t._v(" "),s("blockquote",[s("p",[t._v('"é‡å¤æ¶ˆè´¹æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¸¸è§çš„é—®é¢˜ï¼Œæˆ‘ä¸»è¦é€šè¿‡ä»¥ä¸‹æ–¹å¼å¤„ç†ï¼š')]),t._v(" "),s("p",[s("strong",[t._v("å¹‚ç­‰æ€§è®¾è®¡ï¼š")])]),t._v(" "),s("ul",[s("li",[t._v("åœ¨ä¸šåŠ¡å±‚é¢å®ç°å¹‚ç­‰æ€§ï¼Œå¦‚ä½¿ç”¨å”¯ä¸€æ ‡è¯†ç¬¦")]),t._v(" "),s("li",[t._v("æ•°æ®åº“å±‚é¢ä½¿ç”¨å”¯ä¸€çº¦æŸ")])]),t._v(" "),s("p",[s("strong",[t._v("å»é‡æœºåˆ¶ï¼š")])]),t._v(" "),s("ul",[s("li",[t._v("ä½¿ç”¨Redisæˆ–æœ¬åœ°ç¼“å­˜è®°å½•å·²å¤„ç†çš„æ¶ˆæ¯ID")]),t._v(" "),s("li",[t._v("è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´")])]),t._v(" "),s("p",[s("strong",[t._v("ä¸šåŠ¡è¡¥å¿ï¼š")])]),t._v(" "),s("ul",[s("li",[t._v("å¯¹äºä¸èƒ½å®Œå…¨é¿å…é‡å¤çš„åœºæ™¯ï¼Œè®¾è®¡è¡¥å¿æœºåˆ¶")]),t._v(" "),s("li",[t._v("å®šæœŸå¯¹è´¦å’Œæ•°æ®ä¿®å¤")])]),t._v(" "),s("p",[t._v('åœ¨æˆ‘ä»¬çš„è®¢å•ç³»ç»Ÿä¸­ï¼Œæˆ‘ä½¿ç”¨è®¢å•å·ä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼Œåœ¨å¤„ç†å‰å…ˆæ£€æŸ¥è®¢å•çŠ¶æ€ï¼Œç¡®ä¿æ¯ä¸ªè®¢å•åªå¤„ç†ä¸€æ¬¡ã€‚"')])]),t._v(" "),s("p",[t._v("Kafka åˆæ˜¯å¦‚ä½•åšåˆ°æ¶ˆæ¯ä¸é‡å¤çš„ï¼Œä¹Ÿå°±æ˜¯ï¼šç”Ÿäº§ç«¯ä¸é‡å¤ç”Ÿäº§æ¶ˆæ¯ï¼ŒæœåŠ¡ç«¯ä¸é‡å¤å­˜å‚¨æ¶ˆæ¯ï¼Œæ¶ˆè´¹ç«¯ä¹Ÿä¸èƒ½é‡å¤æ¶ˆè´¹æ¶ˆæ¯ã€‚")]),t._v(" "),s("p",[t._v("ç›¸è¾ƒä¸Šé¢â€œæ¶ˆæ¯ä¸ä¸¢å¤±â€çš„åœºæ™¯ï¼Œâ€œæ¶ˆæ¯ä¸é‡å¤â€çš„æœåŠ¡ç«¯æ— é¡»åšç‰¹åˆ«çš„é…ç½®ï¼Œå› ä¸ºæœåŠ¡ç«¯ä¸ä¼šé‡å¤å­˜å‚¨æ¶ˆæ¯ï¼Œå¦‚æœæœ‰é‡å¤æ¶ˆæ¯ä¹Ÿåº”è¯¥æ˜¯ç”±ç”Ÿäº§ç«¯é‡å¤å‘é€é€ æˆçš„ã€‚")]),t._v(" "),s("h4",{attrs:{id:"ç”Ÿäº§è€…-ä¸é‡å¤ç”Ÿäº§æ¶ˆæ¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ç”Ÿäº§è€…-ä¸é‡å¤ç”Ÿäº§æ¶ˆæ¯"}},[t._v("#")]),t._v(" ç”Ÿäº§è€…ï¼šä¸é‡å¤ç”Ÿäº§æ¶ˆæ¯")]),t._v(" "),s("p",[t._v("ç”Ÿäº§ç«¯å‘é€æ¶ˆæ¯åï¼ŒæœåŠ¡ç«¯å·²ç»æ”¶åˆ°æ¶ˆæ¯äº†ï¼Œä½†æ˜¯å‡å¦‚é‡åˆ°ç½‘ç»œé—®é¢˜ï¼Œæ— æ³•è·å¾—å“åº”ï¼Œç”Ÿäº§ç«¯å°±æ— æ³•åˆ¤æ–­è¯¥æ¶ˆæ¯æ˜¯å¦æˆåŠŸæäº¤åˆ°äº† Kafkaï¼Œè€Œæˆ‘ä»¬ä¸€èˆ¬ä¼šé…ç½®é‡è¯•æ¬¡æ•°ï¼Œä½†è¿™æ ·ä¼šå¼•å‘ç”Ÿäº§ç«¯é‡æ–°å‘é€åŒä¸€æ¡æ¶ˆæ¯ï¼Œä»è€Œé€ æˆæ¶ˆæ¯é‡å¤çš„å‘é€ã€‚")]),t._v(" "),s("p",[t._v("å¯¹äºè¿™ä¸ªé—®é¢˜ï¼ŒKafka 0.11.0 çš„ç‰ˆæœ¬ä¹‹å‰å¹¶æ²¡æœ‰ä»€ä¹ˆè§£å†³æ–¹æ¡ˆï¼Œä¸è¿‡ä» 0.11.0 çš„ç‰ˆæœ¬å¼€å§‹ï¼ŒKafka ç»™æ¯ä¸ªç”Ÿäº§ç«¯ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ IDï¼Œå¹¶ä¸”åœ¨æ¯æ¡æ¶ˆæ¯ä¸­ç”Ÿæˆä¸€ä¸ª sequence numï¼Œsequence num æ˜¯é€’å¢ä¸”å”¯ä¸€çš„ï¼Œè¿™æ ·å°±èƒ½å¯¹æ¶ˆæ¯å»é‡ï¼Œè¾¾åˆ°ä¸€ä¸ªç”Ÿäº§ç«¯ä¸é‡å¤å‘é€ä¸€æ¡æ¶ˆæ¯çš„ç›®çš„ã€‚")]),t._v(" "),s("p",[t._v("ä½†æ˜¯è¿™ä¸ªæ–¹æ³•æ˜¯æœ‰å±€é™æ€§çš„ï¼Œåªå¯¹åœ¨ä¸€ä¸ªç”Ÿäº§ç«¯å†…ç”Ÿäº§çš„æ¶ˆæ¯æœ‰æ•ˆï¼Œå¦‚æœä¸€ä¸ªæ¶ˆæ¯åˆ†åˆ«åœ¨ä¸¤ä¸ªç”Ÿäº§ç«¯å‘é€å°±ä¸è¡Œäº†ï¼Œè¿˜æ˜¯ä¼šé€ æˆæ¶ˆæ¯çš„é‡å¤å‘é€ã€‚å¥½åœ¨è¿™ç§å¯èƒ½æ€§æ¯”è¾ƒå°ï¼Œå› ä¸ºæ¶ˆæ¯çš„é‡è¯•ä¸€èˆ¬ä¼šåœ¨ä¸€ä¸ªç”Ÿäº§ç«¯å†…è¿›è¡Œã€‚å½“ç„¶ï¼Œå¯¹åº”ä¸€ä¸ªæ¶ˆæ¯åˆ†åˆ«åœ¨ä¸¤ä¸ªç”Ÿäº§ç«¯å‘é€çš„è¯·æ±‚æˆ‘ä»¬ä¹Ÿæœ‰æ–¹æ¡ˆï¼Œåªæ˜¯è¦å¤šåšä¸€äº›è¡¥å¿çš„å·¥ä½œï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæ¯ä¸€ä¸ªæ¶ˆæ¯åˆ†é…ä¸€ä¸ªå…¨å±€ IDï¼Œå¹¶æŠŠå…¨å±€ ID å­˜æ”¾åœ¨è¿œç¨‹ç¼“å­˜æˆ–å…³ç³»å‹æ•°æ®åº“é‡Œï¼Œè¿™æ ·åœ¨å‘é€å‰å¯ä»¥åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦å·²ç»å‘é€è¿‡äº†ã€‚")]),t._v(" "),s("blockquote",[s("p",[t._v("ä¿è¯æ¶ˆæ¯é˜Ÿåˆ—çš„å¹‚ç­‰æ€§çš„æ–¹æ¡ˆï¼Ÿ")]),t._v(" "),s("ol",[s("li",[t._v("å‘æ•°æ®åº“insertæ•°æ®æ—¶ï¼Œå…ˆ"),s("strong",[t._v("æ ¹æ®ä¸»é”®æŸ¥è¯¢ï¼Œè‹¥æ•°æ®å­˜åœ¨åˆ™ä¸insertï¼Œæ”¹ä¸ºupdate")])]),t._v(" "),s("li",[t._v("å‘Redisä¸­å†™æ•°æ®å¯ä»¥ç”¨"),s("strong",[t._v("setå»é‡ï¼Œå¤©ç„¶ä¿è¯å¹‚ç­‰æ€§")])]),t._v(" "),s("li",[t._v("ç”Ÿäº§è€…å‘é€æ¯æ¡æ¶ˆæ¯æ—¶ï¼Œå¢åŠ ä¸€ä¸ªå…¨å±€å”¯ä¸€idï¼ˆç±»ä¼¼è®¢å•idï¼‰ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹åˆ°æ—¶ï¼Œå…ˆ"),s("strong",[t._v("æ ¹æ®è¿™ä¸ªidå»Redisä¸­æŸ¥è¯¢æ˜¯å¦æ¶ˆè´¹è¿‡è¯¥æ¶ˆæ¯")]),t._v("ã€‚å¦‚æœæ²¡æœ‰æ¶ˆè´¹è¿‡ï¼Œå°±å¤„ç†ï¼Œå°†idå†™å…¥Redisï¼›å¦‚æœæ¶ˆè´¹è¿‡äº†ï¼Œé‚£ä¹ˆå°±ä¸å¤„ç†ï¼Œä¿è¯ä¸é‡å¤å¤„ç†ç›¸åŒæ¶ˆæ¯ã€‚")]),t._v(" "),s("li",[t._v("åŸºäºæ•°æ®åº“çš„"),s("strong",[t._v("å”¯ä¸€é”®çº¦æŸ")]),t._v("æ¥ä¿è¯ä¸ä¼šæ’å…¥é‡å¤çš„æ•°æ®ï¼Œå½“æ¶ˆè´¹è€…ä¼å›¾æ’å…¥é‡å¤æ•°æ®åˆ°æ•°æ®åº“æ—¶ï¼Œä¼šæŠ¥é”™ã€‚")])]),t._v(" "),s("p",[t._v("å¦‚æœæ•°æ®é‡è¶…çº§å¤§çš„è¯ï¼Œè¿˜æœ‰ç§æ–¹æ¡ˆä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨ + redis çš„æ–¹æ¡ˆ + å”¯ä¸€ç´¢å¼•ï¼Œ"),s("strong",[t._v("å±‚å±‚å‰Šæµ")]),t._v("ï¼Œå°±æ˜¯"),s("strong",[t._v("ç¡®ä¿åˆ°è¾¾æ•°æ®åº“çš„æµé‡æœ€å°åŒ–")]),t._v("ã€‚")]),t._v(" "),s("p",[t._v("é¦–å…ˆï¼Œä¸€ä¸ªè¯·æ±‚è¿‡æ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šåˆ©ç”¨å¸ƒéš†è¿‡æ»¤å™¨æ¥åˆ¤æ–­å®ƒæœ‰æ²¡æœ‰è¢«å¤„ç†è¿‡ã€‚å¦‚æœå¸ƒéš†è¿‡æ»¤å™¨è¯´æ²¡æœ‰å¤„ç†è¿‡ï¼Œé‚£ä¹ˆå°±ç¡®å®æ²¡æœ‰è¢«å¤„ç†è¿‡ï¼Œå¯ä»¥ç›´æ¥å¤„ç†ã€‚å¦‚æœå¸ƒéš†è¿‡æ»¤å™¨è¯´å¤„ç†è¿‡ï¼ˆå¯èƒ½æ˜¯å‡é˜³æ€§ï¼‰ï¼Œé‚£ä¹ˆå°±è¦æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚")]),t._v(" "),s("p",[t._v("ç¬¬äºŒæ­¥å°±æ˜¯åˆ©ç”¨ Redis å­˜å‚¨è¿‘æœŸå¤„ç†è¿‡çš„ keyã€‚å¦‚æœ Redis é‡Œé¢æœ‰è¿™ä¸ª keyï¼Œè¯´æ˜å®ƒçš„ç¡®è¢«å¤„ç†è¿‡äº†ï¼Œç›´æ¥è¿”å›ï¼Œå¦åˆ™è¿›å…¥ç¬¬ä¸‰æ­¥ã€‚è¿™ä¸€æ­¥çš„å…³é”®å°±æ˜¯ keyçš„è¿‡æœŸæ—¶é—´åº”è¯¥æ˜¯å¤šé•¿ã€‚")]),t._v(" "),s("p",[t._v("ç¬¬ä¸‰æ­¥åˆ™æ˜¯åˆ©ç”¨å”¯ä¸€ç´¢å¼•ï¼Œå¦‚æœå”¯ä¸€ç´¢å¼•å†²çªäº†ï¼Œé‚£ä¹ˆå°±ä»£è¡¨å·²ç»å¤„ç†è¿‡äº†ã€‚è¿™ä¸ªå”¯ä¸€ç´¢å¼•ä¸€èˆ¬å°±æ˜¯ä¸šåŠ¡çš„å”¯ä¸€ç´¢å¼•ï¼Œå¹¶ä¸éœ€è¦é¢å¤–åˆ›å»ºä¸€ä¸ªç´¢å¼•ã€‚")])]),t._v(" "),s("h4",{attrs:{id:"æ¶ˆè´¹ç«¯-ä¸èƒ½é‡å¤æ¶ˆè´¹æ¶ˆæ¯"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ¶ˆè´¹ç«¯-ä¸èƒ½é‡å¤æ¶ˆè´¹æ¶ˆæ¯"}},[t._v("#")]),t._v(" æ¶ˆè´¹ç«¯ï¼šä¸èƒ½é‡å¤æ¶ˆè´¹æ¶ˆæ¯")]),t._v(" "),s("p",[t._v("æ¯”å¦‚è¯´ä½ åœ¨å¤„ç†æ¶ˆæ¯å®Œæ¯•ä¹‹åï¼Œå‡†å¤‡æäº¤äº†ã€‚è¿™ä¸ªæ—¶å€™çªç„¶å®•æœºäº†ï¼Œæ²¡æœ‰æäº¤ã€‚ç­‰æ¢å¤è¿‡æ¥ï¼Œä½ ä¼šå†æ¬¡æ¶ˆè´¹åŒä¸€ä¸ªæ¶ˆæ¯ã€‚")]),t._v(" "),s("p",[t._v("ä¸ºäº†ä¿è¯æ¶ˆæ¯ä¸é‡å¤ï¼Œæ¶ˆè´¹ç«¯å°±ä¸èƒ½é‡å¤æ¶ˆè´¹æ¶ˆæ¯ï¼Œè¯¥å¦‚ä½•å»å®ç°å‘¢ï¼Ÿæ¶ˆè´¹ç«¯éœ€è¦åšå¥½å¦‚ä¸‹é…ç½®ã€‚")]),t._v(" "),s("p",[t._v("ç¬¬ä¸€æ­¥ï¼Œè®¾ç½® "),s("code",[t._v("enable.auto.commit=false")]),t._v("ã€‚è·Ÿå‰é¢ä¸€æ ·ï¼Œè¿™é‡ŒåŒæ ·è¦é¿å…è‡ªåŠ¨æäº¤åç§»é‡ã€‚ä½ å¯ä»¥æƒ³è±¡è¿™æ ·ä¸€ç§æƒ…å†µï¼Œæ¶ˆè´¹ç«¯æ‹‰å–æ¶ˆæ¯å’Œå¤„ç†æ¶ˆæ¯éƒ½å®Œæˆäº†ï¼Œä½†æ˜¯è‡ªåŠ¨æäº¤åç§»é‡è¿˜æ²¡æäº¤æ¶ˆè´¹ç«¯å´æŒ‚äº†ï¼Œè¿™æ—¶å€™ Kafka æ¶ˆè´¹ç»„å¼€å§‹é‡æ–°å¹³è¡¡å¹¶æŠŠåˆ†åŒºåˆ†ç»™å¦ä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œç”±äºåç§»é‡æ²¡æäº¤æ–°çš„æ¶ˆè´¹è€…ä¼šé‡å¤æ‹‰å–æ¶ˆæ¯ï¼Œè¿™å°±æœ€ç»ˆé€ æˆé‡å¤æ¶ˆè´¹æ¶ˆæ¯ã€‚")]),t._v(" "),s("p",[t._v("ç¬¬äºŒæ­¥ï¼Œå•çº¯é…æˆæ‰‹åŠ¨æäº¤åŒæ ·ä¸èƒ½é¿å…é‡å¤æ¶ˆè´¹ï¼Œè¿˜éœ€è¦æ¶ˆè´¹ç«¯ä½¿ç”¨æ­£ç¡®çš„æ¶ˆè´¹â€œå§¿åŠ¿â€ã€‚è¿™é‡Œè¿˜æ˜¯å…ˆçœ‹ä¸‹å›¾è¿™ç§æƒ…å†µï¼š")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://s0.lgstatic.com/i/image6/M01/4D/0A/Cgp9HWDtPCWAYncVABfKsdCDbq0367.png",alt:""}})]),t._v(" "),s("p",[t._v("æ¶ˆè´¹è€…æ‹‰å–æ¶ˆæ¯åï¼Œå…ˆæäº¤ offset åå†å¤„ç†æ¶ˆæ¯ï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºç°é‡å¤æ¶ˆè´¹æ¶ˆæ¯çš„å¯èƒ½ã€‚ä½†æ˜¯ä½ å¯ä»¥æƒ³è±¡è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šåœ¨æäº¤ offset ä¹‹åã€ä¸šåŠ¡é€»è¾‘å¤„ç†æ¶ˆæ¯ä¹‹å‰å‡ºç°äº†å®•æœºï¼Œå¾…æ¶ˆè´¹è€…é‡æ–°ä¸Šçº¿æ—¶ï¼Œå°±æ— æ³•è¯»åˆ°åˆšåˆšå·²ç»æäº¤è€Œæœªå¤„ç†çš„è¿™éƒ¨åˆ†æ¶ˆæ¯ï¼ˆè¿™é‡Œå¯¹åº”å›¾ä¸­ 5~8 è¿™éƒ¨åˆ†æ¶ˆæ¯ï¼‰ï¼Œè¿˜æ˜¯ä¼šæœ‰å°‘æ¶ˆè´¹æ¶ˆæ¯çš„æƒ…å†µã€‚")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" messages "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" consumer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("poll")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsumer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("commitOffset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("processMsg")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("messages"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"ğŸ¯-kafka-å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ¶ˆè´¹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafka-å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ¶ˆè´¹"}},[t._v("#")]),t._v(" ğŸ¯ Kafka å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ¶ˆè´¹?")]),t._v(" "),s("blockquote",[s("p",[t._v("å¦‚æœä½ ç”¨çš„æ˜¯å•åˆ†åŒºè§£å†³æ–¹æ¡ˆï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰æ¶ˆæ¯ç§¯å‹é—®é¢˜ï¼Ÿå¦‚æœæœ‰ï¼Œä½ æ˜¯æ€ä¹ˆè§£å†³çš„ï¼Ÿ")]),t._v(" "),s("p",[t._v("å¦‚æœä½ ç”¨çš„æ˜¯å¤šåˆ†åŒºè§£å†³æ–¹æ¡ˆï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰åˆ†åŒºè´Ÿè½½ä¸å‡è¡¡çš„é—®é¢˜ï¼Ÿå¦‚æœæœ‰ï¼Œä½ æ˜¯æ€ä¹ˆè§£å†³çš„ï¼Ÿ")])]),t._v(" "),s("p",[t._v('"Kafkaçš„é¡ºåºæ€§ä¿è¯åˆ†ä¸ºå‡ ä¸ªå±‚é¢ï¼š')]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("åˆ†åŒºå†…æœ‰åº")]),t._v("ï¼šåŒä¸€åˆ†åŒºå†…çš„æ¶ˆæ¯æ˜¯æœ‰åºçš„")]),t._v(" "),s("li",[s("strong",[t._v("å…¨å±€æœ‰åº")]),t._v("ï¼šéœ€è¦å°†Topicè®¾ç½®ä¸º1ä¸ªåˆ†åŒºï¼Œä½†ä¼šå½±å“å¹¶å‘æ€§èƒ½")]),t._v(" "),s("li",[s("strong",[t._v("ä¸šåŠ¡æœ‰åº")]),t._v("ï¼šé€šè¿‡åˆç†çš„åˆ†åŒºç­–ç•¥ï¼Œå¦‚ä½¿ç”¨ç”¨æˆ·IDåškey")])]),t._v(" "),s("p",[t._v("åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œå¯¹äºéœ€è¦ä¿è¯é¡ºåºçš„åœºæ™¯ï¼Œæˆ‘é‡‡ç”¨ä»¥ä¸‹ç­–ç•¥ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("å°†ç›¸å…³è”çš„æ¶ˆæ¯å‘é€åˆ°åŒä¸€åˆ†åŒºï¼ˆä½¿ç”¨ç›¸åŒçš„keyï¼‰")]),t._v(" "),s("li",[t._v("åœ¨æ¶ˆè´¹ç«¯ä½¿ç”¨å•çº¿ç¨‹æ¶ˆè´¹")]),t._v(" "),s("li",[t._v("å¯¹äºä¸¥æ ¼é¡ºåºè¦æ±‚çš„åœºæ™¯ï¼Œæˆ‘ä»¬ä¼šåœ¨ä¸šåŠ¡å±‚é¢å¢åŠ ç‰ˆæœ¬å·æˆ–æ—¶é—´æˆ³è¿›è¡Œæ’åºâ€")])]),t._v(" "),s("blockquote",[s("ul",[s("li",[s("p",[t._v("å•åˆ†åŒºä¼šç§¯å‹ï¼Ÿä¸‰æ‹›ï¼šæ‰¹é‡+å‹ç¼©æååï¼›æ¶ˆè´¹è€…â€œåŒKeyä¸²è¡Œã€è·¨Keyå¹¶è¡Œâ€ï¼›é¡¶ä¸ä½å°±è½¬æŒ‰Keyå¤šåˆ†åŒºã€‚")])]),t._v(" "),s("li",[s("p",[t._v("å¤šåˆ†åŒºä¼šä¸å‡è¡¡ï¼Ÿä¸¤æ‹›ï¼šä¸€è‡´æ€§å“ˆå¸Œ/è™šæ‹ŸèŠ‚ç‚¹ï¼›çƒ­ç‚¹Keyå¯è¯­ä¹‰åˆ†è£‚ï¼ˆå¦‚ user#vnodeï¼‰ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("æ‰©åˆ†åŒºä¼šä¹±åºï¼Ÿä¸¤æ‹›ï¼šå›ºå®šâ€œæ§½â†’åˆ†åŒºâ€æ˜ å°„é˜²æ¼‚ç§»ï¼›åŒå†™ç°åº¦/æš‚åœ-æ’å¹²-åˆ‡æ¢å¹³æ»‘è¿ç§»ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("ç”Ÿäº§ç«¯é¡ºåºä¸å¯é ï¼šenable.idempotence=trueï¼Œacks=allï¼Œretries=âˆï¼›å¼ºé¡ºåºé€šé“è®¾ max.in.flight=1ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("æ¶ˆè´¹ç«¯æäº¤ï¼šå…ˆå¤„ç†å†æäº¤ï¼ˆenable.auto.commit=falseï¼‰ï¼›å¿…è¦æ—¶äº‹åŠ¡ sendOffsetsToTransactionã€‚")])]),t._v(" "),s("li",[s("p",[t._v("Rebalanceç¨³æ€ï¼šç”¨ååŒç²˜æ€§+é™æ€æˆå‘˜ï¼›onPartitionsRevoked æäº¤å·²å¤„ç†ï¼ŒonPartitionsAssigned æ¢å¤æŒ‡é’ˆã€‚")])]),t._v(" "),s("li",[s("p",[t._v("ä¸€å¥è¯ï¼šæŒ‰Keyè¿›åŒåˆ†åŒºã€åŒKeyä¸²è¡Œè·¨Keyå¹¶è¡Œï¼Œé…åˆå¹‚ç­‰+å¼ºé¡ºåºé€šé“ä¸å¹³æ»‘æ‰©åˆ†åŒºï¼Œé¡ºåºä¸åååŒæ—¶æ‹¿åˆ°ã€‚")])])])]),t._v(" "),s("p",[s("strong",[t._v("å•åˆ†åŒºæ–¹æ¡ˆ â€”â€” æ¶ˆæ¯ç§¯å‹é—®é¢˜")])]),t._v(" "),s("p",[s("strong",[t._v("é—®é¢˜ï¼š")])]),t._v(" "),s("ul",[s("li",[t._v("å•åˆ†åŒºè™½ç„¶èƒ½ä¿è¯å¼ºé¡ºåºï¼Œä½†ååé‡å—é™ã€‚")]),t._v(" "),s("li",[t._v("å¦‚æœæ¶ˆè´¹é€Ÿåº¦è·Ÿä¸ä¸Šç”Ÿäº§é€Ÿåº¦ï¼Œå°±ä¼šäº§ç”Ÿæ¶ˆæ¯ç§¯å‹ã€‚")])]),t._v(" "),s("p",[s("strong",[t._v("è§£å†³æ–¹æ¡ˆï¼š")])]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("æ¶ˆè´¹ç«¯ä¼˜åŒ–")]),t._v(" "),s("ul",[s("li",[t._v("ä½¿ç”¨æ‰¹é‡æ‹‰å– + æ‰¹é‡å¤„ç†ã€‚")]),t._v(" "),s("li",[t._v("ä½¿ç”¨å¼‚æ­¥ I/O æå‡å•çº¿ç¨‹æ¶ˆè´¹æ€§èƒ½ã€‚")])])]),t._v(" "),s("li",[s("strong",[t._v("å¢åŠ åˆ†åŒºæ•°ï¼Œæå‡å¹¶è¡Œåº¦")]),t._v(" "),s("ul",[s("li",[t._v("å¦‚æœä¸šåŠ¡å…è®¸å±€éƒ¨æœ‰åºï¼ˆæ¯”å¦‚æŒ‰ç”¨æˆ· IDã€è®¢å•å·ï¼‰ï¼Œå¯ä»¥æŠŠå•åˆ†åŒºæ‹†æˆå¤šä¸ªåˆ†åŒºã€‚")])])]),t._v(" "),s("li",[s("strong",[t._v("æ¶ˆæ¯å †ç§¯åº”æ€¥å¤„ç†")]),t._v(" "),s("ul",[s("li",[t._v("ä¸´æ—¶å¢åŠ æ¶ˆè´¹è€…å®ä¾‹ï¼ˆå¦‚æœåˆ†åŒºè¶³å¤Ÿå¤šï¼‰ã€‚")]),t._v(" "),s("li",[t._v("ä½¿ç”¨ Kafka MirrorMaker / DataBusï¼ŒæŠŠæ•°æ®è½¬å‚¨åˆ°å¤§æ•°æ®ç³»ç»Ÿåšç¦»çº¿å¤„ç†ã€‚")])])])]),t._v(" "),s("p",[s("strong",[t._v("å¤šåˆ†åŒºæ–¹æ¡ˆ â€”â€” åˆ†åŒºè´Ÿè½½ä¸å‡è¡¡é—®é¢˜")])]),t._v(" "),s("p",[s("strong",[t._v("é—®é¢˜ï¼š")])]),t._v(" "),s("ul",[s("li",[t._v("åˆ†åŒºå¤šäº†èƒ½æå‡ååï¼Œä½†å¯èƒ½å‡ºç°ï¼š\n"),s("ul",[s("li",[t._v("æŸäº›åˆ†åŒºæµé‡å¾ˆå¤§ï¼ˆçƒ­ç‚¹ Keyï¼‰ï¼Œå¯¼è‡´ "),s("strong",[t._v("æ¶ˆè´¹è´Ÿè½½ä¸å‡è¡¡")]),t._v("ã€‚")]),t._v(" "),s("li",[t._v("æŸäº›åˆ†åŒºç§¯å‹ä¸¥é‡ï¼Œå…¶ä»–åˆ†åŒºå´å¾ˆç©ºé—²ã€‚")])])])]),t._v(" "),s("p",[s("strong",[t._v("è§£å†³æ–¹æ¡ˆï¼š")])]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("åˆç†è®¾è®¡åˆ†åŒºç­–ç•¥")])]),t._v(" "),s("ul",[s("li",[t._v("æŒ‰ "),s("strong",[t._v("Key å“ˆå¸Œåˆ†åŒº")]),t._v("ï¼Œé¿å…æ‰€æœ‰æ•°æ®è½åˆ°æŸå‡ ä¸ªåˆ†åŒºã€‚")]),t._v(" "),s("li",[t._v("å¯¹äºçƒ­ç‚¹ Keyï¼Œå¯ä»¥åš "),s("strong",[t._v("Key æ‹†åˆ†")]),t._v("ï¼ˆæ¯”å¦‚ userId%10 ä½œä¸ºæ–° Keyï¼‰ï¼Œè®©çƒ­ç‚¹ç”¨æˆ·çš„è¯·æ±‚åˆ†æ•£åˆ°å¤šä¸ªåˆ†åŒºã€‚")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("å¢åŠ åˆ†åŒºå¹¶åšæ•°æ®é‡åˆ†å¸ƒ")])]),t._v(" "),s("ul",[s("li",[t._v("åœ¨ Kafka 2.4+ ç‰ˆæœ¬æ”¯æŒ "),s("strong",[t._v("åˆ†åŒºé‡åˆ†é…")]),t._v("ï¼Œå¯ä»¥è°ƒæ•´ partition ä¸ broker çš„æ˜ å°„ã€‚")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("æ¶ˆè´¹ç«¯å¹¶å‘ä¼˜åŒ–")])]),t._v(" "),s("ul",[s("li",[t._v("ä½¿ç”¨å¤šçº¿ç¨‹æ¶ˆè´¹ï¼ˆä¸€ä¸ª Consumer æ‹‰å– â†’ çº¿ç¨‹æ± å¤„ç†ï¼‰ã€‚")]),t._v(" "),s("li",[t._v("æˆ–è€…ä½¿ç”¨å¤šä¸ª Consumer å®ä¾‹ï¼ˆå‰ææ˜¯åˆ†åŒºè¶³å¤Ÿå¤šï¼‰ã€‚")])])])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafka-å¦‚ä½•å¤„ç†æ¶ˆæ¯ç§¯å‹é—®é¢˜"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafka-å¦‚ä½•å¤„ç†æ¶ˆæ¯ç§¯å‹é—®é¢˜"}},[t._v("#")]),t._v(" ğŸ¯ Kafka å¦‚ä½•å¤„ç†æ¶ˆæ¯ç§¯å‹é—®é¢˜ï¼Ÿ")]),t._v(" "),s("blockquote",[s("p",[t._v("ä½ ä»¬å…¬å¸æ¶ˆæ¯é˜Ÿåˆ—çš„ç›‘æ§æœ‰å“ªäº›ï¼Ÿå¯ä»¥åˆ©ç”¨å“ªäº›ç›‘æ§æŒ‡æ ‡æ¥ç¡®å®šæ¶ˆæ¯æ˜¯å¦ç§¯å‹ï¼Ÿ åœ¨å‘ç°æ¶ˆæ¯ç§¯å‹çš„æ—¶å€™ï¼Œèƒ½ä¸èƒ½åˆ©ç”¨ç›‘æ§çš„æ¶ˆè´¹é€Ÿç‡å’Œç”Ÿäº§é€Ÿç‡ï¼Œæ¥æ¨æ–­å¤šä¹…ä»¥åç§¯å‹çš„ æ¶ˆæ¯ä¼šè¢«å¤„ç†å®Œæ¯•ï¼Ÿ ä½ ä»¬å…¬å¸æ¶ˆæ¯ç§¯å‹çš„çœŸå®æ¡ˆä¾‹ï¼ŒåŒ…æ‹¬æ•…éšœåŸå› ã€å‘ç°å’Œå®šä½è¿‡ç¨‹ã€æœ€ç»ˆè§£å†³æ–¹æ¡ˆã€‚ ä½ è´Ÿè´£çš„ä¸šåŠ¡ä½¿ç”¨çš„ topic è¿˜æœ‰å¯¹åº”çš„åˆ†åŒºæ•°é‡ã€‚")]),t._v(" "),s("p",[t._v("ä½ çš„ä¸šåŠ¡ topic é‡Œé¢ç”¨äº†å‡ ä¸ªåˆ†åŒºï¼Ÿä½ æ˜¯æ€ä¹ˆç¡®å®šåˆ†åŒºæ•°é‡çš„ï¼Ÿ")]),t._v(" "),s("p",[t._v("å¦‚æœåˆ†åŒºæ•°é‡ä¸å¤Ÿä¼šå‘ç”Ÿ ä»€ä¹ˆï¼Ÿ ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‘ç”Ÿæ¶ˆæ¯ç§¯å‹ï¼Ÿæ€ä¹ˆè§£å†³æ¶ˆæ¯ç§¯å‹çš„é—®é¢˜ï¼Ÿ")]),t._v(" "),s("p",[t._v("åœ¨å¼‚æ­¥æ¶ˆè´¹çš„æ—¶å€™ï¼Œå¦‚æœä½ æ‹‰å–äº†ä¸€æ‰¹æ¶ˆæ¯ï¼Œè¿˜æ²¡æ¥å¾—åŠæäº¤å°±å®•æœºäº†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ")])]),t._v(" "),s("p",[t._v("å¦‚æœå‡ºç°ç§¯å‹ï¼Œé‚£ä¸€å®šæ˜¯æ€§èƒ½é—®é¢˜ï¼Œæƒ³è¦è§£å†³æ¶ˆæ¯ä»ç”Ÿäº§åˆ°æ¶ˆè´¹ä¸Šçš„æ€§èƒ½é—®é¢˜ï¼Œå°±é¦–å…ˆè¦çŸ¥é“å“ªäº›ç¯èŠ‚å¯èƒ½å‡ºç°æ¶ˆæ¯ç§¯å‹ï¼Œç„¶ååœ¨è€ƒè™‘å¦‚ä½•è§£å†³ã€‚")]),t._v(" "),s("p",[t._v("å› ä¸ºæ¶ˆæ¯å‘é€ä¹‹åæ‰ä¼šå‡ºç°ç§¯å‹çš„é—®é¢˜ï¼Œæ‰€ä»¥å’Œæ¶ˆæ¯ç”Ÿäº§ç«¯æ²¡æœ‰å…³ç³»ï¼Œåˆå› ä¸ºç»å¤§éƒ¨åˆ†çš„æ¶ˆæ¯é˜Ÿåˆ—å•èŠ‚ç‚¹éƒ½èƒ½è¾¾åˆ°æ¯ç§’é’Ÿå‡ ä¸‡çš„å¤„ç†èƒ½åŠ›ï¼Œç›¸å¯¹äºä¸šåŠ¡é€»è¾‘æ¥è¯´ï¼Œæ€§èƒ½ä¸ä¼šå‡ºç°åœ¨ä¸­é—´ä»¶çš„æ¶ˆæ¯å­˜å‚¨ä¸Šé¢ã€‚æ¯«æ— ç–‘é—®ï¼Œå‡ºé—®é¢˜çš„è‚¯å®šæ˜¯æ¶ˆæ¯æ¶ˆè´¹é˜¶æ®µï¼Œé‚£ä¹ˆä»æ¶ˆè´¹ç«¯å…¥æ‰‹ï¼Œå¦‚ä½•å›ç­”å‘¢ï¼Ÿ")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("æé«˜æ¶ˆè´¹è€…çš„å¤„ç†èƒ½åŠ›")])])]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("å¢åŠ æ¶ˆè´¹è€…å®ä¾‹")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("å¯ä»¥é€šè¿‡å¢åŠ æ¶ˆè´¹è€…å®ä¾‹æ¥æé«˜æ¶ˆæ¯å¤„ç†èƒ½åŠ›ã€‚è¿™å¯ä»¥é€šè¿‡å¢åŠ æ¶ˆè´¹è€…æ•°é‡æ¥å®ç°ï¼Œç¡®ä¿æ¯ä¸ªåˆ†åŒºéƒ½æœ‰ä¸€ä¸ªæ¶ˆè´¹è€…è¿›è¡Œå¤„ç†ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("ä½¿ç”¨æ¶ˆè´¹è€…ç»„æ¥å®ç°è´Ÿè½½å‡è¡¡ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…ç»„ä¸­çš„æ¶ˆè´¹è€…å®ä¾‹ä¼šè‡ªåŠ¨åˆ†é…åˆ†åŒºã€‚")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("ä¼˜åŒ–æ¶ˆè´¹è€…é€»è¾‘")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("ç¡®ä¿æ¶ˆè´¹è€…å¤„ç†é€»è¾‘é«˜æ•ˆï¼Œå‡å°‘æ¯æ¡æ¶ˆæ¯çš„å¤„ç†æ—¶é—´ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("ä½¿ç”¨æ‰¹å¤„ç†æ¥å‡å°‘I/Oæ“ä½œçš„é¢‘ç‡ï¼Œä¾‹å¦‚ä¸€æ¬¡æ€§æ¶ˆè´¹å¤šæ¡æ¶ˆæ¯å¹¶è¿›è¡Œæ‰¹é‡å¤„ç†ã€‚")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("æ°´å¹³æ‰©å±•")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("æ¶ˆè´¹ç«¯çš„æ€§èƒ½ä¼˜åŒ–é™¤äº†ä¼˜åŒ–æ¶ˆè´¹ä¸šåŠ¡é€»è¾‘ä»¥å¤–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ°´å¹³æ‰©å®¹ï¼Œå¢åŠ æ¶ˆè´¹ç«¯çš„å¹¶å‘æ•°æ¥æå‡æ€»ä½“çš„æ¶ˆè´¹æ€§èƒ½ã€‚ç‰¹åˆ«éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œ**åœ¨æ‰©å®¹ Consumer çš„å®ä¾‹æ•°é‡çš„åŒæ—¶ï¼Œå¿…é¡»åŒæ­¥æ‰©å®¹ä¸»é¢˜ä¸­çš„åˆ†åŒºï¼ˆä¹Ÿå«é˜Ÿåˆ—ï¼‰æ•°é‡ï¼Œç¡®ä¿ Consumer çš„å®ä¾‹æ•°å’Œåˆ†åŒºæ•°é‡æ˜¯ç›¸ç­‰çš„ã€‚**å¦‚æœ Consumer çš„å®ä¾‹æ•°é‡è¶…è¿‡åˆ†åŒºæ•°é‡ï¼Œè¿™æ ·çš„æ‰©å®¹å®é™…ä¸Šæ˜¯æ²¡æœ‰æ•ˆæœçš„ã€‚åŸå› æˆ‘ä»¬ä¹‹å‰è®²è¿‡ï¼Œå› ä¸ºå¯¹äºæ¶ˆè´¹è€…æ¥è¯´ï¼Œåœ¨æ¯ä¸ªåˆ†åŒºä¸Šå®é™…ä¸Šåªèƒ½æ”¯æŒå•çº¿ç¨‹æ¶ˆè´¹ã€‚")])])])]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[s("strong",[t._v("å¢åŠ Kafkaçš„ååé‡")])])]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("ä¼˜åŒ–Kafkaé…ç½®")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("è°ƒæ•´Kafkaçš„åˆ†åŒºæ•°ï¼ˆpartitionsï¼‰ï¼Œå¢åŠ ä¸»é¢˜çš„åˆ†åŒºæ•°å¯ä»¥æé«˜å¹¶è¡Œå¤„ç†çš„èƒ½åŠ›ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("é…ç½®é€‚å½“çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å‚æ•°ï¼Œä¾‹å¦‚"),s("code",[t._v("acks")]),t._v(", "),s("code",[t._v("batch.size")]),t._v(", "),s("code",[t._v("linger.ms")]),t._v("ç­‰ï¼Œä»¥æé«˜æ¶ˆæ¯çš„å‘é€å’Œæ¥æ”¶æ€§èƒ½ã€‚")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("ç¡¬ä»¶å‡çº§")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("å¢åŠ KafkaæœåŠ¡å™¨çš„CPUã€å†…å­˜å’Œç£ç›˜æ€§èƒ½ï¼Œç¡®ä¿KafkaæœåŠ¡å™¨å…·æœ‰è¶³å¤Ÿçš„èµ„æºå¤„ç†é«˜è´Ÿè½½ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("ä½¿ç”¨æ›´å¿«çš„ç½‘ç»œè¿æ¥ï¼Œä»¥å‡å°‘ç½‘ç»œå»¶è¿Ÿå’Œæé«˜æ•°æ®ä¼ è¾“é€Ÿåº¦ã€‚")])])])])]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[s("strong",[t._v("ä¼˜åŒ–æ•°æ®æµ")])])]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("æ•°æ®è¿‡æ»¤å’Œå‹ç¼©")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("åœ¨ç”Ÿäº§è€…ç«¯è¿‡æ»¤ä¸å¿…è¦çš„æ•°æ®ï¼Œå‡å°‘å‘é€åˆ°Kafkaçš„æ¶ˆæ¯é‡ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("ä½¿ç”¨Kafkaçš„æ¶ˆæ¯å‹ç¼©åŠŸèƒ½ï¼ˆå¦‚gzip, snappyï¼‰ï¼Œå‡å°‘æ¶ˆæ¯çš„å¤§å°ï¼Œæé«˜ä¼ è¾“æ•ˆç‡ã€‚")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("å¼‚æ­¥å¤„ç†")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("ä½¿ç”¨å¼‚æ­¥å¤„ç†æœºåˆ¶ï¼Œæ¶ˆè´¹è€…åœ¨æ¶ˆè´¹æ¶ˆæ¯åç«‹å³è¿”å›ï¼Œä¸ç­‰å¾…æ¶ˆæ¯å¤„ç†å®Œæˆã€‚æ¶ˆæ¯å¤„ç†å¯ä»¥äº¤ç»™åå°çº¿ç¨‹æˆ–å…¶ä»–æœåŠ¡è¿›è¡Œå¼‚æ­¥å¤„ç†ã€‚")])])])]),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[s("strong",[t._v("ç›‘æ§å’Œé¢„è­¦")])])]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("è®¾ç½®ç›‘æ§")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("ä½¿ç”¨Kafkaè‡ªå¸¦çš„ç›‘æ§å·¥å…·æˆ–ç¬¬ä¸‰æ–¹ç›‘æ§å·¥å…·ï¼ˆå¦‚Prometheus, Grafanaï¼‰ï¼Œå®æ—¶ç›‘æ§Kafkaçš„æ€§èƒ½æŒ‡æ ‡ï¼ˆå¦‚æ¶ˆæ¯å †ç§¯é‡ã€æ¶ˆè´¹è€…å»¶è¿Ÿç­‰ï¼‰ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("è®¾ç½®é¢„è­¦æœºåˆ¶ï¼Œå½“æ¶ˆæ¯å †ç§¯è¶…è¿‡ä¸€å®šé˜ˆå€¼æ—¶ï¼ŒåŠæ—¶é€šçŸ¥è¿ç»´äººå‘˜è¿›è¡Œå¤„ç†ã€‚")])])])])]),t._v(" "),s("ol",{attrs:{start:"5"}},[s("li",[s("strong",[t._v("æ•°æ®å†å‡è¡¡")])])]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("å†å‡è¡¡æ¶ˆè´¹è€…åˆ†åŒº")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("ä½¿ç”¨Kafkaçš„å†å‡è¡¡æœºåˆ¶ï¼Œç¡®ä¿æ¶ˆè´¹è€…åˆ†åŒºåˆ†é…å‡åŒ€ï¼Œé¿å…æŸäº›æ¶ˆè´¹è€…å¤„ç†è´Ÿè½½è¿‡é‡ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("é€šè¿‡è°ƒæ•´åˆ†åŒºç­–ç•¥ï¼Œä½¿å¾—æ¶ˆæ¯åœ¨å„ä¸ªåˆ†åŒºä¹‹é—´å‡åŒ€åˆ†å¸ƒã€‚")])])])])]),t._v(" "),s("blockquote",[s("p",[t._v("å¦‚æœæ˜¯çº¿ä¸Šçªå‘é—®é¢˜ï¼Œè¦ä¸´æ—¶æ‰©å®¹ï¼Œå¢åŠ æ¶ˆè´¹ç«¯çš„æ•°é‡ï¼Œä¸æ­¤åŒæ—¶ï¼Œé™çº§ä¸€äº›éæ ¸å¿ƒçš„ä¸šåŠ¡ã€‚é€šè¿‡æ‰©å®¹å’Œé™çº§æ‰¿æ‹…æµé‡ï¼Œè¿™æ˜¯ä¸ºäº†è¡¨æ˜ä½ å¯¹åº”æ€¥é—®é¢˜çš„å¤„ç†èƒ½åŠ›ã€‚")]),t._v(" "),s("p",[t._v("å…¶æ¬¡ï¼Œæ‰æ˜¯æ’æŸ¥è§£å†³å¼‚å¸¸é—®é¢˜ï¼Œå¦‚é€šè¿‡ç›‘æ§ï¼Œæ—¥å¿—ç­‰æ‰‹æ®µåˆ†ææ˜¯å¦æ¶ˆè´¹ç«¯çš„ä¸šåŠ¡é€»è¾‘ä»£ç å‡ºç°äº†é—®é¢˜ï¼Œä¼˜åŒ–æ¶ˆè´¹ç«¯çš„ä¸šåŠ¡å¤„ç†é€»è¾‘ã€‚")]),t._v(" "),s("p",[t._v("æœ€åï¼Œå¦‚æœæ˜¯æ¶ˆè´¹ç«¯çš„å¤„ç†èƒ½åŠ›ä¸è¶³ï¼Œå¯ä»¥é€šè¿‡æ°´å¹³æ‰©å®¹æ¥æä¾›æ¶ˆè´¹ç«¯çš„å¹¶å‘å¤„ç†èƒ½åŠ›ï¼Œä½†è¿™é‡Œæœ‰ä¸€ä¸ªè€ƒç‚¹éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œ é‚£å°±æ˜¯åœ¨æ‰©å®¹æ¶ˆè´¹è€…çš„å®ä¾‹æ•°çš„åŒæ—¶ï¼Œå¿…é¡»åŒæ­¥æ‰©å®¹ä¸»é¢˜ Topic çš„åˆ†åŒºæ•°é‡ï¼Œç¡®ä¿æ¶ˆè´¹è€…çš„å®ä¾‹æ•°å’Œåˆ†åŒºæ•°ç›¸ç­‰ã€‚å¦‚æœæ¶ˆè´¹è€…çš„å®ä¾‹æ•°è¶…è¿‡äº†åˆ†åŒºæ•°ï¼Œç”±äºåˆ†åŒºæ˜¯å•çº¿ç¨‹æ¶ˆè´¹ï¼Œæ‰€ä»¥è¿™æ ·çš„æ‰©å®¹å°±æ²¡æœ‰æ•ˆæœã€‚")]),t._v(" "),s("p",[t._v("æ¯”å¦‚åœ¨ Kafka ä¸­ï¼Œä¸€ä¸ª Topic å¯ä»¥é…ç½®å¤šä¸ª Partitionï¼ˆåˆ†åŒºï¼‰ï¼Œæ•°æ®ä¼šè¢«å†™å…¥åˆ°å¤šä¸ªåˆ†åŒºä¸­ï¼Œä½†åœ¨æ¶ˆè´¹çš„æ—¶å€™ï¼ŒKafka çº¦å®šä¸€ä¸ªåˆ†åŒºåªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼ŒTopic çš„åˆ†åŒºæ•°é‡å†³å®šäº†æ¶ˆè´¹çš„èƒ½åŠ›ï¼Œæ‰€ä»¥ï¼Œå¯ä»¥é€šè¿‡å¢åŠ åˆ†åŒºæ¥æé«˜æ¶ˆè´¹è€…çš„å¤„ç†èƒ½åŠ›ã€‚")])]),t._v(" "),s("blockquote",[s("p",[t._v("è¦ç¡®å®šæ–°çš„åˆ†åŒºæ•°é‡çš„æœ€ç®€å•çš„åšæ³•å°±æ˜¯ç”¨å¹³å‡ç”Ÿäº§è€…é€Ÿç‡é™¤ä»¥å•ä¸€æ¶ˆè´¹è€…çš„ æ¶ˆè´¹é€Ÿç‡ã€‚ æ¯”å¦‚è¯´æ‰€æœ‰çš„ç”Ÿäº§è€…åˆå¹¶åœ¨ä¸€èµ·ï¼ŒQPS æ˜¯ 3000ã€‚è€Œä¸€ä¸ªæ¶ˆè´¹è€…å¤„ç†çš„ QPS æ˜¯ 200ï¼Œé‚£ä¹ˆ "),s("mjx-container",{staticClass:"MathJax",attrs:{jax:"SVG"}},[s("svg",{staticStyle:{"vertical-align":"-0.186ex"},attrs:{xmlns:"http://www.w3.org/2000/svg",width:"15.964ex",height:"1.692ex",viewBox:"0 -666 7056 748"}},[s("g",{attrs:{stroke:"currentColor",fill:"currentColor","stroke-width":"0",transform:"matrix(1 0 0 -1 0 0)"}},[s("g",{attrs:{"data-mml-node":"math"}},[s("g",{attrs:{"data-mml-node":"mn"}},[s("path",{attrs:{"data-c":"33",d:"M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"}}),s("path",{attrs:{"data-c":"30",d:"M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z",transform:"translate(500, 0)"}}),s("path",{attrs:{"data-c":"30",d:"M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z",transform:"translate(1000, 0)"}}),s("path",{attrs:{"data-c":"30",d:"M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z",transform:"translate(1500, 0)"}})]),s("g",{attrs:{"data-mml-node":"mo",transform:"translate(2222.2, 0)"}},[s("path",{attrs:{"data-c":"F7",d:"M318 466Q318 500 339 518T386 537Q418 537 438 517T458 466Q458 438 440 417T388 396Q355 396 337 417T318 466ZM56 237T56 250T70 270H706Q721 262 721 250T706 230H70Q56 237 56 250ZM318 34Q318 68 339 86T386 105Q418 105 438 85T458 34Q458 6 440 -15T388 -36Q355 -36 337 -15T318 34Z"}})]),s("g",{attrs:{"data-mml-node":"mn",transform:"translate(3222.4, 0)"}},[s("path",{attrs:{"data-c":"32",d:"M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"}}),s("path",{attrs:{"data-c":"30",d:"M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z",transform:"translate(500, 0)"}}),s("path",{attrs:{"data-c":"30",d:"M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z",transform:"translate(1000, 0)"}})]),s("g",{attrs:{"data-mml-node":"mo",transform:"translate(5000.2, 0)"}},[s("path",{attrs:{"data-c":"3D",d:"M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"}})]),s("g",{attrs:{"data-mml-node":"mn",transform:"translate(6056, 0)"}},[s("path",{attrs:{"data-c":"31",d:"M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"}}),s("path",{attrs:{"data-c":"35",d:"M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z",transform:"translate(500, 0)"}})])])])])]),t._v("ã€‚ä¹Ÿå°±æ˜¯è¯´ä½ éœ€è¦ 15 ä¸ªåˆ†åŒºã€‚è¿›ä¸€æ­¥è€ƒè™‘ ä¸šåŠ¡å¢é•¿æˆ–è€…çªå‘æµé‡ï¼Œå¯ä»¥ä½¿ç”¨ 18 ä¸ªæˆ–è€… 20 ä¸ª")],1)]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-è°ˆä¸€è°ˆ-kafka-çš„å†å‡è¡¡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-è°ˆä¸€è°ˆ-kafka-çš„å†å‡è¡¡"}},[t._v("#")]),t._v(" ğŸ¯ è°ˆä¸€è°ˆ Kafka çš„å†å‡è¡¡?")]),t._v(" "),s("p",[t._v("Kafkaçš„å†å‡è¡¡ï¼ˆRebalancingï¼‰æ˜¯æ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰ä¸­çš„ä¸€ä¸ªå…³é”®æ¦‚å¿µï¼Œå®ƒæ˜¯æŒ‡å½“æ¶ˆè´¹è€…ç»„ä¸­çš„æˆå‘˜å‘ç”Ÿå˜åŠ¨æ—¶ï¼ˆä¾‹å¦‚ï¼Œæ–°æ¶ˆè´¹è€…åŠ å…¥ç»„ã€ç°æœ‰æ¶ˆè´¹è€…å´©æºƒæˆ–ç¦»å¼€ç»„ï¼‰ï¼ŒKafkaé‡æ–°åˆ†é…åˆ†åŒºï¼ˆPartitionï¼‰ç»™æ¶ˆè´¹è€…ç»„ä¸­çš„æ‰€æœ‰æ¶ˆè´¹è€…çš„è¿‡ç¨‹ã€‚")]),t._v(" "),s("p",[t._v("ä»¥ä¸‹æ˜¯å…³äºKafkaå†å‡è¡¡çš„ä¸€äº›è¦ç‚¹ï¼š")]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("æ¶ˆè´¹è€…ç»„")]),t._v("ï¼šKafkaä¸­çš„æ¶ˆè´¹è€…é€šå¸¸ä»¥ç»„çš„å½¢å¼å­˜åœ¨ã€‚æ¶ˆè´¹è€…ç»„ä¸­çš„æ‰€æœ‰æ¶ˆè´¹è€…åè°ƒåˆä½œï¼Œå¹³å‡åˆ†é…è®¢é˜…ä¸»é¢˜çš„æ‰€æœ‰åˆ†åŒºï¼Œä»¥å®ç°è´Ÿè½½å‡è¡¡ã€‚")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("å†å‡è¡¡è§¦å‘æ¡ä»¶")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("ç»„æˆå‘˜å‘ç”Ÿå˜æ›´(æ–°consumeråŠ å…¥ç»„ã€å·²æœ‰consumerä¸»åŠ¨ç¦»å¼€ç»„æˆ–å·²æœ‰consumerå´©æºƒäº†)")]),t._v(" "),s("li",[t._v("è®¢é˜…ä¸»é¢˜æ•°å‘ç”Ÿå˜æ›´ï¼Œå¦‚æœä½ ä½¿ç”¨äº†æ­£åˆ™è¡¨è¾¾å¼çš„æ–¹å¼è¿›è¡Œè®¢é˜…ï¼Œé‚£ä¹ˆæ–°å»ºåŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„topicå°±ä¼šè§¦å‘rebalance")]),t._v(" "),s("li",[t._v("è®¢é˜…ä¸»é¢˜çš„åˆ†åŒºæ•°å‘ç”Ÿå˜æ›´")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("å†å‡è¡¡è¿‡ç¨‹")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("å½“è§¦å‘å†å‡è¡¡æ¡ä»¶æ—¶ï¼Œå½“å‰æ‰€æœ‰çš„æ¶ˆè´¹è€…éƒ½ä¼šæš‚åœæ¶ˆè´¹ï¼Œä»¥ä¾¿è¿›è¡Œåˆ†åŒºçš„é‡æ–°åˆ†é…ã€‚")]),t._v(" "),s("li",[t._v("æ¶ˆè´¹è€…ç»„ä¸­çš„æŸä¸ªæ¶ˆè´¹è€…ï¼ˆé€šå¸¸æ˜¯ç»„åè°ƒè€…ï¼ŒGroup Coordinatorï¼‰è´Ÿè´£å‘èµ·å†å‡è¡¡è¿‡ç¨‹ã€‚")]),t._v(" "),s("li",[t._v("åè°ƒè€…è®¡ç®—æ–°çš„åˆ†åŒºåˆ†é…æ–¹æ¡ˆï¼Œå¹¶å°†æ–¹æ¡ˆå¹¿æ’­ç»™ç»„å†…çš„æ‰€æœ‰æ¶ˆè´¹è€…ã€‚")]),t._v(" "),s("li",[t._v("æ‰€æœ‰æ¶ˆè´¹è€…æ ¹æ®æ–°çš„åˆ†é…æ–¹æ¡ˆé‡æ–°åˆ†é…åˆ†åŒºï¼Œå¹¶å¼€å§‹é‡æ–°åˆ†é…çš„åˆ†åŒºä¸­è¯»å–æ•°æ®ã€‚")])]),t._v(" "),s("blockquote",[s("p",[t._v("å’Œæ—§ç‰ˆæœ¬consumerä¾æ‰˜äºZookeeperè¿›è¡Œrebalanceä¸åŒï¼Œæ–°ç‰ˆæœ¬consumerä½¿ç”¨äº†Kafkaå†…ç½®çš„ä¸€ä¸ªå…¨æ–°çš„ç»„åè°ƒåè®®ï¼ˆgroup coordination protocolï¼‰ã€‚")]),t._v(" "),s("p",[t._v("å¯¹äºæ¯ä¸ªç»„è€Œè¨€ï¼ŒKafkaçš„æŸä¸ªbrokerä¼šè¢«é€‰ä¸¾ä¸ºç»„åè°ƒè€…ï¼ˆgroup coordinatorï¼‰ã€‚")]),t._v(" "),s("p",[t._v("Kafkaæ–°ç‰ˆæœ¬ consumer é»˜è®¤æä¾›äº†å¤šç§åˆ†é…ç­–ç•¥")]),t._v(" "),s("ul",[s("li",[t._v("Kafkaæä¾›äº†å¤šç§å†å‡è¡¡ç­–ç•¥ï¼Œå¯ä»¥é€šè¿‡é…ç½®"),s("code",[t._v("partition.assignment.strategy")]),t._v("å‚æ•°è¿›è¡Œè®¾ç½®ï¼š\n"),s("ul",[s("li",[s("strong",[t._v("RangeAssignor")]),t._v("ï¼šæŒ‰èŒƒå›´åˆ†é…åˆ†åŒºã€‚æ¯ä¸ªæ¶ˆè´¹è€…åˆ†é…ä¸€ç»„è¿ç»­çš„åˆ†åŒºã€‚")]),t._v(" "),s("li",[s("strong",[t._v("RoundRobinAssignor")]),t._v("ï¼šä»¥è½®è¯¢æ–¹å¼åˆ†é…åˆ†åŒºã€‚åˆ†åŒºå°½å¯èƒ½å‡åŒ€åœ°åˆ†é…ç»™æ‰€æœ‰æ¶ˆè´¹è€…ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("StickyAssignor")]),t._v("ï¼šåœ¨ä¿æŒç°æœ‰åˆ†åŒºåˆ†é…çš„åŸºç¡€ä¸Šï¼Œå°½é‡å°‘åœ°ç§»åŠ¨åˆ†åŒºã€‚")]),t._v(" "),s("li",[s("strong",[t._v("CooperativeStickyAssignor")]),t._v("ï¼šä¸€ç§æ¸è¿›çš„å†å‡è¡¡ç­–ç•¥ï¼Œæœ€å°åŒ–åˆ†åŒºç§»åŠ¨ï¼Œå¹¶ç¡®ä¿æ¶ˆè´¹è€…é—´çš„å¹³è¡¡ã€‚")])])])]),t._v(" "),s("ol",[s("li",[s("p",[t._v("æ‰€æœ‰æˆå‘˜éƒ½å‘ coordinator å‘é€è¯·æ±‚ï¼Œè¯·æ±‚å…¥ç»„ã€‚ä¸€æ—¦æ‰€æœ‰æˆå‘˜éƒ½å‘é€äº†è¯·æ±‚ï¼Œcoordinator ä¼šä»ä¸­é€‰æ‹©ä¸€ä¸ªconsumer æ‹…ä»» leader çš„è§’è‰²ï¼Œå¹¶æŠŠç»„æˆå‘˜ä¿¡æ¯ä»¥åŠè®¢é˜…ä¿¡æ¯å‘ç»™ leaderã€‚")])]),t._v(" "),s("li",[s("p",[t._v("leader å¼€å§‹åˆ†é…æ¶ˆè´¹æ–¹æ¡ˆï¼ŒæŒ‡æ˜å…·ä½“å“ªä¸ª consumer è´Ÿè´£æ¶ˆè´¹å“ªäº› topic çš„å“ªäº› partitionã€‚ä¸€æ—¦å®Œæˆåˆ†é…ï¼Œleader ä¼šå°†è¿™ä¸ªæ–¹æ¡ˆå‘ç»™ coordinatorã€‚coordinator æ¥æ”¶åˆ°åˆ†é…æ–¹æ¡ˆä¹‹åä¼šæŠŠæ–¹æ¡ˆå‘ç»™å„ä¸ª consumerï¼Œè¿™æ ·ç»„å†…çš„æ‰€æœ‰æˆå‘˜å°±éƒ½çŸ¥é“è‡ªå·±åº”è¯¥æ¶ˆè´¹å“ªäº›åˆ†åŒºäº†ã€‚")])])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("å†å‡è¡¡çš„å½±å“")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("åœ¨å†å‡è¡¡æœŸé—´ï¼Œæ¶ˆè´¹è€…ç»„çš„æ¶ˆè´¹è€…å°†æ— æ³•æ¶ˆè´¹æ•°æ®ï¼Œè¿™å¯èƒ½å¯¼è‡´çŸ­æš‚çš„æœåŠ¡ä¸­æ–­ã€‚")]),t._v(" "),s("li",[t._v("å†å‡è¡¡å®Œæˆåï¼Œæ¯ä¸ªæ¶ˆè´¹è€…å°†å¼€å§‹ä»å…¶åˆ†é…åˆ°çš„åˆ†åŒºä¸­è¯»å–æ•°æ®ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å·²ç»æäº¤çš„åç§»é‡è¢«è¦†ç›–ã€‚")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("å†å‡è¡¡çš„ä¼˜åŒ–")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("å°½é‡å‡å°‘å†å‡è¡¡çš„å‘ç”Ÿï¼Œä¾‹å¦‚ï¼Œé¿å…é¢‘ç¹åœ°æ·»åŠ æˆ–ç§»é™¤æ¶ˆè´¹è€…ã€‚")]),t._v(" "),s("li",[t._v("ä½¿ç”¨"),s("code",[t._v("max.poll.interval.ms")]),t._v("é…ç½®å‚æ•°æ¥è®¾ç½®æ¶ˆè´¹è€…åœ¨ä¸¤æ¬¡è½®è¯¢ä¹‹é—´çš„æœ€å¤§æ—¶é—´é—´éš”ï¼Œè¿™æœ‰åŠ©äºæ§åˆ¶å†å‡è¡¡çš„è§¦å‘ã€‚")]),t._v(" "),s("li",[t._v("ä½¿ç”¨"),s("code",[t._v("session.timeout.ms")]),t._v("é…ç½®å‚æ•°æ¥è®¾ç½®æ¶ˆè´¹è€…ä¸ç»„åè°ƒè€…ä¼šè¯çš„è¶…æ—¶æ—¶é—´ï¼Œè¿™æœ‰åŠ©äºåœ¨æ¶ˆè´¹è€…å´©æºƒæ—¶å¿«é€Ÿè§¦å‘å†å‡è¡¡ã€‚")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("æ¶ˆè´¹è€…åç§»é‡ç®¡ç†")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("åœ¨å†å‡è¡¡æœŸé—´ï¼Œæ¶ˆè´¹è€…å¯èƒ½ä¼šä¸¢å¤±æˆ–æäº¤æ–°çš„åç§»é‡ã€‚å› æ­¤ï¼Œåˆç†ç®¡ç†åç§»é‡éå¸¸é‡è¦ï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨Kafkaæä¾›çš„è‡ªåŠ¨æäº¤åç§»é‡åŠŸèƒ½æˆ–æ‰‹åŠ¨ç®¡ç†åç§»é‡ã€‚")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("å†å‡è¡¡ç›‘å¬å™¨")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("Kafkaæ¶ˆè´¹è€…APIæä¾›äº†å†å‡è¡¡ç›‘å¬å™¨ï¼ˆ"),s("code",[t._v("ConsumerRebalanceListener")]),t._v("ï¼‰ï¼Œå…è®¸å¼€å‘è€…åœ¨å†å‡è¡¡å‘ç”Ÿå‰åæ‰§è¡Œç‰¹å®šçš„æ“ä½œï¼Œä¾‹å¦‚ï¼Œåœ¨å†å‡è¡¡å‰ä¿å­˜å½“å‰çš„æ¶ˆè´¹çŠ¶æ€ï¼Œåœ¨å†å‡è¡¡åæ¢å¤æ¶ˆè´¹ã€‚")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("å†å‡è¡¡ä¸æ¶ˆè´¹è€…æ•…éšœè½¬ç§»")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("å†å‡è¡¡æ˜¯Kafkaå¤„ç†æ¶ˆè´¹è€…æ•…éšœè½¬ç§»çš„ä¸€ç§æœºåˆ¶ã€‚å½“æ¶ˆè´¹è€…å´©æºƒæ—¶ï¼ŒKafkaä¼šè§¦å‘å†å‡è¡¡ï¼Œå°†å´©æºƒæ¶ˆè´¹è€…è´Ÿè´£çš„åˆ†åŒºåˆ†é…ç»™å…¶ä»–æ¶ˆè´¹è€…ï¼Œä»¥ç¡®ä¿æ•°æ®ä»ç„¶å¯ä»¥è¢«æ¶ˆè´¹ã€‚")])])])]),t._v(" "),s("p",[t._v("å†å‡è¡¡æ˜¯Kafkaæ¶ˆè´¹è€…æ¨¡å‹çš„ä¸€ä¸ªæ ¸å¿ƒç‰¹æ€§ï¼Œå®ƒå…è®¸æ¶ˆè´¹è€…ç»„åŠ¨æ€åœ°é€‚åº”æ¶ˆè´¹è€…æ•°é‡å’Œè®¢é˜…ä¸»é¢˜çš„å˜åŒ–ã€‚ç„¶è€Œï¼Œå†å‡è¡¡ä¹Ÿå¯èƒ½å¸¦æ¥ä¸€äº›æ€§èƒ½å½±å“ï¼Œå› æ­¤åœ¨è®¾è®¡å’Œé…ç½®Kafkaæ¶ˆè´¹è€…æ—¶ï¼Œéœ€è¦ä»”ç»†è€ƒè™‘è¿™äº›å› ç´ ã€‚")]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-åˆ›å»ºtopicæ—¶å¦‚ä½•é€‰æ‹©åˆé€‚çš„åˆ†åŒºæ•°"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-åˆ›å»ºtopicæ—¶å¦‚ä½•é€‰æ‹©åˆé€‚çš„åˆ†åŒºæ•°"}},[t._v("#")]),t._v(" ğŸ¯ åˆ›å»ºtopicæ—¶å¦‚ä½•é€‰æ‹©åˆé€‚çš„åˆ†åŒºæ•°ï¼Ÿ")]),t._v(" "),s("blockquote",[s("p",[t._v("æ¯å¤©ä¸¤ä¸‰äº¿æ•°æ®é‡ï¼Œæ¯ç§’å‡ åƒæ¡ï¼Œè®¾ç½®å¤šå°‘åˆ†åŒºåˆé€‚")])]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("ååé‡éœ€æ±‚")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("åˆ†åŒº = å¹¶å‘åº¦")]),t._v("ï¼šKafka çš„å¹¶å‘åº¦ä¸»è¦ç”±åˆ†åŒºæ•°å†³å®šã€‚")]),t._v(" "),s("li",[t._v("ä¸€èˆ¬ç»éªŒï¼š"),s("strong",[t._v("æ¯ä¸ªåˆ†åŒºå•æœºæ¶ˆè´¹è€…å¯å¤„ç† 5~10MB/s")]),t._v("ï¼Œå¦‚æœé¢„ä¼°å†™å…¥æˆ–æ¶ˆè´¹æµé‡å¾ˆå¤§ï¼Œéœ€è¦æ›´å¤šåˆ†åŒºæ¥åˆ†æ‘Šã€‚")])])]),t._v(" "),s("li",[s("strong",[t._v("æ¶ˆè´¹è€…å¹¶è¡Œåº¦")]),t._v(" "),s("ul",[s("li",[t._v("Kafka è§„å®šï¼šä¸€ä¸ªåˆ†åŒºåŒä¸€æ—¶åˆ»åªèƒ½è¢« "),s("strong",[t._v("ä¸€ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹æ¶ˆè´¹")]),t._v("ã€‚")]),t._v(" "),s("li",[t._v("å› æ­¤åˆ†åŒºæ•°è‡³å°‘è¦ â‰¥ é¢„æœŸçš„æœ€å¤§æ¶ˆè´¹è€…çº¿ç¨‹æ•°ï¼Œå¦åˆ™ä¼šé™åˆ¶æ¶ˆè´¹å¹¶è¡Œåº¦ã€‚")])])]),t._v(" "),s("li",[s("strong",[t._v("æ¶ˆæ¯æœ‰åºæ€§")]),t._v(" "),s("ul",[s("li",[t._v("åˆ†åŒºè¶Šå¤šï¼Œå±€éƒ¨æœ‰åºèŒƒå›´è¶Šå°ã€‚")]),t._v(" "),s("li",[t._v("å¦‚æœä¸šåŠ¡éœ€è¦ "),s("strong",[t._v("ä¸¥æ ¼é¡ºåº")]),t._v("ï¼Œåªèƒ½é€‰æ‹© "),s("strong",[t._v("å•åˆ†åŒº")]),t._v("ï¼ˆä½†è¦é¢å¯¹ååç“¶é¢ˆï¼‰ã€‚")])])]),t._v(" "),s("li",[s("strong",[t._v("Broker èµ„æº")]),t._v(" "),s("ul",[s("li",[t._v("åˆ†åŒºæœ¬èº«æœ‰å¼€é”€ï¼š\n"),s("ul",[s("li",[t._v("æ¯ä¸ªåˆ†åŒºå¯¹åº”ä¸€ä¸ªæ—¥å¿—ç›®å½•ï¼ŒåŒ…å«ç´¢å¼•æ–‡ä»¶ã€æ•°æ®æ–‡ä»¶ï¼›")]),t._v(" "),s("li",[t._v("Leader/Follower éœ€è¦é¢å¤–å†…å­˜å’Œæ–‡ä»¶å¥æŸ„ã€‚")])])]),t._v(" "),s("li",[t._v("åˆ†åŒºæ•°è¿‡å¤šä¼šå¯¼è‡´ "),s("strong",[t._v("æ§åˆ¶å™¨å‹åŠ›å¤§")]),t._v("ï¼ŒKafka å…ƒæ•°æ®åŒæ­¥å˜æ…¢ã€‚")]),t._v(" "),s("li",[t._v("ä¸€èˆ¬å»ºè®®ï¼š"),s("strong",[t._v("å•ä¸ª Broker ä¸Šåˆ†åŒºæ•°ä¸è¦è¶…è¿‡å‡ åƒ")]),t._v("ï¼ˆKafka å®˜æ–¹å»ºè®® < 20w ä¸ªåˆ†åŒºé›†ç¾¤æ€»æ•°ï¼‰ã€‚")])])]),t._v(" "),s("li",[s("strong",[t._v("åç»­æ‰©å±•æ€§")]),t._v(" "),s("ul",[s("li",[t._v("åˆ†åŒºæ•°å¯ä»¥å¢åŠ ï¼Œä½†ä¸èƒ½å‡å°‘ã€‚")]),t._v(" "),s("li",[t._v("æå‰é¢„ä¼°å³°å€¼ï¼Œé€‚åº¦è¶…é…ã€‚")])])])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafka-æ˜¯å¦æ”¯æŒåŠ¨æ€å¢åŠ å’Œå‡å°‘åˆ†åŒº"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafka-æ˜¯å¦æ”¯æŒåŠ¨æ€å¢åŠ å’Œå‡å°‘åˆ†åŒº"}},[t._v("#")]),t._v(" ğŸ¯ Kafka æ˜¯å¦æ”¯æŒåŠ¨æ€å¢åŠ å’Œå‡å°‘åˆ†åŒº")]),t._v(" "),s("p",[t._v("Kafkaæ”¯æŒåŠ¨æ€å¢åŠ åˆ†åŒºï¼Œä½†ä¸æ”¯æŒå‡å°‘åˆ†åŒºã€‚")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("åŠ¨æ€å¢åŠ åˆ†åŒºçš„å½±å“")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("è´Ÿè½½å‡è¡¡")]),t._v("ï¼šå¢åŠ åˆ†åŒºåï¼Œå¯ä»¥é‡æ–°åˆ†é…åˆ†åŒºåˆ°æ¶ˆè´¹è€…ï¼Œæä¾›æ›´å¥½çš„è´Ÿè½½å‡è¡¡ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("ååé‡æå‡")]),t._v("ï¼šå¢åŠ åˆ†åŒºæ•°ç›®èƒ½å¤Ÿæå‡Kafkaé›†ç¾¤çš„ååé‡ï¼Œå› ä¸ºæ›´å¤šçš„åˆ†åŒºæ„å‘³ç€å¯ä»¥å¹¶è¡Œå¤„ç†æ›´å¤šçš„æ¶ˆæ¯ã€‚")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("åŠ¨æ€å¢åŠ åˆ†åŒºçš„é™åˆ¶")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("æ•°æ®é¡ºåºæ€§")]),t._v("ï¼šå¯¹äºä¾èµ–æ¶ˆæ¯é¡ºåºçš„åº”ç”¨ç¨‹åºï¼Œå¢åŠ åˆ†åŒºå¯èƒ½ä¼šå½±å“æ•°æ®çš„é¡ºåºæ€§ï¼Œå› ä¸ºæ–°çš„æ¶ˆæ¯å¯èƒ½ä¼šåˆ†é…åˆ°æ–°çš„åˆ†åŒºã€‚")]),t._v(" "),s("li",[s("strong",[t._v("é‡æ–°åˆ†é…æˆæœ¬")]),t._v("ï¼šå¢åŠ åˆ†åŒºåï¼Œå¯èƒ½éœ€è¦é‡æ–°åˆ†é…åˆ†åŒºåˆ°ä¸åŒçš„Brokerï¼Œè¿™ä¼šå¸¦æ¥é¢å¤–çš„ç½‘ç»œå’ŒI/Oè´Ÿè½½ã€‚")])])])]),t._v(" "),s("p",[t._v("Kafkaç›®å‰ä¸æ”¯æŒåŠ¨æ€å‡å°‘åˆ†åŒºã€‚è¿™æ˜¯å› ä¸ºå‡å°‘åˆ†åŒºä¼šæ¶‰åŠåˆ°æ•°æ®çš„é‡æ–°åˆ†é…å’Œåˆå¹¶ï¼Œè¿™ä¼šå¯¼è‡´å¾ˆå¤§çš„å¤æ‚æ€§å’Œæ½œåœ¨çš„æ•°æ®ä¸¢å¤±é£é™©")]),t._v(" "),s("p",[s("strong",[t._v("åŸå› ")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("æ•°æ®è¿ç§»å¤æ‚æ€§")]),t._v("ï¼šå‡å°‘åˆ†åŒºéœ€è¦å°†ç°æœ‰åˆ†åŒºçš„æ•°æ®è¿ç§»åˆ°å…¶ä»–åˆ†åŒºï¼Œè¿™ä¼šå¸¦æ¥å·¨å¤§çš„I/Oè´Ÿè½½å’Œå¤æ‚çš„è¿ç§»é€»è¾‘ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("æ•°æ®ä¸€è‡´æ€§é£é™©")]),t._v("ï¼šåœ¨å‡å°‘åˆ†åŒºçš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šæœ‰æ•°æ®ä¸¢å¤±æˆ–æ•°æ®ä¸ä¸€è‡´çš„é£é™©ï¼Œè¿™å¯¹äºç”Ÿäº§ç¯å¢ƒæ˜¯ä¸å®¹å¿½è§†çš„ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-é‡åˆ°è¿‡å“ªäº›kafkaçš„ç”Ÿäº§é—®é¢˜-å¦‚ä½•è§£å†³çš„"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-é‡åˆ°è¿‡å“ªäº›kafkaçš„ç”Ÿäº§é—®é¢˜-å¦‚ä½•è§£å†³çš„"}},[t._v("#")]),t._v(" ğŸ¯ é‡åˆ°è¿‡å“ªäº›Kafkaçš„ç”Ÿäº§é—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³çš„ï¼Ÿ")]),t._v(" "),s("p",[t._v('"æˆ‘åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é‡åˆ°è¿‡å‡ ä¸ªå…¸å‹é—®é¢˜ï¼š')]),t._v(" "),s("p",[s("strong",[t._v("é—®é¢˜1ï¼šæ¶ˆè´¹å»¶è¿Ÿä¸¥é‡")])]),t._v(" "),s("ul",[s("li",[t._v("åŸå› ï¼šConsumerå¤„ç†é€Ÿåº¦è·Ÿä¸ä¸ŠProducerç”Ÿäº§é€Ÿåº¦")]),t._v(" "),s("li",[t._v("è§£å†³ï¼šå¢åŠ Consumeræ•°é‡ï¼Œä¼˜åŒ–æ¶ˆè´¹é€»è¾‘ï¼Œè°ƒæ•´æ‰¹å¤„ç†å¤§å°")])]),t._v(" "),s("p",[s("strong",[t._v("é—®é¢˜2ï¼šé¢‘ç¹rebalance")])]),t._v(" "),s("ul",[s("li",[t._v("åŸå› ï¼šConsumerå¿ƒè·³è¶…æ—¶æˆ–å¤„ç†æ—¶é—´è¿‡é•¿")]),t._v(" "),s("li",[t._v("è§£å†³ï¼šè°ƒæ•´session.timeout.mså’Œmax.poll.interval.mså‚æ•°")])]),t._v(" "),s("p",[s("strong",[t._v("é—®é¢˜3ï¼šç£ç›˜ç©ºé—´ä¸è¶³")])]),t._v(" "),s("ul",[s("li",[t._v("åŸå› ï¼šæ—¥å¿—ä¿ç•™æ—¶é—´è¿‡é•¿ï¼Œæ•°æ®å †ç§¯")]),t._v(" "),s("li",[t._v("è§£å†³ï¼šè°ƒæ•´retentioné…ç½®ï¼Œå¢åŠ ç£ç›˜å®¹é‡ï¼Œè®¾ç½®æ•°æ®æ¸…ç†ç­–ç•¥")])]),t._v(" "),s("p",[s("strong",[t._v("é—®é¢˜4ï¼šç½‘ç»œåˆ†åŒºå¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´")])]),t._v(" "),s("ul",[s("li",[t._v("è§£å†³ï¼šé€šè¿‡ç›‘æ§ISRçŠ¶æ€ï¼ŒåŠæ—¶å‘ç°å’Œå¤„ç†ç½‘ç»œé—®é¢˜")])]),t._v(" "),s("p",[t._v("è¿™äº›é—®é¢˜è®©æˆ‘æ·±åˆ»è®¤è¯†åˆ°ç›‘æ§å’Œè¿ç»´çš„é‡è¦æ€§ï¼Œç°åœ¨æˆ‘ä»¬å»ºç«‹äº†å®Œå–„çš„ç›‘æ§ä½“ç³»ã€‚â€")]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-å¦‚ä½•ç›‘æ§kafkaé›†ç¾¤çš„å¥åº·çŠ¶æ€"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-å¦‚ä½•ç›‘æ§kafkaé›†ç¾¤çš„å¥åº·çŠ¶æ€"}},[t._v("#")]),t._v(" ğŸ¯ å¦‚ä½•ç›‘æ§Kafkaé›†ç¾¤çš„å¥åº·çŠ¶æ€ï¼Ÿ")]),t._v(" "),s("p",[t._v('"æˆ‘ä»¬å»ºç«‹äº†å¤šç»´åº¦çš„ç›‘æ§ä½“ç³»ï¼š')]),t._v(" "),s("p",[s("strong",[t._v("JMXæŒ‡æ ‡ç›‘æ§ï¼š")])]),t._v(" "),s("ul",[s("li",[t._v("ååé‡ï¼šBytesInPerSecã€BytesOutPerSec")]),t._v(" "),s("li",[t._v("å»¶è¿Ÿï¼šProduceRequestTimeMsã€FetchRequestTimeMs")]),t._v(" "),s("li",[t._v("é”™è¯¯ç‡ï¼šErrorRateã€FailedRequestsPerSec")])]),t._v(" "),s("p",[s("strong",[t._v("ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§ï¼š")])]),t._v(" "),s("ul",[s("li",[t._v("Consumer Lagï¼šæ¶ˆè´¹å»¶è¿Ÿ")]),t._v(" "),s("li",[t._v("Topicåˆ†åŒºçŠ¶æ€")]),t._v(" "),s("li",[t._v("ISRå‰¯æœ¬æ•°é‡")])]),t._v(" "),s("p",[s("strong",[t._v("ç³»ç»ŸæŒ‡æ ‡ç›‘æ§ï¼š")])]),t._v(" "),s("ul",[s("li",[t._v("CPUã€å†…å­˜ã€ç£ç›˜IO")]),t._v(" "),s("li",[t._v("ç½‘ç»œå¸¦å®½ä½¿ç”¨æƒ…å†µ")]),t._v(" "),s("li",[t._v("JVM GCæƒ…å†µ")])]),t._v(" "),s("p",[s("strong",[t._v("å·¥å…·ï¼š")])]),t._v(" "),s("ul",[s("li",[t._v("ä½¿ç”¨Kafka Managerè¿›è¡Œé›†ç¾¤ç®¡ç†")]),t._v(" "),s("li",[t._v("Prometheus + Grafanaè¿›è¡ŒæŒ‡æ ‡å¯è§†åŒ–")]),t._v(" "),s("li",[t._v("è‡ªå®šä¹‰å‘Šè­¦è§„åˆ™ï¼Œå…³é”®æŒ‡æ ‡å¼‚å¸¸æ—¶åŠæ—¶é€šçŸ¥")])]),t._v(" "),s("p",[t._v("é€šè¿‡è¿™å¥—ç›‘æ§ä½“ç³»ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨é—®é¢˜å‘ç”Ÿå‰å°±å‘ç°æ½œåœ¨é£é™©ã€‚â€")]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-å¦‚æœkafkaé›†ç¾¤æ¯å¤©éœ€è¦æ‰¿è½½10äº¿è¯·æ±‚æµé‡æ•°æ®-ä½ ä¼šæ€ä¹ˆä¼°ç®—æœºå™¨ç½‘ç»œèµ„æº"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-å¦‚æœkafkaé›†ç¾¤æ¯å¤©éœ€è¦æ‰¿è½½10äº¿è¯·æ±‚æµé‡æ•°æ®-ä½ ä¼šæ€ä¹ˆä¼°ç®—æœºå™¨ç½‘ç»œèµ„æº"}},[t._v("#")]),t._v(" ğŸ¯ å¦‚æœkafkaé›†ç¾¤æ¯å¤©éœ€è¦æ‰¿è½½10äº¿è¯·æ±‚æµé‡æ•°æ®ï¼Œä½ ä¼šæ€ä¹ˆä¼°ç®—æœºå™¨ç½‘ç»œèµ„æºï¼Ÿ")]),t._v(" "),s("p",[t._v("æ€è·¯æ€»è§ˆï¼šæˆ‘å…ˆæŠŠâ€œé‡â€æ‹†æˆå››ä»¶äº‹ï¼šæ¶ˆæ¯é€Ÿç‡ã€ç½‘ç»œååã€å­˜å‚¨å®¹é‡ã€å¹¶è¡Œåº¦ï¼ˆåˆ†åŒº/å®ä¾‹ï¼‰ã€‚æŒ‰å…¬å¼ä¼°ç®—ï¼Œå†ç»™20%~40%ä½™é‡ï¼Œç¡®ä¿å³°å€¼ä¸æ•…éšœåœºæ™¯ä¹Ÿç¨³ã€‚")]),t._v(" "),s("h2",{attrs:{id:"å…­ã€é«˜çº§ç‰¹æ€§ä¸å®æˆ˜åº”ç”¨-ğŸš€"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å…­ã€é«˜çº§ç‰¹æ€§ä¸å®æˆ˜åº”ç”¨-ğŸš€"}},[t._v("#")]),t._v(" å…­ã€é«˜çº§ç‰¹æ€§ä¸å®æˆ˜åº”ç”¨ ğŸš€")]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-èƒ½è¯¦ç»†è¯´è¯´kafkaçš„é›¶æ‹·è´æŠ€æœ¯å—"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-èƒ½è¯¦ç»†è¯´è¯´kafkaçš„é›¶æ‹·è´æŠ€æœ¯å—"}},[t._v("#")]),t._v(" ğŸ¯ èƒ½è¯¦ç»†è¯´è¯´Kafkaçš„é›¶æ‹·è´æŠ€æœ¯å—ï¼Ÿ")]),t._v(" "),s("p",[t._v("Kafkaé€šè¿‡é›¶æ‹·è´æŠŠâ€œç£ç›˜â†’ç½‘å¡â€çš„æ•°æ®è·¯å¾„ç¼©çŸ­ä¸ºâ€œDMAä¸¤è·³ã€æ— ç”¨æˆ·æ€æ‹·è´â€ã€‚è½åœ°æ‰‹æ®µæ˜¯å­˜å‚¨å†™å…¥é˜¶æ®µç”¨mmapï¼Œç½‘ç»œå‘é€é˜¶æ®µç”¨sendfileï¼ˆJavaé‡Œæ˜¯FileChannel#transferToï¼‰ï¼Œæ•°æ®å¸¸é©»äºPage Cacheï¼ŒCPUåªåšæ§åˆ¶ä¸æ¬æ•°æ®ï¼Œä»è€Œæ˜¾è‘—é™ä½CPUå ç”¨ä¸ä¸Šä¸‹æ–‡åˆ‡æ¢ã€æå‡ååã€‚")]),t._v(" "),s("blockquote",[s("p",[t._v("å…³é”®è®¤çŸ¥ï¼šæ‰€è°“â€œé›¶æ‹·è´â€æ˜¯â€œé›¶ç”¨æˆ·æ€æ‹·è´â€ï¼ŒCPUä»å‚ä¸ç³»ç»Ÿè°ƒç”¨ä¸å…ƒæ•°æ®ç®¡ç†ï¼Œä½†ä¸å†æ¬è¿æ•°æ®ã€‚")]),t._v(" "),s("p",[t._v("é›¶æ‹·è´æ˜¯ä¸­é—´ä»¶è®¾è®¡çš„é€šç”¨æŠ€æœ¯ï¼Œæ˜¯æŒ‡å®Œå…¨æ²¡æœ‰ CPU å‚ä¸çš„è¯»å†™æ“ä½œã€‚æˆ‘ä»¥ä»ç£ç›˜è¯»æ•°æ®ï¼Œç„¶åå†™åˆ°ç½‘å¡ä¸Šä¸ºä¾‹ä»‹ç»ä¸€ä¸‹ã€‚é¦–å…ˆï¼Œåº”ç”¨ç¨‹åºå‘èµ·ç³»ç»Ÿè°ƒç”¨ï¼Œè¿™ä¸ªç³»ç»Ÿè°ƒç”¨ä¼šè¯»å–ç£ç›˜çš„æ•°æ®ï¼Œè¯»åˆ°å†…æ ¸ç¼“å­˜é‡Œé¢ã€‚åŒæ—¶ï¼Œç£ç›˜åˆ°å†…æ ¸ç¼“å­˜æ˜¯ DMA æ‹·è´ã€‚ç„¶åå†ä»å†…æ ¸ç¼“å­˜æ‹·è´åˆ° NIC ç¼“å­˜ä¸­ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿæ˜¯ DMA æ‹·è´ã€‚è¿™æ ·å°±å®Œæˆäº†æ•´ä¸ªè¯»å†™æ“ä½œã€‚å’Œæ™®é€šçš„è¯»å–ç£ç›˜å†å‘é€åˆ°ç½‘å¡æ¯”èµ·æ¥ï¼Œé›¶æ‹·è´å°‘äº†ä¸¤æ¬¡ CPU æ‹·è´ï¼Œå’Œä¸¤æ¬¡å†…æ ¸æ€ä¸ç”¨æˆ·æ€çš„åˆ‡æ¢ã€‚")]),t._v(" "),s("p",[t._v("è¿™é‡Œè¯´çš„å†…æ ¸ç¼“å­˜ï¼Œåœ¨ linux ç³»ç»Ÿä¸Šå…¶å®å°±æ˜¯ page cacheã€‚")])]),t._v(" "),s("p",[s("strong",[t._v("ä¼ ç»ŸIOæµç¨‹çš„é—®é¢˜ï¼š")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://www.nootcode.com/knowledge/kafka-zero-copy/en/traditional-copy.png",alt:""}}),t._v("å‡è®¾ Kafka æ²¡æœ‰ä½¿ç”¨é›¶æ‹·è´ï¼Œä»ç£ç›˜è¯»å–æ•°æ®å‘ç»™ç½‘ç»œ socketï¼Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼ˆä»¥ Linux ä¸ºä¾‹)ï¼š")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("read() è°ƒç”¨")]),t._v(" "),s("ul",[s("li",[t._v("ä»ç£ç›˜è¯»å–æ•°æ®åˆ° "),s("strong",[t._v("å†…æ ¸ç¼“å†²åŒº")]),t._v("ï¼ˆPage Cacheï¼‰")]),t._v(" "),s("li",[t._v("å†ä»å†…æ ¸ç¼“å†²åŒºå¤åˆ¶åˆ° "),s("strong",[t._v("ç”¨æˆ·ç©ºé—´ç¼“å†²åŒº")]),t._v("ï¼ˆJVM å †ä¸­ï¼‰")])])]),t._v(" "),s("li",[s("strong",[t._v("write() è°ƒç”¨")]),t._v(" "),s("ul",[s("li",[t._v("æŠŠç”¨æˆ·ç©ºé—´ç¼“å†²åŒºæ•°æ®å¤åˆ¶å› "),s("strong",[t._v("å†…æ ¸ socket ç¼“å†²åŒº")])]),t._v(" "),s("li",[t._v("å†ç”±ç½‘å¡ DMA æŠŠæ•°æ®å‘åˆ°ç½‘ç»œ")])])])]),t._v(" "),s("p",[t._v("ğŸ“Œ è¿™æ ·ä¸€æ¥ï¼Œ"),s("strong",[t._v("æ•°æ®è‡³å°‘è¢«å¤åˆ¶äº† 4 æ¬¡")]),t._v("ï¼ˆ2 æ¬¡ CPU å†…å­˜æ‹·è´ï¼Œ2 æ¬¡ DMAï¼‰ï¼š")]),t._v(" "),s("div",{staticClass:"language-rust extra-class"},[s("pre",{pre:!0,attrs:{class:"language-rust"}},[s("code",[t._v("ç£ç›˜ "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("->")]),t._v(" å†…æ ¸ç¼“å†²åŒº  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DMA")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nå†…æ ¸ç¼“å†²åŒº "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("->")]),t._v(" ç”¨æˆ·ç¼“å†²åŒº  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CPU")]),t._v(" copy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nç”¨æˆ·ç¼“å†²åŒº "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("->")]),t._v(" socket ç¼“å†²åŒº  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CPU")]),t._v(" copy"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nsocket ç¼“å†²åŒº "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("->")]),t._v(" ç½‘å¡ç¼“å†²åŒº  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DMA")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("è¿™ä¼šæ¶ˆè€—å¤§é‡ CPU æ—¶é—´ï¼Œå°¤å…¶æ˜¯ Kafka è¿™ç§ä¼ è¾“å¤§é‡æ—¥å¿—æ•°æ®çš„åœºæ™¯ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("Kafkaçš„é›¶æ‹·è´å®ç°ï¼š")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://www.nootcode.com/knowledge/kafka-zero-copy/en/zero-copy.png",alt:""}})]),t._v(" "),s("ul",[s("li",[s("p",[t._v("å†™å…¥è·¯å¾„ï¼ˆProducer â†’ Brokerï¼‰ï¼šBrokerå°†åˆ†åŒºæ—¥å¿—æ®µç”¨ mmap æ˜ å°„åˆ°è¿›ç¨‹è™šæ‹Ÿå†…å­˜ï¼Œå†™å…¥åƒå†™å†…å­˜ï¼Œå‡å°‘ä¸€æ¬¡ç”¨æˆ·æ€æ‹·è´ä¸å¤šæ¬¡ read/write ç³»ç»Ÿè°ƒç”¨ï¼›æ•°æ®å…ˆå…¥ Page Cacheï¼Œç”±å†…æ ¸å¼‚æ­¥åˆ·ç›˜ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("å‘é€è·¯å¾„ï¼ˆBroker â†’ Consumerï¼‰ï¼šConsumer å‘èµ· FetchRequest åï¼ŒBroker åœ¨â€œå“åº”è¯¥è¯·æ±‚â€æ—¶ä½¿ç”¨ sendfile/transferToï¼Œå°† Page Cache ä¸­çš„æ•°æ®ç›´æ¥å†™å…¥ TCP socketï¼Œè·³è¿‡ç”¨æˆ·æ€ç¼“å†²ä¸ä¸¤æ¬¡ CPU æ‹·è´ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("Page Cache çš„ä½œç”¨ï¼šçƒ­æ•°æ®å¸¸é©»é¡µç¼“å­˜ï¼Œè¯»å–å¤šä¸ºå†…å­˜å‘½ä¸­ï¼›å†™å…¥å…ˆå…¥ç¼“å­˜ã€åå°è½ç›˜ï¼Œæ˜¾è‘—é™ä½ CPU å ç”¨ä¸ä¸Šä¸‹æ–‡åˆ‡æ¢ã€æå‡æ•´ä½“ååã€‚")])])]),t._v(" "),s("p",[s("strong",[t._v("å…³é”®ä»£ç ")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("sendfileï¼ˆConsumerä¾§å‘é€ï¼‰")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Java NIO: transferTo åº•å±‚åˆ©ç”¨ sendfile*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FileChannel")]),t._v(" fc "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RandomAccessFile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("file"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"r"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getChannel")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SocketChannel")]),t._v(" sc "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SocketChannel")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("open")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nfc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("transferTo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("position"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" count"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" sc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("mmapï¼ˆBrokerå†™æ—¥å¿—ï¼‰")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MappedByteBuffer")]),t._v(" buf "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fileChannel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FileChannel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MapMode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("READ_WRITE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" position"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" size"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nbuf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ç›´æ¥å†™æ˜ å°„å†…å­˜ï¼ŒOSå¼‚æ­¥è½ç›˜*")]),t._v("\n")])])])])]),t._v(" "),s("p",[s("strong",[t._v("ä¼˜åŠ¿ä¸é€‚ç”¨è¾¹ç•Œ")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("ä¼˜åŠ¿")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("é™ä½CPUå ç”¨ä¸ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼›å¸¦å®½æ›´é«˜ã€å»¶è¿Ÿæ›´ä½")])]),t._v(" "),s("li",[s("p",[t._v("é¿å…ç”¨æˆ·æ€ä¸­é—´ç¼“å†²ï¼Œå ç”¨æ›´å°‘å†…å­˜")])])])]),t._v(" "),s("li",[s("p",[t._v("é™åˆ¶/æ³¨æ„")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("æ•°æ®ä¸å¯æ”¹ï¼šsendfileåªé€‚ç”¨äºâ€œæ–‡ä»¶â†’socketâ€åŸæ ·ä¼ è¾“ï¼Œä¸èƒ½åœ¨ä¼ è¾“ä¸­æ”¹æ•°æ®ï¼ˆåŠ è§£å¯†ã€å˜æ›´æ ¼å¼ï¼‰ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("TLSå½±å“ï¼šåº”ç”¨å±‚TLSï¼ˆç”¨æˆ·æ€åŠ å¯†ï¼‰ä¼šç ´åé›¶æ‹·è´è·¯å¾„ï¼›éœ€å†…æ ¸TLSï¼ˆktlsï¼‰æˆ–ç»ˆæ­¢SSLåœ¨ä»£ç†å±‚ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("mmapå†…å­˜å ç”¨ï¼šæ˜ å°„è¿‡å¤§å¯èƒ½æŒ¤å‹å†…å­˜ï¼›éœ€è¦å…³æ³¨é¡µå›æ”¶ä¸è„é¡µåˆ·ç›˜ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("å°åŒ…/çŸ­è¿æ¥ä¸åˆ’ç®—ï¼šæå°æ¶ˆæ¯æˆ–é¢‘ç¹çŸ­è¿æ¥æ—¶ï¼Œé›¶æ‹·è´ä¼˜åŠ¿å‡å¼±ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("åº¦é‡ä¸å›é€€ï¼šé‡åˆ°å¼‚å¸¸ï¼ˆå¦‚transferToå¹³å°å·®å¼‚ã€å†…æ ¸Bugï¼‰éœ€å¯å›é€€æ™®é€šIOè·¯å¾„ã€‚")])])])])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-æ—¢ç„¶é›¶æ‹·è´è¿™ä¹ˆå¥½-ä¸ºä»€ä¹ˆè¿˜è¦æœ‰ä¼ ç»Ÿçš„ç»è¿‡ç”¨æˆ·æ€çš„æ–¹æ¡ˆå‘¢"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-æ—¢ç„¶é›¶æ‹·è´è¿™ä¹ˆå¥½-ä¸ºä»€ä¹ˆè¿˜è¦æœ‰ä¼ ç»Ÿçš„ç»è¿‡ç”¨æˆ·æ€çš„æ–¹æ¡ˆå‘¢"}},[t._v("#")]),t._v(" ğŸ¯ æ—¢ç„¶é›¶æ‹·è´è¿™ä¹ˆå¥½ï¼Œä¸ºä»€ä¹ˆè¿˜è¦æœ‰ä¼ ç»Ÿçš„ç»è¿‡ç”¨æˆ·æ€çš„æ–¹æ¡ˆå‘¢ï¼Ÿ")]),t._v(" "),s("p",[t._v("è¿™æ˜¯ä¸ªéå¸¸å¥½çš„é—®é¢˜ï¼é›¶æ‹·è´ç¡®å®æ€§èƒ½å¾ˆå¥½ï¼Œä½†å®ƒæœ‰ä¸¥æ ¼çš„ä½¿ç”¨é™åˆ¶ï¼Œä¸æ˜¯ä¸‡èƒ½çš„è§£å†³æ–¹æ¡ˆï¼š")]),t._v(" "),s("p",[s("strong",[t._v("ğŸš« é›¶æ‹·è´çš„å±€é™æ€§ï¼š")])]),t._v(" "),s("p",[s("strong",[t._v("1. æ•°æ®ä¸å¯ä¿®æ”¹é™åˆ¶")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// âŒ é›¶æ‹·è´åšä¸åˆ°çš„äº‹")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FileChannel")]),t._v(" fileChannel "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RandomAccessFile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"log.txt"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"r"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getChannel")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœæˆ‘ä»¬éœ€è¦å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ã€å‹ç¼©ã€æ ¼å¼è½¬æ¢æ€ä¹ˆåŠï¼Ÿ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// sendfileå’Œmmapéƒ½æ— æ³•åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¿®æ”¹æ•°æ®ï¼")]),t._v("\n")])])]),s("p",[s("strong",[t._v("ä¼ ç»Ÿæ–¹æ¡ˆçš„å¿…è¦æ€§ï¼š")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// âœ… ä¼ ç»Ÿæ–¹æ¡ˆå¯ä»¥å¤„ç†æ•°æ®")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FileInputStream")]),t._v(" fis "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("FileInputStream")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"log.txt"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" buffer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" bytesRead "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("read")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¯ä»¥å¯¹æ•°æ®è¿›è¡Œå„ç§å¤„ç†")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("encryptData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åŠ å¯†")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("compressData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å‹ç¼©  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("validateData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("     "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ ¡éªŒ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("transformData")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ ¼å¼è½¬æ¢")]),t._v("\n\nsocketChannel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ByteBuffer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("wrap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("buffer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[s("strong",[t._v("2. åº”ç”¨åœºæ™¯é™åˆ¶")])]),t._v(" "),s("p",[s("strong",[t._v("é›¶æ‹·è´é€‚ç”¨åœºæ™¯ï¼š")])]),t._v(" "),s("ul",[s("li",[t._v("âœ… é™æ€æ–‡ä»¶æœåŠ¡ï¼ˆnginxä¼ è¾“å›¾ç‰‡ã€è§†é¢‘ï¼‰")]),t._v(" "),s("li",[t._v("âœ… æ•°æ®åº“å¤‡ä»½ä¼ è¾“")]),t._v(" "),s("li",[t._v("âœ… CDNå†…å®¹åˆ†å‘")]),t._v(" "),s("li",[t._v("âœ… Kafka ConsumeråŸæ ·è½¬å‘æ¶ˆæ¯")])]),t._v(" "),s("p",[s("strong",[t._v("ä¼ ç»Ÿæ–¹æ¡ˆé€‚ç”¨åœºæ™¯ï¼š")])]),t._v(" "),s("ul",[s("li",[t._v("âœ… Webåº”ç”¨æœåŠ¡å™¨ï¼ˆéœ€è¦åŠ¨æ€ç”Ÿæˆå†…å®¹ï¼‰")]),t._v(" "),s("li",[t._v("âœ… APIç½‘å…³ï¼ˆéœ€è¦è¯·æ±‚è·¯ç”±ã€é‰´æƒã€é™æµï¼‰")]),t._v(" "),s("li",[t._v("âœ… æ¶ˆæ¯ä¸­é—´ä»¶çš„Producerï¼ˆéœ€è¦åºåˆ—åŒ–ã€å‹ç¼©ï¼‰")]),t._v(" "),s("li",[t._v("âœ… å®æ—¶æ•°æ®å¤„ç†ï¼ˆéœ€è¦è¿‡æ»¤ã€èšåˆã€è®¡ç®—ï¼‰")])]),t._v(" "),s("p",[s("strong",[t._v("3. å…·ä½“æŠ€æœ¯é™åˆ¶å¯¹æ¯”")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("æŠ€æœ¯æ–¹æ¡ˆ")]),t._v(" "),s("th",[t._v("èƒ½å¦ä¿®æ”¹æ•°æ®")]),t._v(" "),s("th",[t._v("å†…å­˜ä½¿ç”¨")]),t._v(" "),s("th",[t._v("CPUæ¶ˆè€—")]),t._v(" "),s("th",[t._v("é€‚ç”¨åœºæ™¯")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("sendfile")]),t._v(" "),s("td",[t._v("âŒ ä¸èƒ½ä¿®æ”¹")]),t._v(" "),s("td",[t._v("æä½")]),t._v(" "),s("td",[t._v("æä½")]),t._v(" "),s("td",[t._v("æ–‡ä»¶â†’ç½‘ç»œåŸæ ·ä¼ è¾“")])]),t._v(" "),s("tr",[s("td",[t._v("mmap")]),t._v(" "),s("td",[t._v("âœ… å¯ä»¥ä¿®æ”¹")]),t._v(" "),s("td",[t._v("é«˜ï¼ˆæ˜ å°„æ•´ä¸ªæ–‡ä»¶ï¼‰")]),t._v(" "),s("td",[t._v("ä½")]),t._v(" "),s("td",[t._v("é¢‘ç¹éšæœºè¯»å†™æ–‡ä»¶")])]),t._v(" "),s("tr",[s("td",[t._v("ä¼ ç»Ÿread/write")]),t._v(" "),s("td",[t._v("âœ… å®Œå…¨å¯æ§")]),t._v(" "),s("td",[t._v("ä¸­ç­‰")]),t._v(" "),s("td",[t._v("è¾ƒé«˜")]),t._v(" "),s("td",[t._v("éœ€è¦æ•°æ®å¤„ç†çš„åœºæ™¯")])])])]),t._v(" "),s("p",[s("strong",[t._v("4. å®é™…ä¸šåŠ¡ä¸­çš„é€‰æ‹©")])]),t._v(" "),s("p",[s("strong",[t._v("æ¡ˆä¾‹1ï¼šWebæœåŠ¡å™¨æ¶æ„")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Nginx (é›¶æ‹·è´) + Tomcat (ä¼ ç»Ÿæ–¹æ¡ˆ)")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Nginx")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("  sendfile on"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// é™æ€èµ„æºç”¨é›¶æ‹·è´")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Tomcat")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åŠ¨æ€å†…å®¹å¿…é¡»ç”¨ä¼ ç»Ÿæ–¹æ¡ˆ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/api/user/{id}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getUser")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@PathVariable")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Long")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("User")]),t._v(" user "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" userService"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("findById")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// éœ€è¦æŸ¥åº“ã€ä¸šåŠ¡é€»è¾‘å¤„ç†ã€JSONåºåˆ—åŒ–")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¿™äº›éƒ½å¿…é¡»åœ¨ç”¨æˆ·æ€å®Œæˆï¼Œé›¶æ‹·è´åšä¸åˆ°")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("strong",[t._v("æ¡ˆä¾‹2ï¼šæ¶ˆæ¯é˜Ÿåˆ—çš„ä¸¤é¢æ€§")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Kafka Producer (ä¼ ç»Ÿæ–¹æ¡ˆ)")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// éœ€è¦åºåˆ—åŒ–ã€åˆ†åŒºé€‰æ‹©ã€å‹ç¼©ç­‰å¤„ç†")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" serializedData "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" serializer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("serialize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" compressedData "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" compressor"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("compress")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("serializedData"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nproducer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ProducerRecord")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("topic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" compressedData"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Kafka Consumer (é›¶æ‹·è´)  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// åªéœ€è¦åŸæ ·è½¬å‘æ•°æ®ç»™å®¢æˆ·ç«¯")]),t._v("\nfileChannel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("transferTo")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("offset"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" length"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" socketChannel"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[s("strong",[t._v("5. ä¸ºä»€ä¹ˆä¸èƒ½éƒ½ç”¨é›¶æ‹·è´ï¼Ÿ")])]),t._v(" "),s("p",[s("strong",[t._v("æŠ€æœ¯åŸå› ï¼š")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("å®‰å…¨æ€§")]),t._v("ï¼šç”¨æˆ·æ€æ˜¯æ“ä½œç³»ç»Ÿçš„å®‰å…¨è¾¹ç•Œï¼Œå¾ˆå¤šæ“ä½œå¿…é¡»åœ¨ç”¨æˆ·æ€éªŒè¯")]),t._v(" "),s("li",[s("strong",[t._v("çµæ´»æ€§")]),t._v("ï¼šå¤æ‚çš„ä¸šåŠ¡é€»è¾‘éœ€è¦ç”¨æˆ·æ€çš„ç¼–ç¨‹ç¯å¢ƒ")]),t._v(" "),s("li",[s("strong",[t._v("å…¼å®¹æ€§")]),t._v("ï¼šå¾ˆå¤šç¬¬ä¸‰æ–¹åº“å’Œæ¡†æ¶éƒ½æ˜¯åŸºäºç”¨æˆ·æ€è®¾è®¡çš„")])]),t._v(" "),s("p",[s("strong",[t._v("è®¾è®¡å“²å­¦ï¼š")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("é›¶æ‹·è´")]),t._v("ï¼šè¿½æ±‚æè‡´æ€§èƒ½ï¼Œé€‚åˆç®€å•çš„æ•°æ®ä¼ è¾“")]),t._v(" "),s("li",[s("strong",[t._v("ä¼ ç»Ÿæ–¹æ¡ˆ")]),t._v("ï¼šè¿½æ±‚åŠŸèƒ½å®Œæ•´æ€§ï¼Œé€‚åˆå¤æ‚çš„ä¸šåŠ¡å¤„ç†")])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-åŸºäºkafkaçš„å»¶æ—¶é˜Ÿåˆ—å’Œæ­»ä¿¡é˜Ÿåˆ—å¦‚ä½•å®ç°"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-åŸºäºkafkaçš„å»¶æ—¶é˜Ÿåˆ—å’Œæ­»ä¿¡é˜Ÿåˆ—å¦‚ä½•å®ç°"}},[t._v("#")]),t._v(" ğŸ¯ åŸºäºkafkaçš„å»¶æ—¶é˜Ÿåˆ—å’Œæ­»ä¿¡é˜Ÿåˆ—å¦‚ä½•å®ç°")]),t._v(" "),s("p",[t._v("å»¶è¿Ÿé˜Ÿåˆ—æ˜¯ä¸€ç§ç‰¹æ®Šçš„é˜Ÿåˆ—ã€‚å®ƒé‡Œé¢çš„æ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œå½“å…ƒç´ è¿˜æ²¡åˆ°è¿‡æœŸæ—¶é—´ çš„æ—¶å€™ï¼Œå¦‚æœä½ è¯•å›¾ä»é˜Ÿåˆ—é‡Œé¢è·å–ä¸€ä¸ªå…ƒç´ ï¼Œä½ ä¼šè¢«é˜»å¡ã€‚å½“æœ‰å…ƒç´ è¿‡æœŸçš„æ—¶å€™ï¼Œä½ å°±ä¼š æ‹¿åˆ°è¿™ä¸ªè¿‡æœŸçš„å…ƒç´ ã€‚ä½ å¯ä»¥è¿™æ ·æƒ³ï¼Œä½ æ‹¿åˆ°çš„æ°¸è¿œæ˜¯æœ€å…ˆè¿‡æœŸçš„é‚£ä¸ªå…ƒç´ ã€‚")]),t._v(" "),s("p",[t._v("å¾ˆå¤šè¯­è¨€æœ¬èº«å°±æä¾›äº†å»¶è¿Ÿé˜Ÿåˆ—çš„å®ç°ï¼Œæ¯”å¦‚è¯´åœ¨ Java é‡Œé¢çš„ DelayQueueã€‚")]),t._v(" "),s("p",[t._v("æ­»ä¿¡é˜Ÿåˆ—æ˜¯ä¸€ç§é€»è¾‘ä¸Šçš„æ¦‚å¿µï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæœ¬èº«åªæ˜¯ä¸€ä¸ªæ™®é€šçš„é˜Ÿåˆ—ã€‚è€Œæ­»ä¿¡çš„æ„æ€æ˜¯æŒ‡è¿‡ æœŸçš„æ— æ³•è¢«æ¶ˆè´¹çš„æ¶ˆæ¯ï¼Œè¿™äº›æ¶ˆæ¯ä¼šè¢«æŠ•é€åˆ°è¿™ä¸ªæ­»ä¿¡é˜Ÿåˆ—ã€‚")]),t._v(" "),s("p",[t._v("åŸºäºKafkaå®ç°å»¶æ—¶é˜Ÿåˆ—å’Œæ­»ä¿¡é˜Ÿåˆ—å¯ä»¥æœ‰æ•ˆåœ°å¤„ç†æ¶ˆæ¯çš„å»¶è¿ŸæŠ•é€’å’Œå¼‚å¸¸æ¶ˆæ¯å¤„ç†ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„å®ç°æ–¹æ³•ï¼š")]),t._v(" "),s("h4",{attrs:{id:"å®ç°å»¶æ—¶é˜Ÿåˆ—"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å®ç°å»¶æ—¶é˜Ÿåˆ—"}},[t._v("#")]),t._v(" å®ç°å»¶æ—¶é˜Ÿåˆ—")]),t._v(" "),s("p",[t._v("å»¶æ—¶é˜Ÿåˆ—ç”¨äºå°†æ¶ˆæ¯åœ¨ç‰¹å®šæ—¶é—´åå†æŠ•é€’ã€‚å®ç°Kafkaå»¶æ—¶é˜Ÿåˆ—çš„æ–¹æ³•æœ‰å‡ ç§ï¼Œä»¥ä¸‹æ˜¯å…¶ä¸­ä¸€ç§å¸¸ç”¨æ–¹æ³•ï¼š")]),t._v(" "),s("p",[t._v("æ–¹æ³•ï¼š"),s("strong",[t._v("ä½¿ç”¨å¤šä¸ªä¸»é¢˜å’Œå®šæ—¶ä»»åŠ¡")])]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("åˆ›å»ºå¤šä¸ªä¸»é¢˜")]),t._v("ï¼šåˆ›å»ºä¸€ç»„æŒ‰å»¶è¿Ÿæ—¶é—´åˆ†éš”çš„Kafkaä¸»é¢˜ï¼Œå¦‚"),s("code",[t._v("delay-1min")]),t._v(", "),s("code",[t._v("delay-5min")]),t._v(", "),s("code",[t._v("delay-10min")]),t._v("ç­‰ã€‚")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("ç”Ÿäº§è€…å‘é€æ¶ˆæ¯")]),t._v("ï¼šç”Ÿäº§è€…æ ¹æ®æ¶ˆæ¯çš„å»¶è¿Ÿæ—¶é—´ï¼Œå°†æ¶ˆæ¯å‘é€åˆ°ç›¸åº”çš„å»¶è¿Ÿä¸»é¢˜ã€‚")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sendMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" topic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" delay"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è®¡ç®—ç›®æ ‡ä¸»é¢˜")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" delayTopic "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDelayTopic")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("delay"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å‘é€æ¶ˆæ¯åˆ°å»¶è¿Ÿä¸»é¢˜")]),t._v("\n    kafkaTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("delayTopic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getDelayTopic")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("long")]),t._v(" delay"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("delay "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("60000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"delay-1min"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("delay "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("300000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"delay-5min"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"delay-10min"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("å®šæ—¶ä»»åŠ¡æ¶ˆè´¹å»¶è¿Ÿä¸»é¢˜")]),t._v("ï¼šä½¿ç”¨å®šæ—¶ä»»åŠ¡æˆ–åå°çº¿ç¨‹å®šæœŸæ¶ˆè´¹å»¶è¿Ÿä¸»é¢˜ï¼Œå°†æ¶ˆæ¯è½¬å‘åˆ°å®é™…å¤„ç†çš„ä¸»é¢˜ã€‚")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Scheduled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fixedRate "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("60000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("processDelayQueue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerRecords")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" records "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" kafkaConsumer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("poll")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Duration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ofMillis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerRecord")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" record "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" records"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å°†æ¶ˆæ¯è½¬å‘åˆ°å®é™…å¤„ç†çš„ä¸»é¢˜")]),t._v("\n        kafkaTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"actual-topic"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),s("blockquote",[s("p",[t._v("è¿™ä¸ªæ–¹æ¡ˆçš„ç¼ºç‚¹å…¶å®è¿˜æŒºä¸¥é‡çš„ã€‚ç¬¬ä¸€ä¸ªæ˜¯å»¶è¿Ÿæ—¶é—´å¿…é¡»é¢„å…ˆè®¾å®šå¥½ï¼Œæ¯”å¦‚åª èƒ½å…è®¸å»¶è¿Ÿ 1minã€3min æˆ–è€… 10min çš„æ¶ˆæ¯ï¼Œä¸æ”¯æŒéšæœºå»¶è¿Ÿæ—¶é—´ã€‚ä¸è¿‡ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸šåŠ¡æ˜¯ç”¨ä¸ç€éå¾— éšæœºå»¶è¿Ÿæ—¶é—´çš„ã€‚")]),t._v(" "),s("p",[t._v("åœ¨ä¸€äº› ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œéœ€è¦æ ¹æ®å…·ä½“ä¸šåŠ¡æ•°æ®æ¥è®¡ç®—å»¶è¿Ÿæ—¶é—´ï¼Œé‚£ä¹ˆè¿™ä¸ªå°±ä¸é€‚ç”¨äº†ã€‚")]),t._v(" "),s("p",[t._v("ç¬¬äºŒä¸ªæ˜¯åˆ†åŒºä¹‹é—´è´Ÿè½½ä¸å‡åŒ€ã€‚æ¯”å¦‚å¾ˆå¤šä¸šåŠ¡å¯èƒ½åªéœ€è¦å»¶è¿Ÿ 3minï¼Œé‚£ä¹ˆ 1min å’Œ 10min åˆ†åŒºçš„æ•°æ®å°±å¾ˆå°‘ã€‚è¿™ä¼šè¿›ä¸€æ­¥å¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è´Ÿè½½é«˜çš„ åˆ†åŒºä¼šå‡ºç°æ¶ˆæ¯ç§¯å‹çš„é—®é¢˜ã€‚ åœ¨è¿™é‡Œï¼Œå¾ˆå¤šè§£å†³æ¶ˆæ¯ç§¯å‹çš„æ‰‹æ®µéƒ½æ— æ³•ä½¿ç”¨ï¼Œæ‰€ä»¥åªèƒ½è€ƒè™‘å¤šè®¾ç½®å‡ ä¸ªå»¶è¿Ÿ æ—¶é—´ç›¸è¿‘çš„åˆ†åŒºï¼Œæ¯”å¦‚è¯´åœ¨ 3min é™„è¿‘è®¾ç½® 2min30sï¼Œ3min30s è¿™ç§åˆ†åŒºæ¥åˆ† æ‘Šå‹åŠ›ã€‚")]),t._v(" "),s("p",[t._v("è¿˜è¦è€ƒè™‘ä¸€è‡´æ€§é—®é¢˜ï¼Œæ¯”å¦‚å‘é€å»¶æ—¶é˜Ÿåˆ—å¤±è´¥ã€æˆ–è€…è½¬å‘åˆ°ä¸šåŠ¡ topic æ—¶å¤±è´¥ï¼Œè¦æ€ä¹ˆå¤„ç†")])]),t._v(" "),s("p",[s("strong",[t._v("å• Topic + æ—¶é—´æˆ³æ–¹æ¡ˆ")])]),t._v(" "),s("ul",[s("li",[t._v("æ ¸å¿ƒæ€æƒ³ï¼šæ‰€æœ‰å»¶è¿Ÿæ¶ˆæ¯å‘é€åˆ°å•ä¸ª Topicï¼Œæ¶ˆæ¯ä¸­åŒ…å«è§¦å‘æ—¶é—´æˆ³")]),t._v(" "),s("li",[t._v("å®ç°æ­¥éª¤ï¼š\n"),s("ol",[s("li",[t._v("ç”Ÿäº§è€…å‘é€æ¶ˆæ¯æ—¶ï¼Œåœ¨æ¶ˆæ¯å¤´æˆ– key ä¸­æºå¸¦è§¦å‘æ—¶é—´æˆ³")]),t._v(" "),s("li",[t._v("æ¶ˆè´¹è€…æŒç»­æ‹‰å–æ¶ˆæ¯ï¼Œå¯¹æœªåˆ°è§¦å‘æ—¶é—´çš„æ¶ˆæ¯æš‚å­˜åˆ°æœ¬åœ°æœ‰åºé˜Ÿåˆ—")]),t._v(" "),s("li",[t._v("é€šè¿‡å®šæ—¶ä»»åŠ¡æ‰«ææœ‰åºé˜Ÿåˆ—ï¼Œå¤„ç†å·²åˆ°è§¦å‘æ—¶é—´çš„æ¶ˆæ¯")])])]),t._v(" "),s("li",[t._v("ä¼˜ç‚¹ï¼šæ— éœ€åˆ›å»ºå¤šä¸ªå»¶è¿Ÿ Topicï¼Œçµæ´»åº¦é«˜")]),t._v(" "),s("li",[t._v("ç¼ºç‚¹ï¼šéœ€ç»´æŠ¤æœ¬åœ°æœ‰åºé˜Ÿåˆ—ï¼Œé‡å¯å¯èƒ½ä¸¢å¤±æœªå¤„ç†æ¶ˆæ¯ï¼ˆå¯æŒä¹…åŒ–åˆ°æœ¬åœ°æ–‡ä»¶ï¼‰")])]),t._v(" "),s("h4",{attrs:{id:"å®ç°æ­»ä¿¡é˜Ÿåˆ—"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å®ç°æ­»ä¿¡é˜Ÿåˆ—"}},[t._v("#")]),t._v(" å®ç°æ­»ä¿¡é˜Ÿåˆ—")]),t._v(" "),s("p",[t._v("æ­»ä¿¡é˜Ÿåˆ—ç”¨äºå¤„ç†ç”±äºå„ç§åŸå› æ— æ³•æˆåŠŸå¤„ç†çš„æ¶ˆæ¯ã€‚å®ç° Kafka æ­»ä¿¡é˜Ÿåˆ—çš„æ–¹æ³•å¦‚ä¸‹ï¼š")]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("åˆ›å»ºæ­»ä¿¡ä¸»é¢˜")]),t._v("ï¼šåˆ›å»ºä¸€ä¸ªä¸“é—¨çš„æ­»ä¿¡ä¸»é¢˜ï¼Œå¦‚"),s("code",[t._v("dead-letter-topic")]),t._v("ã€‚")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("é…ç½®æ¶ˆè´¹è€…å¤„ç†é€»è¾‘")]),t._v("ï¼šåœ¨æ¶ˆè´¹è€…é€»è¾‘ä¸­æ•è·å¤„ç†å¤±è´¥çš„å¼‚å¸¸ï¼Œå°†å¤±è´¥çš„æ¶ˆæ¯å‘é€åˆ°æ­»ä¿¡ä¸»é¢˜ã€‚")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("consume")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerRecord")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¤„ç†æ¶ˆæ¯")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("processMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Exception")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å°†å¤„ç†å¤±è´¥çš„æ¶ˆæ¯å‘é€åˆ°æ­»ä¿¡ä¸»é¢˜")]),t._v("\n        kafkaTemplate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dead-letter-topic"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("key")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("processMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¤„ç†æ¶ˆæ¯é€»è¾‘")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("contains")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"error"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RuntimeException")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"å¤„ç†å¤±è´¥"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("ç›‘æ§æ­»ä¿¡é˜Ÿåˆ—")]),t._v("ï¼šå®šæœŸæ£€æŸ¥æ­»ä¿¡ä¸»é¢˜ä¸­çš„æ¶ˆæ¯ï¼Œåˆ†æå’Œå¤„ç†è¿™äº›å¤±è´¥çš„æ¶ˆæ¯ã€‚")]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Scheduled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fixedRate "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("60000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("processDeadLetterQueue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerRecords")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" records "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" kafkaConsumer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("poll")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Duration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ofMillis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConsumerRecord")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" record "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" records"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è®°å½•æˆ–é‡è¯•å¤„ç†æ­»ä¿¡æ¶ˆæ¯")]),t._v("\n        logger"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"å¤„ç†æ­»ä¿¡æ¶ˆæ¯: "')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),s("p",[s("strong",[t._v("ä¼˜ç‚¹")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("è§£è€¦")]),t._v("ï¼šä½¿ç”¨Kafkaä¸»é¢˜æ¥å®ç°å»¶æ—¶å’Œæ­»ä¿¡é˜Ÿåˆ—ï¼Œå¯ä»¥è§£è€¦ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("æ‰©å±•æ€§")]),t._v("ï¼šKafkaå¤©ç„¶æ”¯æŒåˆ†å¸ƒå¼å’Œé«˜ååé‡ï¼Œé€‚åˆå¤§è§„æ¨¡æ¶ˆæ¯å¤„ç†ã€‚")])]),t._v(" "),s("p",[s("strong",[t._v("å±€é™æ€§")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("å¤æ‚æ€§")]),t._v("ï¼šéœ€è¦ç®¡ç†å¤šä¸ªä¸»é¢˜å’Œå®šæ—¶ä»»åŠ¡ï¼Œå¢åŠ äº†ç³»ç»Ÿå¤æ‚æ€§ã€‚")]),t._v(" "),s("li",[s("strong",[t._v("å»¶è¿Ÿç²¾åº¦")]),t._v("ï¼šå»¶æ—¶é˜Ÿåˆ—çš„å»¶è¿Ÿç²¾åº¦å–å†³äºå®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œé¢‘ç‡ï¼Œå¯èƒ½æ— æ³•è¾¾åˆ°æ¯«ç§’çº§ç²¾åº¦ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafka-ç›®å‰æœ‰å“ªäº›å†…éƒ¨-topic-ä»–ä»¬éƒ½æœ‰ä»€ä¹ˆç‰¹å¾-å„è‡ªçš„ä½œç”¨åˆæ˜¯ä»€ä¹ˆ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafka-ç›®å‰æœ‰å“ªäº›å†…éƒ¨-topic-ä»–ä»¬éƒ½æœ‰ä»€ä¹ˆç‰¹å¾-å„è‡ªçš„ä½œç”¨åˆæ˜¯ä»€ä¹ˆ"}},[t._v("#")]),t._v(" ğŸ¯ Kafka ç›®å‰æœ‰å“ªäº›å†…éƒ¨ topicï¼Œä»–ä»¬éƒ½æœ‰ä»€ä¹ˆç‰¹å¾ï¼Œå„è‡ªçš„ä½œç”¨åˆæ˜¯ä»€ä¹ˆï¼Ÿ")]),t._v(" "),s("p",[t._v("ä¸‹é¢æŒ‰â€œæ ¸å¿ƒå†…ç½® / KRaftå…ƒæ•°æ® / ç”Ÿæ€ç»„ä»¶å†…éƒ¨Topicâ€æ¢³ç†ï¼Œç»™å‡ºç‰¹å¾ä¸ä½œç”¨ã€‚é¢è¯•æ—¶å…ˆç­”æ ¸å¿ƒä¸¤é¡¹ï¼Œå†æŒ‰æ˜¯å¦ä½¿ç”¨KRaftã€Connect/Streamsè¡¥å……ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("æ ¸å¿ƒå†…ç½®ï¼ˆæ‰€æœ‰Kafkaéƒ½æœ‰ï¼‰")])]),t._v(" "),s("ul",[s("li",[s("p",[s("em",[t._v("consumer_offsets")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("ç‰¹å¾ï¼šcleanup.policy=compactï¼›é»˜è®¤åˆ†åŒºæ•°â‰ˆ50ï¼ˆoffsets.topic.num.partitionsï¼‰ï¼›RFå»ºè®®=3ï¼ˆoffsets.topic.replication.factorï¼‰")])]),t._v(" "),s("li",[s("p",[t._v("ä½œç”¨ï¼šå­˜å‚¨æ¶ˆè´¹è€…ç»„çš„å·²æäº¤offsetä¸ç»„å…ƒæ•°æ®ï¼ˆåˆ†é…æ–¹æ¡ˆç­‰ï¼‰ï¼Œç”±GroupCoordinatorè¯»å†™")])]),t._v(" "),s("li",[s("p",[t._v("è¦ç‚¹ï¼šæŒ‰groupç»´åº¦éš”ç¦»ï¼›ä¸è¦æ‰‹å·¥å†™å…¥/åˆ é™¤ï¼›ä¿éšœRFä¸min.insync.replicasï¼Œé¿å…ä¸¢offset")])])])]),t._v(" "),s("li",[s("p",[s("em",[t._v("transaction_state")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("ç‰¹å¾ï¼šcleanup.policy=compactï¼›é»˜è®¤åˆ†åŒºæ•°â‰ˆ50ï¼ˆtransaction.state.log.num.partitionsï¼‰ï¼›RFå»ºè®®=3")])]),t._v(" "),s("li",[s("p",[t._v("ä½œç”¨ï¼šå­˜å‚¨äº‹åŠ¡/å¹‚ç­‰ç›¸å…³å…ƒæ•°æ®ï¼ˆtransactional.idâ†’producerId/epochã€äº‹åŠ¡çŠ¶æ€ã€commit/abort markersï¼‰ï¼Œæ”¯æ’‘EOS")])]),t._v(" "),s("li",[s("p",[t._v("è¦ç‚¹ï¼šä¸å¯ç”¨ä¼šå¯¼è‡´äº‹åŠ¡ç”Ÿäº§/æäº¤å¤±è´¥ï¼›ç›‘æ§äº‹åŠ¡åè°ƒå™¨ä¸ç£ç›˜å¥åº·")])])])])]),t._v(" "),s("p",[s("strong",[t._v("KRaftæ¨¡å¼ï¼ˆæ— ZKæ—¶ï¼‰")])]),t._v(" "),s("ul",[s("li",[s("p",[s("em",[t._v("cluster_metadataï¼ˆå…ƒæ•°æ®æ—¥å¿—ï¼Œæ§åˆ¶é¢ä¸“ç”¨ï¼‰")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("ç‰¹å¾ï¼šRaftå¤åˆ¶çš„å†…éƒ¨å…ƒæ•°æ®æ—¥å¿—ï¼Œä¸ä½œä¸ºæ™®é€šä¸šåŠ¡Topicä½¿ç”¨")])]),t._v(" "),s("li",[s("p",[t._v("ä½œç”¨ï¼šæŒä¹…åŒ–é›†ç¾¤å…ƒæ•°æ®äº‹ä»¶ï¼ˆTopic/Partition/ACL/ISRç­‰ï¼‰")])]),t._v(" "),s("li",[s("p",[t._v("è¦ç‚¹ï¼šå­˜åœ¨äºControllerèŠ‚ç‚¹ï¼›å…³ç³»åˆ°é›†ç¾¤ç”Ÿæ­»ï¼Œç¡®ä¿å­˜å‚¨ä¸å‰¯æœ¬å¥åº·")])])])])]),t._v(" "),s("p",[s("strong",[t._v("ç”Ÿæ€ç»„ä»¶çš„â€œå†…éƒ¨Topicâ€ï¼ˆæŒ‰éœ€å‡ºç°ï¼‰")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("Kafka Connect")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("connect-configsï¼ˆcompactï¼‰ï¼šå­˜å‚¨è¿æ¥å™¨/ä»»åŠ¡é…ç½®")])]),t._v(" "),s("li",[s("p",[t._v("connect-offsetsï¼ˆcompactï¼‰ï¼šå­˜å‚¨æºè¿æ¥å™¨çš„è¯»å–åç§»")])]),t._v(" "),s("li",[s("p",[t._v("connect-statusï¼ˆcompactï¼‰ï¼šå­˜å‚¨connector/taskçŠ¶æ€")])]),t._v(" "),s("li",[s("p",[t._v("è¦ç‚¹ï¼šRFâ‰¥3ã€min.insync.replicasâ‰¥2ï¼Œé¿å…å•ç‚¹ï¼›è¿ç§»/æ¢å¤é è¿™äº›Topic")])])])]),t._v(" "),s("li",[s("p",[t._v("Kafka Streamsï¼ˆä»¥åº”ç”¨IDä¸ºå‰ç¼€è‡ªåŠ¨åˆ›å»ºï¼‰")]),t._v(" "),s("ul",[s("li",[s("p",[s("code",[t._v("<appId>-...-changelogï¼ˆcompactï¼‰")]),t._v("ï¼šçŠ¶æ€å­˜å‚¨å¿«ç…§æ—¥å¿—ï¼Œç”¨äºæ•…éšœæ¢å¤")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("<appId>-...-repartitionï¼ˆdeleteï¼‰")]),t._v("ï¼šé‡åˆ†åŒºTopicï¼Œç”¨äºæŒ‰keyé‡åˆ†å¸ƒæ•°æ®")])]),t._v(" "),s("li",[s("p",[t._v("è¦ç‚¹ï¼šä¸ºé«˜å¯ç”¨å°†RFè®¾ä¸º3ï¼›åˆ†åŒºæ•°å½±å“å¹¶è¡Œåº¦ä¸æ¢å¤é€Ÿåº¦")])])])]),t._v(" "),s("li",[s("p",[t._v("Confluent Schema Registry")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("_schemasï¼ˆcompactï¼‰ï¼šå­˜å‚¨Avro/Protobuf/JSON SchemaåŠç‰ˆæœ¬")])]),t._v(" "),s("li",[s("p",[t._v("è¦ç‚¹ï¼šéKafkaæ ¸å¿ƒè‡ªå¸¦ï¼Œä½†å¸¸è§äºConfluentå‘è¡Œç‰ˆ")])])])])]),t._v(" "),s("p",[t._v("è¡¥å……æ³¨æ„")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("è¿™äº›å†…éƒ¨Topicå¤šä¸ºâ€œcompactâ€ä»¥ä¿ç•™æœ€æ–°çŠ¶æ€ï¼Œéœ€ä¿éšœRF/min.insyncä¸ç£ç›˜å¥åº·ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("ä¸è¦å¯¹å…¶åšäººä¸ºæ¸…ç†/å˜æ›´ï¼›è¿ç»´æ—¶ä»…è°ƒå‚ä¸ç›‘æ§ï¼ˆURPã€ISRã€å»¶è¿Ÿã€åˆ†åŒºæ•°ã€ç£ç›˜ï¼‰ã€‚")])])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafkaæ”¯æŒäº‹åŠ¡ä¹ˆ-ä½ ä»¬é¡¹ç›®ä¸­æœ‰ä½¿ç”¨ä¹ˆ-å®ƒçš„åŸç†æ˜¯ä»€ä¹ˆ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafkaæ”¯æŒäº‹åŠ¡ä¹ˆ-ä½ ä»¬é¡¹ç›®ä¸­æœ‰ä½¿ç”¨ä¹ˆ-å®ƒçš„åŸç†æ˜¯ä»€ä¹ˆ"}},[t._v("#")]),t._v(" ğŸ¯ kafkaæ”¯æŒäº‹åŠ¡ä¹ˆï¼Œä½ ä»¬é¡¹ç›®ä¸­æœ‰ä½¿ç”¨ä¹ˆï¼Œå®ƒçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ")]),t._v(" "),s("p",[s("strong",[t._v("æ”¯æŒ")]),t._v("ï¼ˆä» "),s("strong",[t._v("Kafka 0.11")]),t._v(" å¼€å§‹ï¼‰ã€‚")]),t._v(" "),s("p",[t._v("äº‹åŠ¡çš„ä¸»è¦ç›®æ ‡æ˜¯ "),s("strong",[t._v("ä¿è¯å¤šæ¡æ¶ˆæ¯çš„å†™å…¥è¦ä¹ˆå…¨éƒ¨æˆåŠŸã€è¦ä¹ˆå…¨éƒ¨å¤±è´¥")]),t._v("ï¼Œè§£å†³ã€Œ"),s("strong",[t._v("æ¶ˆæ¯ä¸¢å¤±")]),t._v("ã€ã€Œ"),s("strong",[t._v("æ¶ˆè´¹ç«¯è¯»åˆ°ä¸ä¸€è‡´æ•°æ®")]),t._v("ã€çš„é—®é¢˜ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("Kafka äº‹åŠ¡çš„åº”ç”¨åœºæ™¯")])]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("Exactly Once è¯­ä¹‰ï¼ˆEOSï¼‰")]),t._v("ï¼š\n"),s("ul",[s("li",[t._v("ç”Ÿäº§è€…å†™å¤šæ¡æ¶ˆæ¯åˆ°å¤šä¸ªåˆ†åŒºï¼Œè¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆéƒ½å›æ»šã€‚")]),t._v(" "),s("li",[t._v("é…åˆ Kafka Streamsï¼Œå¯ä»¥ä¿è¯æµå¼å¤„ç†çš„ç«¯åˆ°ç«¯ç²¾ç¡®ä¸€æ¬¡ã€‚")])])]),t._v(" "),s("li",[s("strong",[t._v("è·¨ Topic çš„åŸå­å†™")]),t._v("ï¼š\n"),s("ul",[s("li",[t._v("æ¯”å¦‚è®¢å•æœåŠ¡è¦åŒæ—¶å†™ "),s("code",[t._v("order_topic")]),t._v(" å’Œ "),s("code",[t._v("inventory_topic")]),t._v("ï¼Œäº‹åŠ¡èƒ½ä¿è¯ä¸€è‡´æ€§ã€‚")])])])]),t._v(" "),s("p",[s("strong",[t._v("Kafka äº‹åŠ¡çš„åŸç†")])]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("äº‹åŠ¡ IDï¼ˆtransactional.idï¼‰")]),t._v(" "),s("ul",[s("li",[t._v("ç”Ÿäº§è€…å¯åŠ¨æ—¶æŒ‡å®šï¼ŒKafka ä¼šä¸ºå®ƒåˆ†é…ä¸€ä¸ª "),s("strong",[t._v("å”¯ä¸€çš„äº‹åŠ¡åè°ƒå™¨ï¼ˆTransaction Coordinatorï¼‰")]),t._v("ã€‚")]),t._v(" "),s("li",[t._v("åè°ƒå™¨è´Ÿè´£ç®¡ç†è¯¥ç”Ÿäº§è€…çš„äº‹åŠ¡çŠ¶æ€ã€‚")])])]),t._v(" "),s("li",[s("strong",[t._v("å†™å…¥æµç¨‹")]),t._v(" "),s("ul",[s("li",[t._v("ç”Ÿäº§è€…å…ˆå‘ "),s("strong",[t._v("äº‹åŠ¡åè°ƒå™¨")]),t._v(" æ³¨å†Œäº‹åŠ¡ â†’ è·å–äº‹åŠ¡ ID â†’ å¼€å§‹äº‹åŠ¡ã€‚")]),t._v(" "),s("li",[t._v("ç”Ÿäº§è€…å†™æ¶ˆæ¯åˆ°åˆ†åŒºæ—¶ï¼Œè¿™äº›æ¶ˆæ¯ä¼šè¢«æ ‡è®°ä¸º "),s("strong",[t._v("æœªæäº¤ï¼ˆUncommittedï¼‰")]),t._v("ã€‚")]),t._v(" "),s("li",[t._v("æœ€åç”±ç”Ÿäº§è€…è°ƒç”¨ "),s("code",[t._v("commitTransaction()")]),t._v(" æˆ– "),s("code",[t._v("abortTransaction()")]),t._v("ã€‚")]),t._v(" "),s("li",[t._v("åè°ƒå™¨å†™ä¸€æ¡ "),s("strong",[t._v("äº‹åŠ¡æ—¥å¿—ï¼ˆ__transaction_stateï¼‰")]),t._v("ï¼Œæ ‡è®°äº‹åŠ¡æäº¤æˆ–å›æ»šã€‚")])])]),t._v(" "),s("li",[s("strong",[t._v("æ¶ˆè´¹è€…å¤„ç†")]),t._v(" "),s("ul",[s("li",[t._v("äº‹åŠ¡æäº¤å‰ï¼Œæ¶ˆè´¹è€…ä¸ä¼šçœ‹åˆ°æ¶ˆæ¯ï¼ˆé™¤éé…ç½® "),s("code",[t._v("isolation.level=read_uncommitted")]),t._v("ï¼‰ã€‚")]),t._v(" "),s("li",[t._v("é»˜è®¤æ˜¯ "),s("code",[t._v("read_committed")]),t._v("ï¼Œåªä¼šæ¶ˆè´¹äº‹åŠ¡æäº¤æˆåŠŸçš„æ•°æ®ã€‚")])])])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafkaä¸­çš„å¹‚ç­‰æ˜¯æ€ä¹ˆå®ç°çš„"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafkaä¸­çš„å¹‚ç­‰æ˜¯æ€ä¹ˆå®ç°çš„"}},[t._v("#")]),t._v(" ğŸ¯ kafkaä¸­çš„å¹‚ç­‰æ˜¯æ€ä¹ˆå®ç°çš„?")]),t._v(" "),s("p",[t._v("Kafkaä¸­ï¼Œå¹‚ç­‰æ€§ï¼ˆIdempotenceï¼‰æŒ‡çš„æ˜¯å‘é€æ¶ˆæ¯åˆ°Kafkaé›†ç¾¤æ—¶ï¼Œå³ä½¿å¤šæ¬¡å‘é€ç›¸åŒçš„æ¶ˆæ¯ï¼Œä¹Ÿä¸ä¼šå¯¼è‡´æ¶ˆæ¯è¢«å¤šæ¬¡å¤„ç†æˆ–äº§ç”Ÿå‰¯ä½œç”¨ã€‚Kafkaé€šè¿‡ä»¥ä¸‹æœºåˆ¶å®ç°å¹‚ç­‰æ€§ï¼š")]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("Producer IDï¼ˆPIDï¼‰")])]),t._v(" "),s("ul",[s("li",[t._v("æ¯ä¸ªå¹‚ç­‰æ€§ç”Ÿäº§è€…åœ¨åˆå§‹åŒ–æ—¶éƒ½ä¼šåˆ†é…ä¸€ä¸ªå”¯ä¸€çš„Producer IDï¼ˆPIDï¼‰ã€‚è¿™ä¸ªIDç”¨äºæ ‡è¯†è¯¥ç”Ÿäº§è€…å®ä¾‹ã€‚")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("åºåˆ—å·")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("æ¯ä¸ªæ¶ˆæ¯ï¼ˆRecordï¼‰åœ¨å‘é€æ—¶éƒ½ä¼šè¢«åˆ†é…ä¸€ä¸ªåºåˆ—å·ã€‚è¿™ä¸ªåºåˆ—å·æ˜¯ç”Ÿäº§è€…åœ¨æ¯ä¸ªåˆ†åŒºä¸Šå•è°ƒé€’å¢çš„ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("åºåˆ—å·å’ŒPIDç»“åˆä½¿ç”¨ï¼Œå¯ä»¥å”¯ä¸€æ ‡è¯†æ¯ä¸ªæ¶ˆæ¯ã€‚")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("å¹‚ç­‰æ€§ä¿è¯é€»è¾‘")])]),t._v(" "),s("ul",[s("li",[s("p",[t._v("Kafka Brokerä¼šç»´æŠ¤æ¯ä¸ªç”Ÿäº§è€…çš„PIDå’Œåºåˆ—å·çš„æ˜ å°„è¡¨ã€‚å½“Brokeræ¥æ”¶åˆ°ä¸€æ¡æ¶ˆæ¯æ—¶ï¼Œä¼šæ£€æŸ¥è¿™æ¡æ¶ˆæ¯çš„PIDå’Œåºåˆ—å·ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("å¦‚æœæ¶ˆæ¯çš„PIDå’Œåºåˆ—å·ä¸ä¹‹å‰æ¥æ”¶åˆ°çš„æ¶ˆæ¯ç›¸åŒï¼Œåˆ™Brokerä¼šä¸¢å¼ƒè¿™æ¡æ¶ˆæ¯ï¼Œé¿å…é‡å¤å†™å…¥ã€‚")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("é‡è¯•æœºåˆ¶")])]),t._v(" "),s("ul",[s("li",[t._v("å¦‚æœæ¶ˆæ¯å‘é€å¤±è´¥ï¼Œå¹‚ç­‰æ€§ç”Ÿäº§è€…ä¼šè‡ªåŠ¨é‡è¯•ã€‚ç”±äºPIDå’Œåºåˆ—å·çš„æœºåˆ¶ï¼Œå³ä½¿å‘ç”Ÿé‡è¯•ï¼Œä¹Ÿä¸ä¼šå¯¼è‡´æ¶ˆæ¯é‡å¤å†™å…¥ã€‚")])])])]),t._v(" "),s("p",[t._v("Producer ç«¯åœ¨å‘é€æ—¶ä¼šç»™æ¯æ¡æ¶ˆæ¯åŠ ä¸Šé€’å¢çš„åºåˆ—å·ï¼ŒBroker ç«¯ä¸ºæ¯ä¸ª "),s("code",[t._v("(PID, Partition)")]),t._v(" ç»´æŠ¤æœ€æ–°åºåˆ—å·ï¼Œé‡å¤çš„å°±ç›´æ¥ä¸¢å¼ƒã€‚\nå¼€å¯å¹‚ç­‰æ€§åèƒ½ä¿è¯å•ä¸ª Producer Session å†…ï¼ŒåŒä¸€æ¡æ¶ˆæ¯å³ä½¿é‡å¤å‘é€ä¹Ÿåªä¼šå†™ä¸€æ¬¡ï¼Œä½†è·¨ Session è¦ç”¨äº‹åŠ¡æ¥ä¿è¯ Exactly Onceã€‚")]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-ä¸ºä»€ä¹ˆkafkaä¸æ”¯æŒè¯»å†™åˆ†ç¦»"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-ä¸ºä»€ä¹ˆkafkaä¸æ”¯æŒè¯»å†™åˆ†ç¦»"}},[t._v("#")]),t._v(" ğŸ¯ ä¸ºä»€ä¹ˆkafkaä¸æ”¯æŒè¯»å†™åˆ†ç¦»ï¼Ÿ")]),t._v(" "),s("p",[t._v("Kafkaä¸æ”¯æŒè¯»å†™åˆ†ç¦»çš„ä¸»è¦åŸå› ä¸å…¶è®¾è®¡åŸåˆ™ã€æ€§èƒ½ä¼˜åŒ–ä»¥åŠæ•°æ®ä¸€è‡´æ€§éœ€æ±‚å¯†åˆ‡ç›¸å…³ã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£é‡Šï¼š")]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("æ•°æ®ä¸€è‡´æ€§")])]),t._v(" "),s("p",[t._v("Kafkaçš„è®¾è®¡ç›®æ ‡ä¹‹ä¸€æ˜¯ä¿è¯æ¶ˆæ¯çš„å¼ºä¸€è‡´æ€§ã€‚åœ¨Kafkaä¸­ï¼Œæ¯ä¸ªåˆ†åŒºéƒ½æœ‰ä¸€ä¸ªLeaderå’Œå¤šä¸ªFollowerã€‚æ‰€æœ‰çš„å†™æ“ä½œå¿…é¡»å…ˆå†™å…¥Leaderï¼Œç„¶åLeaderä¼šå°†æ•°æ®å¤åˆ¶åˆ°Followerã€‚")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("å•ç‚¹å†™å…¥")]),t._v("ï¼šæ‰€æœ‰å†™æ“ä½œé€šè¿‡Leaderè¿›è¡Œï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ã€‚Followerä»LeaderåŒæ­¥æ•°æ®ï¼Œä¿æŒä¸Leaderçš„æ•°æ®ä¸€è‡´ã€‚")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("ä¸€è‡´æ€§ä¿éšœ")]),t._v("ï¼šå¦‚æœå…è®¸è¯»æ“ä½œä»Followerè¯»å–æ•°æ®ï¼Œç”±äºFollowerå¯èƒ½ä¼šæ»åäºLeaderï¼Œå¯èƒ½å¯¼è‡´è¯»å–åˆ°ä¸ä¸€è‡´çš„æ•°æ®ã€‚")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("ç®€åŒ–è®¾è®¡å’Œé«˜æ€§èƒ½")])]),t._v(" "),s("p",[t._v("Kafkaçš„è®¾è®¡ç†å¿µæ˜¯ä¿æŒæ¶æ„çš„ç®€æ´å’Œé«˜æ•ˆï¼Œè¿™å¯¹äºå®ç°"),s("strong",[t._v("é«˜ååé‡å’Œä½å»¶è¿Ÿ")]),t._v("çš„æ¶ˆæ¯ç³»ç»Ÿè‡³å…³é‡è¦ã€‚")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("å•ä¸€æœºåˆ¶")]),t._v("ï¼šé€šè¿‡ä»…å…è®¸Leaderå¤„ç†å†™æ“ä½œå’Œå¤§éƒ¨åˆ†è¯»æ“ä½œï¼ŒKafkaç®€åŒ–äº†å…¶æ•°æ®ä¸€è‡´æ€§å’Œåˆ†å¸ƒå¼å¤„ç†é€»è¾‘ã€‚")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("æ€§èƒ½ä¼˜åŒ–")]),t._v("ï¼šLeaderå¤„ç†è¯»å†™æ“ä½œï¼Œé¿å…äº†åœ¨Followerä¸Šå®ç°å¤æ‚çš„è¯»ä¸€è‡´æ€§é€»è¾‘ï¼Œè¿™ç®€åŒ–äº†å®ç°å¹¶ä¼˜åŒ–äº†æ€§èƒ½ã€‚")])])])]),t._v(" "),s("li",[s("p",[t._v("é«˜å¯ç”¨æ€§å’Œæ•…éšœæ¢å¤")]),t._v(" "),s("p",[t._v("Kafkaé€šè¿‡Leaderå’ŒFolloweræœºåˆ¶æ¥ä¿è¯é«˜å¯ç”¨æ€§å’Œå¿«é€Ÿæ•…éšœæ¢å¤ã€‚")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("å¿«é€Ÿæ¢å¤")]),t._v("ï¼šåœ¨Leaderæ•…éšœæ—¶ï¼Œä»ISRï¼ˆIn-Sync Replicasï¼‰ä¸­é€‰ä¸¾æ–°çš„Leaderã€‚å¦‚æœè¯»æ“ä½œå…è®¸ä»Followerè¯»å–ï¼Œæ•…éšœæ¢å¤è¿‡ç¨‹ä¼šå˜å¾—å¤æ‚ï¼Œå› ä¸ºéœ€è¦ç¡®ä¿æ–°Leaderçš„Followeræ•°æ®æ˜¯ä¸€è‡´ä¸”æœ€æ–°çš„ã€‚")])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("ç®€åŒ–æ•…éšœå¤„ç†")]),t._v("ï¼šä»…ä»Leaderè¯»å–å’Œå†™å…¥ï¼Œä½¿å¾—æ•…éšœå¤„ç†é€»è¾‘æ›´ç®€å•ï¼Œç¡®ä¿ç³»ç»Ÿåœ¨æ•…éšœæ¢å¤è¿‡ç¨‹ä¸­ä»ç„¶å¯ä»¥æä¾›å¼ºä¸€è‡´æ€§çš„æ•°æ®æœåŠ¡ã€‚")])])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("å¯é¢„è§çš„è´Ÿè½½åˆ†å¸ƒ")])]),t._v(" "),s("p",[t._v("é€šè¿‡å°†æ‰€æœ‰å†™æ“ä½œé›†ä¸­åœ¨Leaderä¸Šï¼ŒKafkaå¯ä»¥æ›´å¥½åœ°é¢„æµ‹å’Œç®¡ç†ç³»ç»Ÿè´Ÿè½½ã€‚")]),t._v(" "),s("ul",[s("li",[s("p",[s("strong",[t._v("é¢„é˜²çƒ­ç‚¹")]),t._v("ï¼šé¿å…FollowerèŠ‚ç‚¹æˆä¸ºè¯»è¯·æ±‚çš„çƒ­ç‚¹ï¼Œå¯¼è‡´ä¸å‡è¡¡çš„èµ„æºæ¶ˆè€—ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("è´Ÿè½½ç®¡ç†ï¼šå¯ä»¥æ›´å¥½åœ°ç®¡ç†å’Œè°ƒé…ç³»ç»Ÿèµ„æºï¼Œé¿å…ç”±äºFollowerè¯»è¯·æ±‚å¯¼è‡´çš„ä¸å‡è¡¡è´Ÿè½½ã€‚")])])])])]),t._v(" "),s("p",[t._v("Kafkaçš„è®¾è®¡ç†å¿µå’Œæ¶æ„å†³å®šäº†ä¸æ”¯æŒè¯»å†™åˆ†ç¦»ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§ã€ç®€åŒ–è®¾è®¡å’Œä¼˜åŒ–æ€§èƒ½ã€‚é€šè¿‡é›†ä¸­å¤„ç†å†™æ“ä½œå’Œå¤§éƒ¨åˆ†è¯»æ“ä½œï¼ŒKafkaèƒ½å¤Ÿæä¾›é«˜ååé‡ã€ä½å»¶è¿Ÿå’Œé«˜å¯é æ€§çš„æ¶ˆæ¯æœåŠ¡ã€‚")]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafkaconsumeræ˜¯éçº¿ç¨‹å®‰å…¨çš„-é‚£æ€ä¹ˆå®ç°å¤šçº¿ç¨‹æ¶ˆè´¹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafkaconsumeræ˜¯éçº¿ç¨‹å®‰å…¨çš„-é‚£æ€ä¹ˆå®ç°å¤šçº¿ç¨‹æ¶ˆè´¹"}},[t._v("#")]),t._v(" ğŸ¯ KafkaConsumeræ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œé‚£æ€ä¹ˆå®ç°å¤šçº¿ç¨‹æ¶ˆè´¹?")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("æ¯ä¸ªçº¿ç¨‹ä¸€ä¸ªKafkaConsumerå®ä¾‹ï¼šæœ€ç®€å•ä¸”å¸¸è§çš„æ–¹æ³•æ˜¯æ¯ä¸ªçº¿ç¨‹åˆ›å»ºä¸€ä¸ªKafkaConsumerå®ä¾‹ã€‚è¿™ç§æ–¹å¼å¯ä»¥ç¡®ä¿æ¯ä¸ªæ¶ˆè´¹è€…å®ä¾‹åœ¨ç‹¬ç«‹çš„çº¿ç¨‹ä¸­è¿è¡Œï¼Œé¿å…çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚")])]),t._v(" "),s("li",[s("p",[t._v("å•ä¸ªKafkaConsumerå®ä¾‹å¤šçº¿ç¨‹å¤„ç†ï¼šå•ä¸ªKafkaConsumerå®ä¾‹ä»Kafkaä¸­æ‹‰å–æ¶ˆæ¯ï¼Œç„¶åå°†è¿™äº›æ¶ˆæ¯åˆ†å‘åˆ°å¤šä¸ªå·¥ä½œçº¿ç¨‹è¿›è¡Œå¤„ç†ã€‚è¿™æ ·å¯ä»¥åˆ©ç”¨å¤šçº¿ç¨‹å¤„ç†çš„ä¼˜åŠ¿ï¼ŒåŒæ—¶é¿å…äº†KafkaConsumerçš„çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚")])])]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-å¦‚æœè®©ä½ è®¾è®¡ä¸€ä¸ªmq-ä½ æ€ä¹ˆè®¾è®¡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-å¦‚æœè®©ä½ è®¾è®¡ä¸€ä¸ªmq-ä½ æ€ä¹ˆè®¾è®¡"}},[t._v("#")]),t._v(" ğŸ¯ å¦‚æœè®©ä½ è®¾è®¡ä¸€ä¸ªMQï¼Œä½ æ€ä¹ˆè®¾è®¡ï¼Ÿ")]),t._v(" "),s("p",[t._v("å…¶å®å›ç­”è¿™ç±»é—®é¢˜ï¼Œè¯´ç™½äº†ï¼Œèµ·ç ä¸æ±‚ä½ çœ‹è¿‡é‚£æŠ€æœ¯çš„æºç ï¼Œèµ·ç ä½ å¤§æ¦‚çŸ¥é“é‚£ä¸ªæŠ€æœ¯çš„åŸºæœ¬åŸç†ï¼Œæ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼ŒåŸºæœ¬æ¶æ„æ„æˆï¼Œç„¶åå‚ç…§ä¸€äº›å¼€æºçš„æŠ€æœ¯æŠŠä¸€ä¸ªç³»ç»Ÿè®¾è®¡å‡ºæ¥çš„æ€è·¯è¯´ä¸€ä¸‹å°±å¥½")]),t._v(" "),s("p",[t._v("æ¯”å¦‚è¯´è¿™ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼Œæˆ‘ä»¬æ¥ä»ä»¥ä¸‹å‡ ä¸ªè§’åº¦æ¥è€ƒè™‘ä¸€ä¸‹")]),t._v(" "),s("ol",[s("li",[t._v("é¦–å…ˆè¿™ä¸ªmqå¾—æ”¯æŒå¯ä¼¸ç¼©æ€§å§ï¼Œå°±æ˜¯éœ€è¦çš„æ—¶å€™å¿«é€Ÿæ‰©å®¹ï¼Œå°±å¯ä»¥å¢åŠ ååé‡å’Œå®¹é‡ï¼Œé‚£æ€ä¹ˆæï¼Ÿè®¾è®¡ä¸ªåˆ†å¸ƒå¼çš„ç³»ç»Ÿå‘—ï¼Œå‚ç…§ä¸€ä¸‹kafkaçš„è®¾è®¡ç†å¿µï¼Œbroker -> topic -> partitionï¼Œæ¯ä¸ªpartitionæ”¾ä¸€ä¸ªæœºå™¨ï¼Œå°±å­˜ä¸€éƒ¨åˆ†æ•°æ®ã€‚å¦‚æœç°åœ¨èµ„æºä¸å¤Ÿäº†ï¼Œç®€å•å•Šï¼Œç»™topicå¢åŠ partitionï¼Œç„¶ååšæ•°æ®è¿ç§»ï¼Œå¢åŠ æœºå™¨ï¼Œä¸å°±å¯ä»¥å­˜æ”¾æ›´å¤šæ•°æ®ï¼Œæä¾›æ›´é«˜çš„ååé‡äº†ï¼Ÿ")]),t._v(" "),s("li",[t._v("å…¶æ¬¡ä½ å¾—è€ƒè™‘ä¸€ä¸‹è¿™ä¸ªmqçš„æ•°æ®è¦ä¸è¦è½åœ°ç£ç›˜å§ï¼Ÿé‚£è‚¯å®šè¦äº†ï¼Œè½ç£ç›˜ï¼Œæ‰èƒ½ä¿è¯åˆ«è¿›ç¨‹æŒ‚äº†æ•°æ®å°±ä¸¢äº†ã€‚é‚£è½ç£ç›˜çš„æ—¶å€™æ€ä¹ˆè½å•Šï¼Ÿé¡ºåºå†™ï¼Œè¿™æ ·å°±æ²¡æœ‰ç£ç›˜éšæœºè¯»å†™çš„å¯»å€å¼€é”€ï¼Œç£ç›˜é¡ºåºè¯»å†™çš„æ€§èƒ½æ˜¯å¾ˆé«˜çš„ï¼Œè¿™å°±æ˜¯kafkaçš„æ€è·¯ã€‚")]),t._v(" "),s("li",[t._v("å…¶æ¬¡ä½ è€ƒè™‘ä¸€ä¸‹ä½ çš„mqçš„å¯ç”¨æ€§å•Šï¼Ÿè¿™ä¸ªäº‹å„¿ï¼Œå…·ä½“å‚è€ƒæˆ‘ä»¬ä¹‹å‰å¯ç”¨æ€§é‚£ä¸ªç¯èŠ‚è®²è§£çš„kafkaçš„é«˜å¯ç”¨ä¿éšœæœºåˆ¶ã€‚å¤šå‰¯æœ¬ -> leader & follower -> brokeræŒ‚äº†é‡æ–°é€‰ä¸¾leaderå³å¯å¯¹å¤–æœåŠ¡ã€‚")]),t._v(" "),s("li",[t._v("èƒ½ä¸èƒ½æ”¯æŒæ•°æ®0ä¸¢å¤±å•Šï¼Ÿå¯ä»¥çš„ï¼Œå‚è€ƒæˆ‘ä»¬ä¹‹å‰è¯´çš„é‚£ä¸ªkafkaæ•°æ®é›¶ä¸¢å¤±æ–¹æ¡ˆ")])]),t._v(" "),s("p",[t._v("å®ç°ä¸€ä¸ª  MQ è‚¯å®šæ˜¯å¾ˆå¤æ‚çš„ï¼Œå…¶å®è¿™æ˜¯ä¸ªå¼€æ”¾é¢˜ï¼Œå°±æ˜¯çœ‹çœ‹ä½ æœ‰æ²¡æœ‰ä»æ¶æ„è§’åº¦æ•´ä½“æ„æ€å’Œè®¾è®¡çš„æ€ç»´ä»¥åŠèƒ½åŠ›ã€‚")]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-kafka-streamsäº†è§£å—-åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä¼šä½¿ç”¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-kafka-streamsäº†è§£å—-åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä¼šä½¿ç”¨"}},[t._v("#")]),t._v(" ğŸ¯ Kafka Streamsäº†è§£å—ï¼Ÿåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä¼šä½¿ç”¨ï¼Ÿ")]),t._v(" "),s("p",[t._v('"Kafka Streamsæ˜¯Kafkaæä¾›çš„æµå¤„ç†æ¡†æ¶ï¼Œæˆ‘åœ¨ä»¥ä¸‹åœºæ™¯ä¸­ä½¿ç”¨è¿‡ï¼š')]),t._v(" "),s("p",[s("strong",[t._v("å®æ—¶èšåˆç»Ÿè®¡ï¼š")])]),t._v(" "),s("ul",[s("li",[t._v("å®æ—¶è®¡ç®—ç”¨æˆ·è¡Œä¸ºæŒ‡æ ‡ï¼Œå¦‚PVã€UV")]),t._v(" "),s("li",[t._v("æ»‘åŠ¨çª—å£ç»Ÿè®¡ï¼Œå¦‚æœ€è¿‘1å°æ—¶çš„è®¢å•é‡")])]),t._v(" "),s("p",[s("strong",[t._v("æ•°æ®æ¸…æ´—å’Œè½¬æ¢ï¼š")])]),t._v(" "),s("ul",[s("li",[t._v("å®æ—¶æ¸…æ´—æ—¥å¿—æ•°æ®ï¼Œè¿‡æ»¤æ— æ•ˆè®°å½•")]),t._v(" "),s("li",[t._v("æ•°æ®æ ¼å¼è½¬æ¢å’Œå­—æ®µæ˜ å°„")])]),t._v(" "),s("p",[s("strong",[t._v("å…³è”æŸ¥è¯¢ï¼š")])]),t._v(" "),s("ul",[s("li",[t._v("æµè¡¨å…³è”ï¼Œå¦‚è®¢å•æµå’Œç”¨æˆ·ä¿¡æ¯è¡¨çš„å…³è”")]),t._v(" "),s("li",[t._v("åŒæµå…³è”ï¼Œå¦‚ç‚¹å‡»æµå’Œæ›å…‰æµçš„å…³è”")])]),t._v(" "),s("p",[t._v("ç›¸æ¯”äºå…¶ä»–æµå¤„ç†æ¡†æ¶ï¼ˆå¦‚Stormã€Flinkï¼‰ï¼ŒKafka Streamsçš„ä¼˜åŠ¿æ˜¯ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("æ— éœ€é¢å¤–é›†ç¾¤ï¼Œé™ä½è¿ç»´å¤æ‚åº¦")]),t._v(" "),s("li",[t._v("ä¸Kafkaæ·±åº¦é›†æˆï¼Œexactly-onceè¯­ä¹‰")]),t._v(" "),s("li",[t._v("æ”¯æŒæœ¬åœ°çŠ¶æ€å­˜å‚¨ï¼ŒæŸ¥è¯¢æ€§èƒ½å¥½")])]),t._v(" "),s("p",[t._v("åœ¨æˆ‘ä»¬çš„å®æ—¶æ¨èç³»ç»Ÿä¸­ï¼Œä½¿ç”¨Kafka Streamså¤„ç†ç”¨æˆ·è¡Œä¸ºæµï¼Œå®æ—¶æ›´æ–°ç”¨æˆ·ç”»åƒã€‚â€")]),t._v(" "),s("h3",{attrs:{id:"ğŸ¯-reactive-kafkaäº†è§£å—-åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-reactive-kafkaäº†è§£å—-åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨"}},[t._v("#")]),t._v(" ğŸ¯ Reactive Kafkaäº†è§£å—ï¼Ÿåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨ï¼Ÿ")]),t._v(" "),s("p",[t._v('"Reactive Kafkaæ˜¯åŸºäºProject Reactoræ¡†æ¶çš„Kafkaå®¢æˆ·ç«¯åº“ï¼Œä¸»è¦ç”¨äºå“åº”å¼ç¼–ç¨‹åœºæ™¯ï¼š')]),t._v(" "),s("p",[s("strong",[t._v("æ ¸å¿ƒç‰¹æ€§ï¼š")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("èƒŒå‹å¤„ç†")]),t._v("ï¼šè‡ªåŠ¨å¤„ç†æ¶ˆè´¹è€…å¤„ç†èƒ½åŠ›ä¸ç”Ÿäº§é€Ÿåº¦çš„åŒ¹é…")]),t._v(" "),s("li",[s("strong",[t._v("éé˜»å¡IO")]),t._v("ï¼šåŸºäºNettyçš„å¼‚æ­¥éé˜»å¡å¤„ç†")]),t._v(" "),s("li",[s("strong",[t._v("æµå¼å¤„ç†")]),t._v("ï¼šä¸Spring WebFluxã€Reactorå®Œç¾é›†æˆ")]),t._v(" "),s("li",[s("strong",[t._v("èµ„æºç®¡ç†")]),t._v("ï¼šè‡ªåŠ¨ç®¡ç†è¿æ¥æ± å’Œçº¿ç¨‹èµ„æº")])]),t._v(" "),s("p",[s("strong",[t._v("ä¸»è¦ç»„ä»¶ï¼š")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("KafkaSender")]),t._v("ï¼šå“åº”å¼çš„æ¶ˆæ¯å‘é€å™¨")]),t._v(" "),s("li",[s("code",[t._v("KafkaReceiver")]),t._v("ï¼šå“åº”å¼çš„æ¶ˆæ¯æ¥æ”¶å™¨")]),t._v(" "),s("li",[s("code",[t._v("SenderRecord/ReceiverRecord")]),t._v("ï¼šå“åº”å¼çš„æ¶ˆæ¯å°è£…")])]),t._v(" "),s("p",[s("strong",[t._v("é€‚ç”¨åœºæ™¯ï¼š")]),t._v("\nåœ¨æˆ‘ä»¬çš„å¾®æœåŠ¡é¡¹ç›®ä¸­ï¼Œä¸»è¦åœ¨ä»¥ä¸‹åœºæ™¯ä½¿ç”¨ï¼š")]),t._v(" "),s("ol",[s("li",[s("p",[s("strong",[t._v("é«˜å¹¶å‘APIæœåŠ¡")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("WebFluxåº”ç”¨ä¸­éœ€è¦å¼‚æ­¥å¤„ç†Kafkaæ¶ˆæ¯")]),t._v(" "),s("li",[t._v("é¿å…é˜»å¡çº¿ç¨‹æ± ï¼Œæé«˜ç³»ç»Ÿååé‡")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("å®æ—¶æ•°æ®æµå¤„ç†")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("å¤„ç†å¤§é‡å®æ—¶æ•°æ®æµï¼Œå¦‚ç”¨æˆ·è¡Œä¸ºæ—¥å¿—")]),t._v(" "),s("li",[t._v("ä¸å…¶ä»–å“åº”å¼ç»„ä»¶ï¼ˆå¦‚Reactive MongoDBï¼‰é›†æˆ")])])]),t._v(" "),s("li",[s("p",[s("strong",[t._v("èƒŒå‹æ•æ„Ÿåœºæ™¯")]),t._v("ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("ä¸‹æ¸¸å¤„ç†èƒ½åŠ›æœ‰é™æ—¶ï¼Œéœ€è¦è‡ªåŠ¨è°ƒèŠ‚æ¶ˆè´¹é€Ÿåº¦")]),t._v(" "),s("li",[t._v("é¿å…å†…å­˜æº¢å‡ºå’Œç³»ç»Ÿé›ªå´©")])])])]),t._v(" "),s("p",[s("strong",[t._v("ä»£ç ç¤ºä¾‹ï¼š")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Producerç¤ºä¾‹")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Service")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReactiveKafkaProducer")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KafkaSender")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" sender"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mono")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sendMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" topic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" sender"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Mono")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("just")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SenderRecord")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("create")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("topic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n                    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Consumerç¤ºä¾‹  ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Service")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ReactiveKafkaConsumer")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("final")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("KafkaReceiver")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" receiver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@PostConstruct")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("consume")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        receiver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("receive")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n               "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("delayElements")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Duration")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ofMillis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// èƒŒå‹æ§åˆ¶")]),t._v("\n               "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("doOnNext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("processMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n               "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("doOnNext")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("record "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" record"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("receiverOffset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("acknowledge")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n               "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("subscribe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("strong",[t._v("ä¸ä¼ ç»ŸKafka Clientçš„åŒºåˆ«ï¼š")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("çº¿ç¨‹æ¨¡å‹")]),t._v("ï¼šä¼ ç»Ÿå®¢æˆ·ç«¯éœ€è¦æ‰‹åŠ¨ç®¡ç†çº¿ç¨‹æ± ï¼ŒReactiveè‡ªåŠ¨ç®¡ç†")]),t._v(" "),s("li",[s("strong",[t._v("èƒŒå‹å¤„ç†")]),t._v("ï¼šä¼ ç»Ÿæ–¹å¼éœ€è¦æ‰‹åŠ¨æ§åˆ¶pollæ•°é‡ï¼ŒReactiveè‡ªåŠ¨è°ƒèŠ‚")]),t._v(" "),s("li",[s("strong",[t._v("é”™è¯¯å¤„ç†")]),t._v("ï¼šå“åº”å¼æä¾›æ›´ä¼˜é›…çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶")]),t._v(" "),s("li",[s("strong",[t._v("èµ„æºåˆ©ç”¨")]),t._v("ï¼šæ›´é«˜çš„èµ„æºåˆ©ç”¨ç‡ï¼Œç‰¹åˆ«æ˜¯åœ¨IOå¯†é›†å‹åœºæ™¯")])]),t._v(" "),s("p",[s("strong",[t._v("æ€§èƒ½ä¼˜åŠ¿ï¼š")]),t._v("\nåœ¨æˆ‘ä»¬çš„å‹æµ‹ä¸­å‘ç°ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("CPUä½¿ç”¨ç‡é™ä½30%ï¼ˆå‡å°‘çº¿ç¨‹åˆ‡æ¢å¼€é”€ï¼‰")]),t._v(" "),s("li",[t._v("å†…å­˜ä½¿ç”¨æ›´ç¨³å®šï¼ˆè‡ªåŠ¨èƒŒå‹è°ƒèŠ‚ï¼‰")]),t._v(" "),s("li",[t._v("åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œååé‡æå‡20-40%")])]),t._v(" "),s("p",[s("strong",[t._v("æ³¨æ„äº‹é¡¹ï¼š")])]),t._v(" "),s("ul",[s("li",[t._v("å­¦ä¹ æ›²çº¿ç›¸å¯¹é™¡å³­ï¼Œéœ€è¦ç†è§£å“åº”å¼ç¼–ç¨‹æ€æƒ³")]),t._v(" "),s("li",[t._v("è°ƒè¯•ç›¸å¯¹å¤æ‚ï¼Œéœ€è¦ç†Ÿæ‚‰å“åº”å¼è°ƒè¯•æŠ€å·§")]),t._v(" "),s("li",[t._v("ä¸æ˜¯æ‰€æœ‰åœºæ™¯éƒ½é€‚åˆï¼Œç®€å•çš„CRUDæ“ä½œç”¨ä¼ ç»Ÿæ–¹å¼æ›´ç›´æ¥")])]),t._v(" "),s("p",[t._v("åœ¨æˆ‘ä»¬çš„ç”¨æˆ·è¡Œä¸ºåˆ†æç³»ç»Ÿä¸­ï¼Œä½¿ç”¨Reactive Kafkaå¤„ç†æ¯ç§’10ä¸‡+çš„ç”¨æˆ·äº‹ä»¶ï¼Œç³»ç»Ÿè¡¨ç°éå¸¸ç¨³å®šã€‚â€")]),t._v(" "),s("h2",{attrs:{id:"ğŸ¯-é¢è¯•é‡ç‚¹æ€»ç»“"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ¯-é¢è¯•é‡ç‚¹æ€»ç»“"}},[t._v("#")]),t._v(" ğŸ¯ é¢è¯•é‡ç‚¹æ€»ç»“")]),t._v(" "),s("h3",{attrs:{id:"é«˜é¢‘è€ƒç‚¹é€Ÿè§ˆ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#é«˜é¢‘è€ƒç‚¹é€Ÿè§ˆ"}},[t._v("#")]),t._v(" é«˜é¢‘è€ƒç‚¹é€Ÿè§ˆ")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("Kafkaå®šä½ä¸ä¼˜åŠ¿")]),t._v("ï¼šåˆ†å¸ƒå¼æµå¹³å°ï¼Œé«˜ååé‡ï¼ŒæŒä¹…åŒ–å­˜å‚¨")]),t._v(" "),s("li",[s("strong",[t._v("æ ¸å¿ƒç»„ä»¶äº¤äº’")]),t._v("ï¼šBrokerã€Topicã€Partitionã€Producerã€Consumeråä½œæœºåˆ¶")]),t._v(" "),s("li",[s("strong",[t._v("é«˜æ€§èƒ½åŸç†")]),t._v("ï¼šé›¶æ‹·è´ã€é¡ºåºå†™ã€æ‰¹å¤„ç†ã€åˆ†åŒºå¹¶è¡Œçš„æŠ€æœ¯ç»„åˆ")]),t._v(" "),s("li",[s("strong",[t._v("å¯é æ€§ä¿éšœ")]),t._v("ï¼šå‰¯æœ¬æœºåˆ¶ã€ISRåŒæ­¥ã€äº‹åŠ¡æ”¯æŒçš„æ•°æ®å®‰å…¨ç­–ç•¥")]),t._v(" "),s("li",[s("strong",[t._v("æ€§èƒ½è°ƒä¼˜")]),t._v("ï¼šç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ã€Brokerä¸‰å±‚ä¼˜åŒ–çš„ç³»ç»Ÿæ–¹æ³•")]),t._v(" "),s("li",[s("strong",[t._v("æ•…éšœå¤„ç†")]),t._v("ï¼šå¸¸è§é—®é¢˜å®šä½ã€ç›‘æ§æŒ‡æ ‡ã€åº”æ€¥å¤„ç†çš„è¿ç»´èƒ½åŠ›")])]),t._v(" "),s("h3",{attrs:{id:"é¢è¯•ç­”é¢˜ç­–ç•¥"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#é¢è¯•ç­”é¢˜ç­–ç•¥"}},[t._v("#")]),t._v(" é¢è¯•ç­”é¢˜ç­–ç•¥")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("åŸºç¡€æ¦‚å¿µ")]),t._v("ï¼šå‡†ç¡®å®šä¹‰ + æ ¸å¿ƒç‰¹æ€§ + åº”ç”¨åœºæ™¯")]),t._v(" "),s("li",[s("strong",[t._v("æŠ€æœ¯åŸç†")]),t._v("ï¼šå®ç°æœºåˆ¶ + å…³é”®é…ç½® + ä»£ç ç¤ºä¾‹")]),t._v(" "),s("li",[s("strong",[t._v("å®æˆ˜ç»éªŒ")]),t._v("ï¼šå…·ä½“æ¡ˆä¾‹ + æ€§èƒ½æ•°æ® + è§£å†³æ€è·¯")]),t._v(" "),s("li",[s("strong",[t._v("å¯¹æ¯”åˆ†æ")]),t._v("ï¼šæŠ€æœ¯é€‰å‹ + ä¼˜ç¼ºç‚¹ + é€‚ç”¨åœºæ™¯")])]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"ğŸ“š-æ‰©å±•å­¦ä¹ "}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ“š-æ‰©å±•å­¦ä¹ "}},[t._v("#")]),t._v(" ğŸ“š æ‰©å±•å­¦ä¹ ")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("å®˜æ–¹æ–‡æ¡£")]),t._v("ï¼šKafkaå®˜æ–¹æ–‡æ¡£å’Œæºç åˆ†æ")]),t._v(" "),s("li",[s("strong",[t._v("å®æˆ˜é¡¹ç›®")]),t._v("ï¼šæ­å»ºKafkaé›†ç¾¤ï¼Œå®ç°å®Œæ•´çš„æ¶ˆæ¯å¤„ç†é“¾è·¯")]),t._v(" "),s("li",[s("strong",[t._v("ç›‘æ§å·¥å…·")]),t._v("ï¼šKafka Managerã€Confluent Platformç­‰å·¥å…·ä½¿ç”¨")]),t._v(" "),s("li",[s("strong",[t._v("æ€§èƒ½æµ‹è¯•")]),t._v("ï¼škafka-producer-perf-test.shã€kafka-consumer-perf-test.shå‹æµ‹")])])])}),[],!1,null,null,null);a.default=e.exports}}]);